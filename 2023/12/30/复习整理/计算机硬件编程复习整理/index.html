<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>计算机硬件编程复习整理 | WinkySpeed's Blog</title><meta name="author" content="WinkySpeed"><meta name="copyright" content="WinkySpeed"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="计算机硬件编程复习整理 FPGA基础 PLD，FPGA，CPLD概念 PLD，Programmable Logic Device，可编程逻辑器件 FPGA，Field Programmable Gate Array ，现场可编程门阵列 CPLD， Complex Programmable logic device，复杂可编程逻辑器件 CPLD，FPGA都属于PLD  FPGA相比">
<meta property="og:type" content="article">
<meta property="og:title" content="计算机硬件编程复习整理">
<meta property="og:url" content="http://example.com/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/index.html">
<meta property="og:site_name" content="WinkySpeed&#39;s Blog">
<meta property="og:description" content="计算机硬件编程复习整理 FPGA基础 PLD，FPGA，CPLD概念 PLD，Programmable Logic Device，可编程逻辑器件 FPGA，Field Programmable Gate Array ，现场可编程门阵列 CPLD， Complex Programmable logic device，复杂可编程逻辑器件 CPLD，FPGA都属于PLD  FPGA相比">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/WinkySpeed%20SP%20-%20Repaired.jpg">
<meta property="article:published_time" content="2023-12-30T11:24:04.000Z">
<meta property="article:modified_time" content="2024-01-02T12:17:45.105Z">
<meta property="article:author" content="WinkySpeed">
<meta property="article:tag" content="复习整理">
<meta property="article:tag" content="计算机硬件编程">
<meta property="article:tag" content="FPGA">
<meta property="article:tag" content="Verilog">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/WinkySpeed%20SP%20-%20Repaired.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '计算机硬件编程复习整理',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-01-02 20:17:45'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/WinkySpeed%20SP%20-%20Repaired.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">42</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">48</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/33703665_p0.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="WinkySpeed's Blog"><span class="site-name">WinkySpeed's Blog</span></a></span><div id="menus"><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">计算机硬件编程复习整理</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-12-30T11:24:04.000Z" title="发表于 2023-12-30 19:24:04">2023-12-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-01-02T12:17:45.105Z" title="更新于 2024-01-02 20:17:45">2024-01-02</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="计算机硬件编程复习整理"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="计算机硬件编程复习整理">计算机硬件编程复习整理</h1>
<h1 id="fpga基础">FPGA基础</h1>
<p>PLD，FPGA，CPLD概念</p>
<p>PLD，Programmable Logic Device，可编程逻辑器件</p>
<p>FPGA，Field Programmable Gate Array
，<strong>现场可编程门阵列</strong></p>
<p>CPLD， Complex Programmable logic device，复杂可编程逻辑器件</p>
<p>CPLD，FPGA都属于PLD</p>
<p><br></p>
<p>FPGA相比其他芯片的优势</p>
<p>并行（高性能），可编程可擦写，设计灵活，开发周期短</p>
<h2 id="什么是fpga">什么是FPGA</h2>
<p>PLD，Programmable Logic Device，可编程逻辑器件</p>
<p>ASIC，Application Specific Integrated Circuit，专用集成电路</p>
<p><br></p>
<p>FPGA是一种可编程逻辑器件</p>
<p>可编程：FPGA所执行的功能是由客户定制且可以根据需求改写的</p>
<p>CPU 上的编程，本质上只能改变 CPU 状态寄存器的数值，不能改变 CPU
中的逻辑门单元之间的硬件逻辑。而 FPGA 是可以的</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230193034686.png" class title="image-20231230193034686">
<h2 id="fpga芯片工作原理">FPGA芯片工作原理</h2>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230193132212.png" class title="image-20231230193132212">
<p>查找表LUT</p>
<h2 id="fpga和其他芯片区别">FPGA和其他芯片区别</h2>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230193213108.png" class title="image-20231230193213108">
<p>不同的芯片采用的架构不同，FPGA是查找表结构，其他芯片多为冯诺依曼或哈佛结构，都有擅长的领域也都有短板</p>
<p>FPGA的特点就是<strong>并行执行</strong>，这个是 FPGA 的最大优势</p>
<h2 id="fpga特点">FPGA特点</h2>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230193323840.png" class title="image-20231230193323840">
<h1 id="verilog基础">Verilog基础</h1>
<p>掌握Verilog基本语法</p>
<p><strong>掌握端口类型声明</strong></p>
<p>掌握Vivado软件的使用</p>
<p>掌握简单设计代码与测试文件testbench的编写</p>
<h2 id="verilog-hdl-语言基础">Verilog HDL 语言基础</h2>
<p>硬件描述语言HDL （Hardware Description Language )</p>
<p>是一种用形式化方法描述逻辑电路和系统的语言，是站在硬件角度进行编程的语言。是目前主要的电路设计输入方式</p>
<p>可以用<strong>一系列的编程模块</strong>来逐层实现极为复杂的逻辑系统功能（类似于其他编程语言的函数调用、逐步搭积木思想）</p>
<h3 id="和c语言的区别">和C语言的区别</h3>
<p>Verilog 是硬件描述语言，在编译下载到 FPGA
之后，会<strong>生成相应的电路</strong></p>
<p>C 语言是软件语言，编译下载到单片机/CPU
之后，还是软件指令，而不会根据你的代码生成相应的硬件电路，而单片机/CPU
处理软件指令需要取址、译码、执行，是串行执行的</p>
<p>Verilog 和 C 的区别也是 FPGA 和单片机/CPU 的区别，由于 FPGA
是<strong>并行处理</strong>，所以处理速度非常快，这个是 FPGA
的最大优势，这一点是单片机/CPU 替代不了的</p>
<h3 id="模块声明">模块声明</h3>
<p>Verilog
HDL使用<strong>模块</strong>（module）的概念来代表一个<strong>基本的功能单元</strong></p>
<p>一个模块可以是一个元件，也可以是<strong>低层次模块的组合</strong>。复杂的电路系统可由若干个子模块构成，即模块是可以进行层次嵌套的</p>
<p>一个模块是由各种电路组成，如组合逻辑电路+时序逻辑电路组合组成</p>
<p>常用的设计方法是使用元件来构建在多个地方都要使用的功能模块，以便进行代码重用，就类似于子函数的调用。大大提高工作效率，也便于修改子模块不会影响其他部分。跟搭积木一样慢慢搭出复杂的功能</p>
<h4 id="模块设计思想">模块设计思想</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230194018326.png" class title="image-20231230194018326">
<h4 id="程序模板">程序模板</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230194058930.png" class title="image-20231230194058930">
<h5 id="入门案例1位与门电路">入门案例：1位与门电路</h5>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230194141618.png" class title="image-20231230194141618">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span>	Gate_and(</span><br><span class="line">		<span class="keyword">input</span> a,</span><br><span class="line">		<span class="keyword">input</span> b,</span><br><span class="line">	    <span class="keyword">output</span> y);</span><br><span class="line">    	<span class="keyword">assign</span>	y=a&amp;b;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>注意，模块开始模块结束</p>
<p>还有模块的端口声明后面有分号<code>;</code></p>
<h4 id="端口声明">端口声明</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230194413752.png" class title="image-20231230194413752">
<p>端口声明，默认是wire类型</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230194509289.png" class title="image-20231230194509289">
<h5 id="wire型">wire型</h5>
<p><strong>必须</strong>用<code>assign</code>语句赋值：因为<strong>线型数据需要持续驱动</strong></p>
<p>用法：<code>wire [n-1:0]  数据名1，数据名2，…数据名M;</code></p>
<p>表示定义了M个<code>wire</code>信号，每条信号位宽为<code>n</code>。对应物理硬件上M*n条线</p>
<p>比如：</p>
<p><code>input wire [2:0] in</code></p>
<p>定义了<code>input</code>类型，<code>wire</code>类型（可以省略）的变量<code>in</code></p>
<p>有3根线，即位宽为3，对应物理硬件中<code>in[2], in[1], in[0]</code>
三条线</p>
<p><strong><code>input</code>数据类型必须定义为<code>wire</code>类型</strong></p>
<h5 id="reg型">reg型</h5>
<p>只能用<code>always</code>语句和 <code>initial</code> 语句中被赋值</p>
<p>如果该过程语句描述的是时序逻辑，即 always
语句带有时钟信号，则该寄存器变量对应为寄存器</p>
<p>如果该过程语句描述的是组合逻辑，即 always
语句不带有时钟信号，则该寄存器变量对应为硬件连线</p>
<p><br></p>
<p>用法：<code>reg [n-1:0] 数据名1，数据名2，…数据名M；</code></p>
<p>在硬件上表示定义了M个寄存器变量，每个寄存器的位宽为n</p>
<p>比如：</p>
<p><code>reg [4:0] a, b, c;</code>表示定义了3个寄存器<code>a,b,c</code>，每个寄存器的位宽为<code>5</code>；</p>
<p>位宽若不指定（如<code>reg a,b,c;</code>）就默认是1位</p>
<p>一定要注意寄存器类型只能用在<code>always或者initial</code>语句中</p>
<h6 id="wire和reg的区别"><code>wire</code>和<code>reg</code>的区别</h6>
<p>wire(线网)变量：可以理解为电路模块中的物理连线，特点是<strong>输出值紧跟输入值变化</strong>，需要持续的驱动。<strong>没有存储功能，只能用在assign赋值语句中</strong></p>
<p>对代码进行仿真时，wire类型是不占用仿真内存。线网是被驱动的，该值不被保持，在任意一个仿真步进上都需要重新计算</p>
<p>reg(寄存器)变量：对应电路上的存储单元，变量<strong>保持最后一次赋值（有存储数据功能）</strong>，因此不用持续驱动。<strong>只能用在always或initial语句中</strong></p>
<p>对代码进行仿真时，reg类型的变量会占用仿真环境的物理内存。寄存器在被赋值后，便一直保存在内存中，保持该值不变，直到下一次被赋值。即<strong>reg一定要有触发，输出才会反映输入。</strong></p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230195333342.png" class title="image-20231230195333342">
<h5 id="memory型">memory型</h5>
<p>对reg型变量建立数组来对存储器建模，可以用来描述RAM</p>
<p>用法：<code>reg [n-1:0] 存储器名 [m-1:0];</code></p>
<p>其中<code>[n-1:0]</code>定义了存储器中每一个存储单元的位宽大小，即该存储单元是一个n位位宽的寄存器</p>
<p>后面<code>[m-1:0]</code>定义了存储器的大小，即有m个这样的寄存器</p>
<p>快捷记忆方法：写在前面的表示位宽，写在后面的表示个数</p>
<p><br></p>
<h6 id="memory和reg区别">memory和reg区别</h6>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230195500450.png" class title="image-20231230195500450">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230195547293.png" class title="image-20231230195547293">
<h5 id="parameter常量声明">parameter常量声明</h5>
<p>用<code>#</code>写在端口声明前面</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230195641623.png" class title="image-20231230195641623">
<p>注意，<code>#</code>写在<code>(parameter)</code>前</p>
<h5 id="模块总结">模块总结</h5>
<p>对一个模块来说：</p>
<p>输入只能是wire</p>
<p>输出可以是wire，也可以是reg</p>
<h3 id="电路功能描述">电路功能描述</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230200012734.png" class title="image-20231230200012734">
<p>同一个模块里的<code>assign, always, initial</code>语句块并行执行</p>
<h4 id="例子打分器">例子：打分器</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230200116247.png" class title="image-20231230200116247">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230200257587.png" class title="image-20231230200257587">
<p><code>F=1'b1</code>：<code>1'b</code>为一位二进制，第二个1表示赋值的1</p>
<h4 id="例子定点加法器">例子：定点加法器</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230200451157.png" class title="image-20231230200451157">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> adder(</span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">31</span>:<span class="number">0</span>] operand1,</span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">31</span>:<span class="number">0</span>] operand2,</span><br><span class="line">    <span class="keyword">input</span>         cin,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] result,</span><br><span class="line">    <span class="keyword">output</span>        cout</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">assign</span> &#123;cout,result&#125; = operand1 + operand2 + cin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p><code>&#123;&#125;</code>表示拼接，此时最高位就会赋值给<code>cout</code></p>
<h3 id="testbench的编写">testbench的编写</h3>
<p>描述测试信号的变化和测试过程的模块称为测试平台（testbench）</p>
<p>说到底就是对写好的模块进行调用</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230201820045.png" class title="image-20231230201820045">
<p>实例化的方法：</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230201933387.png" class title="image-20231230201933387">
<h4 id="模块调用时数据类型的声明">模块调用时数据类型的声明</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230202201122.png" class title="image-20231230202201122">
<p>对一个模块来说，从外界的输入必须是wire，输出到外界的可以是wire也可以是reg</p>
<p>但是调用模块时，你用来传进去的变量就得反过来</p>
<p>测试打分器模块：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps  </span><span class="comment">//表示仿真时间单位是1ns，时间精度是1ps </span></span><br><span class="line"><span class="keyword">module</span> Score_test ; <span class="comment">//与外界没有接口，也可用module Score_test() ; </span></span><br><span class="line"> <span class="keyword">reg</span> A_test, B_test, C_test; <span class="comment">//reg or wire type, initial或always块中赋值</span></span><br><span class="line"> <span class="keyword">wire</span> F_test ;<span class="comment">//必须wire类型</span></span><br><span class="line"> Score U_Score(A_test, B_test, C_test, F_test); <span class="comment">//实例化语句</span></span><br><span class="line"> <span class="keyword">initial</span>     <span class="keyword">begin</span></span><br><span class="line">        A_test=<span class="number">1</span>’b0;   B_test=<span class="number">0</span>;  C_test=<span class="number">0</span>;   <span class="comment">//0不指定位宽默认为32位十进制。</span></span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line"> <span class="keyword">always</span>    #<span class="number">5</span> A_test=~A_test;</span><br><span class="line"> <span class="keyword">always</span>    #<span class="number">7</span> B_test=<span class="number">1</span>;</span><br><span class="line"> <span class="keyword">always</span>    #<span class="number">4</span> C_test=~C_test;  </span><br><span class="line"> <span class="keyword">initial</span>  #<span class="number">100</span>  <span class="built_in">$finish</span>; <span class="comment">//$finish是常用的系统任务</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p>测试加法模块：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps   </span><span class="comment">//仿真单位时间为1ns，精度为1ps</span></span><br><span class="line"><span class="keyword">module</span> tb_addr;</span><br><span class="line">    <span class="comment">// Inputs</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] operand1,operand2;</span><br><span class="line">    <span class="keyword">reg</span> cin;</span><br><span class="line">    <span class="comment">// Outputs</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] result;</span><br><span class="line">    <span class="keyword">wire</span> cout;</span><br><span class="line">    adder uut (<span class="variable">.operand1</span>(operand1),<span class="variable">.operand2</span>(operand2), <span class="variable">.cin</span>(cin),<span class="variable">.result</span>(result),<span class="variable">.cout</span>(cout));</span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        operand1 = <span class="number">0</span>;</span><br><span class="line">        operand2 = <span class="number">0</span>;</span><br><span class="line">        cin = <span class="number">0</span>;</span><br><span class="line">        #<span class="number">100</span> <span class="built_in">$finish</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">always</span> #<span class="number">10</span> operand1 = <span class="built_in">$random</span>;<span class="comment">//$random为系统任务，产生一个随机的32位数</span></span><br><span class="line">    <span class="keyword">always</span> #<span class="number">10</span> operand2 = <span class="built_in">$random</span>;<span class="comment">//#10表示等待10个单位时间(10ns)，即每过10ns，赋值一个随机的32位数</span></span><br><span class="line">    <span class="keyword">always</span> #<span class="number">10</span> cin = &#123;<span class="built_in">$random</span>&#125; % <span class="number">2</span>;<span class="comment">//加了拼接符，&#123;$random&#125;产生一个非负数，除2取余得到0或1</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p><code>#10</code>表示等10个单位时间</p>
<h2 id="verilog语法基础">Verilog语法基础</h2>
<h3 id="数制与位宽">数制与位宽</h3>
<p>最好位宽、进制都指定</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230202915905.png" class title="image-20231230202915905">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230202959439.png" class title="image-20231230202959439">
<p>注意：这里的位宽是<strong>针对二进制</strong>的</p>
<p>位宽默认32位</p>
<p>进制默认10进制</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230203154323.png" class title="image-20231230203154323">
<h4 id="特殊字符">特殊字符</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230203234849.png" class title="image-20231230203234849">
<h3 id="运算操作">运算操作</h3>
<p>跟C语言差不多</p>
<p><code>**</code>为幂运算</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230203317343.png" class title="image-20231230203317343">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230203432521.png" class title="image-20231230203432521">
<p><code>==</code>不考虑不定X和高阻Z</p>
<p><code>===</code>考虑</p>
<p>位运算：</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230203522409.png" class title="image-20231230203522409">
<p>注意<code>^</code>是按位异或</p>
<p>注意按位与和逻辑与</p>
<p><br></p>
<p>位拼接<code>&#123;&#125;</code></p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230203805590.png" class title="image-20231230203805590">
<h1 id="组合逻辑电路设计">组合逻辑电路设计</h1>
<p>掌握always块的用法</p>
<p>掌握条件和循环语句用法</p>
<p>掌握常数和参数的使用</p>
<p>理解阻塞和非阻塞赋值区别</p>
<p>理解verilog语言和c语言的区别：并行和顺序执行</p>
<p><br></p>
<h2 id="组合逻辑与时序逻辑">组合逻辑与时序逻辑</h2>
<p>数字逻辑的分类从本质上可分为<strong>组合逻辑</strong>和<strong>时序逻辑</strong>两大类</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230204041170.png" class title="image-20231230204041170">
<p>两个逻辑的<code>alway@</code>的内容不一样</p>
<h3 id="组合逻辑">组合逻辑</h3>
<p>用法：<code>always @*</code> 或
<code>always @ (这块电路的敏感信号列表)</code></p>
<p>组合逻辑电路在任意时刻的输出只取决于当前时刻的输入，与电路之前的状态无关</p>
<h3 id="时序逻辑">时序逻辑</h3>
<p>用法：<code>always@ (posedge  clk or negedge reset)</code> 或
<code>always@(clk)</code></p>
<h2 id="组合逻辑的alway块">组合逻辑的alway块</h2>
<p><strong>组合逻辑</strong>电路中，Verilog
使用一些<strong>顺序执行</strong>的过程语句来进行行为描述</p>
<p>这些语句用在一个always块或initial块中，<strong>但只有always块能够进行综合并生成能够执行逻辑运算或控制的电路模块</strong></p>
<p><strong>initial一般只用在仿真文件（testbench）中</strong></p>
<h3 id="敏感信号列表">敏感信号列表</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230204529205.png" class title="image-20231230204529205">
<p>敏感信号可分为两种类型：一种是<strong>电平敏感型</strong>，一种是<strong>边缘敏感型</strong></p>
<p>组合电路一般采用电平触发</p>
<p>时序电路一般由时钟边沿触发。Verilog
HDL提供了<strong>posedge和negedge</strong>两个关键词来分别描述上升沿和下降沿</p>
<h3 id="过程赋值">过程赋值</h3>
<p>过程赋值只能用在always块或initial块中</p>
<p>赋值有两种：阻塞和非阻塞</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230204713239.png" class title="image-20231230204713239">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230204737411.png" class title="image-20231230204737411">
<h4 id="阻塞赋值">阻塞赋值</h4>
<p>多在组合逻辑电路中使用阻塞赋值（<code>=</code>），信号的值在赋值语句执行完后立刻就改变</p>
<p>在同一个always
中，一条阻塞赋值语句如果没有执行结束，那么该语句后面的语句就不能被执行，即被“阻塞”</p>
<p>与C语言程序中的顺序执行过程类似</p>
<p>对比assign语句：</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230204912995.png" class title="image-20231230204912995">
<p>如果在时序电路用阻塞：</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230205021042.png" class title="image-20231230205021042">
<h4 id="非阻塞赋值">非阻塞赋值</h4>
<p>这个是一起执行，并行</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230210713594.png" class title="image-20231230210713594">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230210808654.png" class title="image-20231230210808654">
<h3 id="例子1位比较器">例子：1位比较器</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230211014487.png" class title="image-20231230211014487">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230211119850.png" class title="image-20231230211119850">
<h2 id="条件语句">条件语句</h2>
<h3 id="if-else">if-else</h3>
<h4 id="例子4位优先编码器">例子：4位优先编码器</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230211344511.png" class title="image-20231230211344511">
<h4 id="例子带使能信号的2-4译码器">例子：带使能信号的2-4译码器</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230211503558.png" class title="image-20231230211503558">
<p>译码器：独热码，即<code>0000, 0001, 0010, 0100, 1000</code></p>
<h3 id="case">case</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230211648119.png" class title="image-20231230211648119">
<h4 id="例子带使能信号的2-4译码器-1">例子：带使能信号的2-4译码器</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230211717307.png" class title="image-20231230211717307">
<p>用拼接符<code>&#123;en, a&#125;</code>把这两个连接起来，可以直接判断</p>
<p>Verilog的case不需要像C语言一样加<code>break;</code>，也不需要有<code>switch</code></p>
<p>仅有一个<code>case()</code></p>
<h4 id="case变体">case变体</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230212758187.png" class title="image-20231230212758187">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230212830246.png" class title="image-20231230212830246">
<p>case语句要写清楚所有分支，如果没有所有分支，会生成存储元件，这不是我们在组合逻辑中需要的</p>
<p>未匹配的值，最好加<code>default</code>或赋初值</p>
<h3 id="避免锁存器">避免锁存器</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230213039993.png" class title="image-20231230213039993">
<h2 id="循环语句">循环语句</h2>
<h3 id="例子8位乘法器-乘号运算">例子：8位乘法器-乘号运算</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230213123034.png" class title="image-20231230213123034">
<p>虽然<code>*</code>能实现，但是会占用更多资源</p>
<h4 id="用移位实现8位乘法器">用移位实现8位乘法器</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230213217629.png" class title="image-20231230213217629">
<p>乘法可以用位移和加法实现</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230213335495.png" class title="image-20231230213335495">
<h5 id="不用乘法运算的原因">不用<code>*</code>乘法运算的原因</h5>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230213403012.png" class title="image-20231230213403012">
<h3 id="for语句">for语句</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230213514300.png" class title="image-20231230213514300">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span>	Mult_for(op1, op2, result);</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">7</span>:<span class="number">0</span>] op1,op2;</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>] result;</span><br><span class="line">    <span class="keyword">integer</span> i;</span><br><span class="line">    <span class="keyword">always</span> @* <span class="keyword">begin</span></span><br><span class="line">        result = <span class="number">0</span>;		<span class="comment">//赋初值可避免产生latch</span></span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">8</span>; i=i+<span class="number">1</span>)	<span class="comment">//注：没有i++的写法</span></span><br><span class="line">            <span class="keyword">if</span>(op1[i])</span><br><span class="line">                result = result + (op2[i]&lt;&lt;i);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230214304923.png" class title="image-20231230214304923">
<h3 id="repeat语句">repeat语句</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Mult_repeat  (op0, op1, result);</span><br><span class="line"><span class="keyword">input</span> [<span class="number">7</span>:<span class="number">0</span>] op0, op1;</span><br><span class="line"><span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>] result ;	</span><br><span class="line"><span class="keyword">integer</span> i;</span><br><span class="line">	<span class="keyword">always</span> @*	<span class="keyword">begin</span></span><br><span class="line">		result=<span class="number">0</span>;</span><br><span class="line">		i=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">repeat</span>(<span class="number">8</span>)  <span class="keyword">begin</span></span><br><span class="line">			<span class="keyword">if</span>(op1[i])   </span><br><span class="line">				result=result+(op0&lt;&lt;i);</span><br><span class="line">			i=i+<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">end</span></span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h3 id="while语句">while语句</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Mult_while (op0, op1, result );</span><br><span class="line"><span class="keyword">input</span> [<span class="number">7</span>:<span class="number">0</span>] op0, op1;</span><br><span class="line"><span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>] result ;	</span><br><span class="line"><span class="keyword">integer</span> i;</span><br><span class="line">	<span class="keyword">always</span> @*	<span class="keyword">begin</span></span><br><span class="line">		result=<span class="number">0</span>;</span><br><span class="line">		i=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i&lt;<span class="number">8</span>)  <span class="keyword">begin</span></span><br><span class="line">			<span class="keyword">if</span>(op1[i])   </span><br><span class="line">				result=result+(op0&lt;&lt;i);</span><br><span class="line">			i=i+<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">end</span></span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h2 id="always块一般编码原则">always块一般编码原则</h2>
<p>虽然Verilog与C语言语法相近，但是我们要谨记编写代码的目的是<strong>综合为硬件电路而不是用C语言描述顺序算法</strong>，做不到这些会经常导致无法综合的代码或者不必要的复杂实施，或者在仿真和综合之间产生差异</p>
<h3 id="组合电路代码中常见的错误">组合电路代码中常见的错误</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230214722373.png" class title="image-20231230214722373">
<p>变量不能在多个并行块中赋值（仿真文件中这么写，但是这种写法只适用于teshbench）</p>
<p>写always块，敏感信号列表直接写<code>*</code>可以避免</p>
<p>不完整分支会导致锁存器，所以可以赋初值，在<code>if</code>语句中用<code>else</code>，在<code>case</code>语句中用<code>default</code></p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230215030039.png" class title="image-20231230215030039">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230215038448.png" class title="image-20231230215038448">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230215146595.png" class title="image-20231230215146595">
<p><br></p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230215223927.png" class title="image-20231230215223927">
<h3 id="组合电路中always块的使用原则">组合电路中always块的使用原则</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230220006348.png" class title="image-20231230220006348">
<h2 id="参数和常数">参数和常数</h2>
<p>常数localparam和参数parameter</p>
<p>localparam用在端口声明之后，parameter可以用在端口声明之前，也可用在端口声明之后。分别类似于C语言中的const用法以及宏定义</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230220131643.png" class title="image-20231230220131643">
<h3 id="localparam">localparam</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230220322379.png" class title="image-20231230220322379">
<p>我印象中没用过这个</p>
<h3 id="parameter">parameter</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230220422328.png" class title="image-20231230220422328">
<p>所谓不定位宽，就是用变量指明位宽，需要多少位就调用多少位</p>
<p>还能指定默认值<code>#(parameter N=4)</code></p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230220838254.png" class title="image-20231230220838254">
<h2 id="常用组合逻辑电路设计实例">常用组合逻辑电路设计实例</h2>
<h3 id="例子多路选择器">例子：多路选择器</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230221214332.png" class title="image-20231230221214332">
<p>从多个输入中选择一路</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Mux4_1(in0,in1,in2,in3,s1,s0,out);</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> in0,in1,in2,in3;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> s0,s1;</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> out;</span><br><span class="line">    <span class="keyword">always</span> @* <span class="keyword">begin</span></span><br><span class="line">        out = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">case</span>(&#123;s1,s0&#125;)</span><br><span class="line">            <span class="number">2&#x27;b00</span>:	out = in0;</span><br><span class="line">            <span class="number">2&#x27;b01</span>:	out = in1;</span><br><span class="line">            <span class="number">2&#x27;b10</span>:	out = in2;</span><br><span class="line">            <span class="keyword">default</span>:out = in3;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>注意模块声明后面的<code>;</code></p>
<p>注意<code>case</code>语法</p>
<p>注意<code>endcase</code>语句</p>
<p>对应的testbench</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> tb_Mux4_1();</span><br><span class="line">    <span class="keyword">reg</span> in0,in1,in2,in3;</span><br><span class="line">    <span class="keyword">reg</span> s1,s0;</span><br><span class="line">    <span class="keyword">wire</span> out;</span><br><span class="line">    Mux4_1 U_Mux4_1(<span class="variable">.in0</span>(in0),<span class="variable">.in1</span>(in1),<span class="variable">.in2</span>(in2),<span class="variable">.in3</span>(in3),<span class="variable">.s1</span>(s1),<span class="variable">.s0</span>(s0),<span class="variable">.out</span>(out));</span><br><span class="line">    <span class="keyword">initial</span>	<span class="keyword">begin</span></span><br><span class="line">        in0=<span class="number">0</span>;</span><br><span class="line">        in1=<span class="number">1</span>;</span><br><span class="line">        in2=<span class="number">1</span>;</span><br><span class="line">        in3=<span class="number">0</span>;</span><br><span class="line">        s0=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        s1=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        #<span class="number">40</span>	s0=<span class="number">1&#x27;b1</span>;</span><br><span class="line">        #<span class="number">40</span>	s1=<span class="number">1&#x27;b0</span>;</span><br><span class="line">  	    #<span class="number">40</span>	s0=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        #<span class="number">100</span>	<span class="built_in">$finish</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>注意testbench最后加的<code>#100    $finish;</code></p>
<h3 id="例子比较器">例子：比较器</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230223532553.png" class title="image-20231230223532553">
<p>不定位宽：<code>#(parameter N=8)</code></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Comp #(<span class="keyword">parameter</span> N=<span class="number">8</span>)  (in0,in1,gt,eq,lt);</span><br><span class="line"><span class="keyword">input</span> [N-<span class="number">1</span>:<span class="number">0</span>] in0,in1;</span><br><span class="line"><span class="keyword">output</span> <span class="keyword">reg</span> gt, eq, lt;    </span><br><span class="line"><span class="keyword">always</span> @*     <span class="keyword">begin</span></span><br><span class="line">        gt=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        eq=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        lt=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">if</span>(in0&gt;in1) gt=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (in0==in1) eq=<span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">else</span> lt=<span class="number">1&#x27;b1</span>;</span><br><span class="line">  <span class="keyword">end</span>         </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230224521865.png" class title="image-20231230224521865">
<p>对应的testbench</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> tb_Comp #(<span class="keyword">parameter</span> M=<span class="number">10</span>) ();</span><br><span class="line">    <span class="keyword">reg</span> in0, in1;</span><br><span class="line">    <span class="keyword">wire</span> gt, eq, lt;</span><br><span class="line">    Comp <span class="variable">#(.N(M)) U_Comp(in0,in1,gt,eq,lt)</span>;</span><br><span class="line">    <span class="keyword">initial</span>	<span class="keyword">begin</span></span><br><span class="line">        in0 = <span class="number">0</span>;</span><br><span class="line">        in1 = <span class="number">1</span>;</span><br><span class="line">        #<span class="number">20</span>	in0 = <span class="number">100</span>;</span><br><span class="line">        #<span class="number">40</span>	in1 = <span class="number">77</span>;</span><br><span class="line">        #<span class="number">200</span> <span class="built_in">$finish</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>注意，如果调用模块，写了<code>parameter</code>的会在<strong>变量名前</strong>用</p>
<p><code>Comp #(.N(M)) U_Comp(in0,in1,gt,eq,lt);</code></p>
<h3 id="译码器和编码器">译码器和编码器</h3>
<h4 id="例子3-8译码器">例子：3-8译码器</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231230224828229.png" class title="image-20231230224828229">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Decoder (in,y);</span><br><span class="line"><span class="keyword">input</span> [<span class="number">2</span>:<span class="number">0</span>] in;  </span><br><span class="line"><span class="keyword">output</span> <span class="keyword">reg</span>[<span class="number">7</span>:<span class="number">0</span>] y;</span><br><span class="line"><span class="keyword">always</span> @*     <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span>(in)</span><br><span class="line">        <span class="number">3&#x27;b000</span>: y=<span class="number">8&#x27;b0000_0001</span>;</span><br><span class="line">        <span class="number">3&#x27;b001</span>: y=<span class="number">8&#x27;b0000_0010</span>;</span><br><span class="line">        <span class="number">3&#x27;b010</span>: y=<span class="number">8&#x27;b0000_0100</span>;</span><br><span class="line">        <span class="number">3&#x27;b011</span>: y=<span class="number">8&#x27;b0000_1000</span>;</span><br><span class="line">        <span class="number">3&#x27;b100</span>: y=<span class="number">8&#x27;b0001_0000</span>;</span><br><span class="line">        <span class="number">3&#x27;b101</span>: y=<span class="number">8&#x27;b0010_0000</span>;</span><br><span class="line">        <span class="number">3&#x27;b110</span>: y=<span class="number">8&#x27;b0100_0000</span>;</span><br><span class="line">        <span class="keyword">default</span>: y=<span class="number">8&#x27;b1000_0000</span>;            </span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line"> <span class="keyword">end</span>     </span><br><span class="line"> <span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>对应的testbench：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> tb_Decoder();</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] in;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] y;</span><br><span class="line">    Decoder U_Decoder(in,y);</span><br><span class="line">    <span class="keyword">initial</span>	<span class="keyword">begin</span></span><br><span class="line">        in = <span class="number">3&#x27;b000</span>;</span><br><span class="line">        #<span class="number">30</span>	in = <span class="number">3&#x27;b100</span>;</span><br><span class="line">        #<span class="number">40</span>	in = <span class="number">3&#x27;b010</span>;</span><br><span class="line">        #<span class="number">20</span>	in = <span class="number">3&#x27;b110</span>;</span><br><span class="line">        #<span class="number">200</span>	<span class="built_in">$finish</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="例子8-3编码器">例子：8-3编码器</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231090524561.png" class title="image-20231231090524561">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Encoder(in,y,valid);<span class="comment">//先看书上的这段代码！</span></span><br><span class="line"> <span class="keyword">input</span> [<span class="number">7</span>:<span class="number">0</span>] in;   <span class="keyword">output</span> <span class="keyword">reg</span>[<span class="number">2</span>:<span class="number">0</span>] y;  <span class="keyword">output</span> <span class="keyword">reg</span> valid ;</span><br><span class="line"> <span class="keyword">always</span> @*      <span class="keyword">begin</span>        </span><br><span class="line">        valid=<span class="number">1</span>;</span><br><span class="line">     	y = <span class="number">3&#x27;b000</span>;</span><br><span class="line">        <span class="keyword">case</span>(in)</span><br><span class="line">        <span class="number">8&#x27;b0000_0001</span>: y=<span class="number">3&#x27;b000</span>;</span><br><span class="line">        <span class="number">8&#x27;b0000_0010</span> : y=<span class="number">3&#x27;b001</span>;</span><br><span class="line">        <span class="number">8&#x27;b0000_0100</span> : y=<span class="number">3&#x27;b010</span>;</span><br><span class="line">        <span class="number">8&#x27;b0000_1000</span> : y=<span class="number">3&#x27;b011</span>;</span><br><span class="line">        <span class="number">8&#x27;b0001_0000</span> : y=<span class="number">3&#x27;b100</span>;</span><br><span class="line">        <span class="number">8&#x27;b0010_0000</span> : y=<span class="number">3&#x27;b101</span>;</span><br><span class="line">        <span class="number">8&#x27;b0100_0000</span> : y=<span class="number">3&#x27;b110</span>;</span><br><span class="line">        <span class="number">8&#x27;b1000_0000</span> : y=<span class="number">3&#x27;b111</span>;    </span><br><span class="line">        <span class="keyword">default</span>: valid=<span class="number">0</span>;        </span><br><span class="line">        <span class="keyword">endcase</span>          </span><br><span class="line"><span class="keyword">end</span>    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="例子8-3优先编码器">例子：8-3优先编码器</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231090747946.png" class title="image-20231231090747946">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Prio_Encoder(in,y);</span><br><span class="line"><span class="keyword">input</span> [<span class="number">7</span>:<span class="number">0</span>] in;</span><br><span class="line"><span class="keyword">output</span> <span class="keyword">reg</span>[<span class="number">2</span>:<span class="number">0</span>] y;</span><br><span class="line"><span class="keyword">always</span> @*       <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">casex</span>(in)</span><br><span class="line">        	<span class="number">8&#x27;b1</span>???_????: y=<span class="number">3&#x27;b111</span>;</span><br><span class="line">        	<span class="number">8&#x27;b01</span>??_???? : y=<span class="number">3&#x27;b110</span>;</span><br><span class="line">        	<span class="number">8&#x27;b001</span>?_????: y=<span class="number">3&#x27;b101</span>;</span><br><span class="line">        	<span class="number">8&#x27;b0001_</span>???? : y=<span class="number">3&#x27;b100</span>;</span><br><span class="line">        	<span class="number">8&#x27;b0000_1</span>??? : y=<span class="number">3&#x27;b011</span>;</span><br><span class="line">        	<span class="number">8&#x27;b0000_01</span>??: y=<span class="number">3&#x27;b010</span>;</span><br><span class="line">        	<span class="number">8</span>’b0000_001?: y=<span class="number">3&#x27;b001</span>;</span><br><span class="line">        	<span class="keyword">default</span>: y=<span class="number">3&#x27;b000</span>;    </span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line"><span class="keyword">end</span> </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h3 id="进制数7段led显示译码器">16进制数7段LED显示译码器</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231090916337.png" class title="image-20231231090916337">
<p>数码管分为共阳极和共阴极</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231090941705.png" class title="image-20231231090941705">
<p>输入是a-g</p>
<p>如果是共阴极，则输入高电平亮</p>
<p>如果是共阳极，则输入低电平亮</p>
<h4 id="例子16进制共阳数码管">例子：16进制共阳数码管</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231091136469.png" class title="image-20231231091136469">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231091621933.png" class title="image-20231231091621933">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231091230862.png" class title="image-20231231091230862">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Hex_sseg_display(in,dp,y);</span><br><span class="line"><span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] in;    </span><br><span class="line"><span class="keyword">input</span> dp;<span class="comment">//控制小数点显示</span></span><br><span class="line"><span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] y; <span class="comment">//8根输出线</span></span><br><span class="line"><span class="keyword">always</span> @*      <span class="keyword">begin</span></span><br><span class="line">        y[<span class="number">0</span>]=dp;<span class="comment">//若不考虑小数点则赋固定值</span></span><br><span class="line">        <span class="keyword">case</span>(in)</span><br><span class="line">        <span class="number">4&#x27;d0</span>: y[<span class="number">7</span>:<span class="number">1</span>]=<span class="number">7&#x27;b0000001</span>;</span><br><span class="line">        <span class="number">4&#x27;d1</span> : y[<span class="number">7</span>:<span class="number">1</span>]=<span class="number">7&#x27;b1001111</span>;</span><br><span class="line">        <span class="number">4&#x27;d2</span>: y[<span class="number">7</span>:<span class="number">1</span>]=<span class="number">7&#x27;b0010010</span>;</span><br><span class="line">        <span class="number">4&#x27;d3</span> : y[<span class="number">7</span>:<span class="number">1</span>]=<span class="number">7&#x27;b0000110</span>;</span><br><span class="line">        <span class="number">4&#x27;d4</span> : y[<span class="number">7</span>:<span class="number">1</span>]=<span class="number">7&#x27;b1001100</span>;</span><br><span class="line">        <span class="number">4&#x27;d5</span>: y[<span class="number">7</span>:<span class="number">1</span>]=<span class="number">7&#x27;b0100100</span>;</span><br><span class="line">        <span class="number">4&#x27;d6</span>: y[<span class="number">7</span>:<span class="number">1</span>]=<span class="number">7&#x27;b0100000</span>;</span><br><span class="line">        <span class="number">4&#x27;d7</span> : y[<span class="number">7</span>:<span class="number">1</span>]=<span class="number">7&#x27;b0001111</span>;</span><br><span class="line">        <span class="number">4&#x27;d8</span> : y[<span class="number">7</span>:<span class="number">1</span>]=<span class="number">7&#x27;b0000000</span>;</span><br><span class="line">        <span class="number">4&#x27;d9</span> : y[<span class="number">7</span>:<span class="number">1</span>]=<span class="number">7&#x27;b0000100</span>;</span><br><span class="line">        <span class="number">4&#x27;d10</span> : y[<span class="number">7</span>:<span class="number">1</span>]=<span class="number">7&#x27;b0001000</span>;</span><br><span class="line">        <span class="number">4&#x27;d11</span> : y[<span class="number">7</span>:<span class="number">1</span>]=<span class="number">7&#x27;b1100000</span>;</span><br><span class="line">        <span class="number">4&#x27;d12</span> : y[<span class="number">7</span>:<span class="number">1</span>]=<span class="number">7&#x27;b0110001</span>;</span><br><span class="line">        <span class="number">4&#x27;d13</span> : y[<span class="number">7</span>:<span class="number">1</span>]=<span class="number">7&#x27;b1000010</span>;</span><br><span class="line">        <span class="number">4&#x27;d14</span> : y[<span class="number">7</span>:<span class="number">1</span>]=<span class="number">7&#x27;b0110000</span>;</span><br><span class="line">        <span class="number">4&#x27;d15</span> : y[<span class="number">7</span>:<span class="number">1</span>]=<span class="number">7&#x27;b0111000</span>;      </span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line"> <span class="keyword">end</span> </span><br><span class="line"> <span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>然而实际上我们用到的数码管是多个合在一起的</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231091845529.png" class title="image-20231231091845529">
<p>还会有引脚来选择控制哪个数码管</p>
<p>如果想让一个模块中的两个数码管都点亮，并且显示不同的数字，那么就需要利用<strong>人眼的暂留效应</strong>，对每个要显示的数码管进行动态扫描</p>
<p>即在极短得到时间（小于200ms）内，依次循环显示</p>
<h1 id="时序逻辑电路设计">时序逻辑电路设计</h1>
<p>理解什么是同步异步设计</p>
<p>理解阻塞赋值和非阻塞赋值区别</p>
<p>掌握<strong>计数器和秒表</strong>的设计</p>
<p>掌握<strong>数码管扫描显示电路</strong>的设计</p>
<h2 id="触发器和锁存器">触发器和锁存器</h2>
<h3 id="时序逻辑-1">时序逻辑</h3>
<p>数电课程中：根据一个电路<strong>是否具有记忆功能</strong>，可将数字逻辑电路分为组合逻辑电路和时序逻辑电路两种类型</p>
<p>如果一个逻辑电路在任何时刻的稳定<strong>输出仅取决于该时刻的输入</strong>，而与电路过去的输入<strong>无关</strong>，则称<strong>组合逻辑电路</strong>(Combinational
Logic Circuit)</p>
<p>如果一个逻辑电路在任何时刻的稳定输出<strong>不仅取决于该时刻的输入，而且与过去的输入相关，</strong>则称为<strong>时序逻辑电路</strong>(Sequential
Logic Circuit)</p>
<p><br></p>
<p>时序电路是一种能够记忆电路内部状态的电路</p>
<p>触发器的触发信号常为<strong>时钟</strong>或者<strong>复位</strong>信号的边沿触发</p>
<p>锁存器的触发信号是<strong>电平触发</strong></p>
<p><code>always@ (posedge  clk or negedge reset)</code> 或
<code>always@(clk)</code></p>
<h3 id="d触发器">D触发器</h3>
<p>D触发器（DFF，D type
Flip-Flop）是时序逻辑电路中<strong>最基本的存储元件</strong></p>
<p>上升沿触发（不带异步复位信号）的D触发器是最简单的D触发器</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231092630673.png" class title="image-20231231092630673">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231092909319.png" class title="image-20231231092909319">
<h3 id="例子含异步复位的d触发器">例子：含异步复位的D触发器</h3>
<p>D触发器可以包含异步复位信号，同步/异步指的就是是否独立于时钟信号</p>
<p>同步指不独立于时钟信号，被时钟控制</p>
<p>异步指独立于时钟信号</p>
<p><br></p>
<p>复位信号reset能够在任意时刻复位D触发器，而不受时钟信号控制，不用等时钟边沿</p>
<p>复位信号和时钟信号都写在敏感列表中即是异步复位设计了</p>
<p><br></p>
<p>敏感信号列表：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always</span>@(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">posedge</span> reset )   </span><br><span class="line"><span class="keyword">always</span>@(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> reset )     <span class="comment">//最常见写法，但行业内已经不建议异步设计了</span></span><br></pre></td></tr></table></figure>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231093214622.png" class title="image-20231231093214622">
<p>reset信号肯定是优先于clk的，所以先判断reset的值</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Dff_rst(clk, d, reset, q);</span><br><span class="line">    <span class="keyword">input</span> d,clk,reset;</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> q;</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">posedge</span> reset) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(reset) q&lt;=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span>	q&lt;=d;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h3 id="例子含异步复位和同步使能的d触发器">例子：含异步复位和同步使能的D触发器</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231093849044.png" class title="image-20231231093849044">
<p>先判断reset的值</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231093953161.png" class title="image-20231231093953161">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Dff_rst_en(clk,d,rst,en,q);</span><br><span class="line"><span class="keyword">input</span>  clk, d, rst, en;</span><br><span class="line"><span class="keyword">output</span> <span class="keyword">reg</span>  q ;</span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">posedge</span> rst)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span>(rst)             q&lt;=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(en)       q&lt;=d;</span><br><span class="line">    <span class="keyword">end</span> </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>“CE”经常作为“Chip Enable”的缩写</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231094042459.png" class title="image-20231231094042459">
<p>时序逻辑不用考虑所有情况，因为我们<strong>需要他产生锁存器</strong></p>
<p>代码中没有描述<code>en=0</code>的行为，则保持先前的值，省略的else分支描述了这个触发器的预期行为</p>
<p>无论写不写省略的else分支，结果都是一样的</p>
<p><br></p>
<p>含异步复位和同步使能的D触发器也可以由一个异步复位D触发器和一个多路选择器构成</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231095911885.png" class title="image-20231231095911885">
<p>en输入接到多路选择器</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Dff_reset_en (clk,reset,en,d_in,q); </span><br><span class="line"><span class="keyword">input</span>  clk,reset,en,d_in;</span><br><span class="line"><span class="keyword">output</span>  <span class="keyword">reg</span>  q;  </span><br><span class="line"><span class="keyword">reg</span> r_reg, r_next; <span class="comment">//中间变量</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">posedge</span> reset) <span class="comment">//D触发器</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">     <span class="keyword">if</span> (reset)   r_reg &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">     <span class="keyword">else</span>           r_reg &lt;= r_next;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">always</span> @*      <span class="keyword">begin</span> <span class="comment">//选择电路</span></span><br><span class="line">   <span class="keyword">if</span> (en)  r_next = d_in;</span><br><span class="line">   <span class="keyword">else</span>      r_next = r_reg;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">always</span> @*      <span class="comment">//输出电路</span></span><br><span class="line">   q = r_reg;   </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h3 id="同步设计">同步设计</h3>
<p>异步电路设计没有统一的时钟，状态变化的时刻是不稳定的，通常输入信号只在电路处于稳定状态时才发生变化。主要应用于执行系统初始化。例如在打开系统电源之后，可以生成一个短的复位脉冲迫使系统进入初始状态</p>
<p>同步电路设计其所有操作都是在严格的时钟控制下完成的。所有的状态变化都是在时钟的上升沿（或下降沿）完成的</p>
<p>时序逻辑电路设计中非必须情况下<strong>不建议使用异步设计</strong></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always</span>@(<span class="keyword">posedge</span> clk)</span><br><span class="line">	<span class="keyword">if</span>(rst)  q&lt;=<span class="number">1</span>’b0;</span><br><span class="line">	<span class="keyword">else</span> q&lt;=d;</span><br></pre></td></tr></table></figure>
<p>如果把复位信号写到时钟always里，就是同步复位了</p>
<h3 id="基本锁存器">基本锁存器</h3>
<p>注意：锁存器是用时钟高电平的，<strong>并不是时钟边缘</strong>，所以后面always块的敏感信号就是<code>always @(clk)</code>，而不是刚刚D触发器写过的<code>posedge clk或posedge clk</code></p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231100706941.png" class title="image-20231231100706941">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231100806538.png" class title="image-20231231100806538">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231100945768.png" class title="image-20231231100945768">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231101139424.png" class title="image-20231231101139424">
<p>解决锁存器说到底还是分支和初值</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231101228241.png" class title="image-20231231101228241">
<p>写法区别</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231101248539.png" class title="image-20231231101248539">
<h3 id="含清零控制的锁存器">含清零控制的锁存器</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Latch(clk, d, rst,q);</span><br><span class="line"><span class="keyword">input</span>  clk, d, rst;</span><br><span class="line"><span class="keyword">output</span> <span class="keyword">reg</span>  q ;</span><br><span class="line">    <span class="keyword">always</span> @(clk,d,rst)		<span class="comment">//不是posedge clk和negedge clk</span></span><br><span class="line">       <span class="keyword">if</span>(!rst)<span class="comment">//低复位</span></span><br><span class="line">           q&lt;=<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">else</span> <span class="keyword">if</span>(clk)</span><br><span class="line">           q&lt;=d;</span><br><span class="line"> <span class="keyword">endmodule</span> </span><br></pre></td></tr></table></figure>
<h4 id="锁存器和触发器的区别">锁存器和触发器的区别</h4>
<p>最主要的区别就是：触发器是时钟边沿触发，锁存器是电平触发</p>
<p>但是能用触发器就用触发器</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231101804413.png" class title="image-20231231101804413">
<h2 id="寄存器">寄存器</h2>
<p>通常把能够用来存储<strong>一组二进制信息</strong>的同步时序逻辑电路称为寄存器。常用触发器的<strong>边沿触发型</strong></p>
<p>寄存器是构成时序逻辑最重要的一个单元，可以说没有寄存器就没有时序逻辑。寄存器是由触发器组成的，一个触发器可以组成一个一位的寄存器，多个触发器可以组成一个多位的寄存器</p>
<h3 id="寄存器作用">寄存器作用</h3>
<p>缓冲，串并转换，计数器，显示数据锁存器</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231101943756.png" class title="image-20231231101943756">
<h3 id="例子1位寄存器">例子：1位寄存器</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231102056305.png" class title="image-20231231102056305">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span>	reg_1(In_data, clk, load, reset, Out_data);</span><br><span class="line">    <span class="keyword">input</span> In_data,clk,load,reset;</span><br><span class="line">    <span class="keyword">output</span> Out_data;</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">posedge</span> reset)	<span class="comment">//异步复位</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span>(reset)	Out_data &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(load)	Out_data &lt;= In_data;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="例子4级的1位串联寄存器">例子：4级的1位串联寄存器</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231102516012.png" class title="image-20231231102516012">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> shfit_reg(</span><br><span class="line"> <span class="keyword">input</span> sys_clk, <span class="comment">//50M 系统时钟</span></span><br><span class="line"> <span class="keyword">input</span> sys_rst_n, <span class="comment">//全局复位</span></span><br><span class="line"> <span class="keyword">input</span> a, <span class="comment">//输入 a </span></span><br><span class="line"> <span class="keyword">output</span> y <span class="comment">//输出 y</span></span><br><span class="line"> ); </span><br><span class="line"> <span class="keyword">reg</span> a_reg1; <span class="comment">//寄存器 1</span></span><br><span class="line"> <span class="keyword">reg</span> a_reg2; <span class="comment">//寄存器 2</span></span><br><span class="line"> <span class="keyword">reg</span> a_reg3; <span class="comment">//寄存器 3</span></span><br><span class="line"> <span class="keyword">reg</span> a_reg4; <span class="comment">//寄存器 4</span></span><br><span class="line"><span class="keyword">always</span>@(<span class="keyword">posedge</span> sys_clk <span class="keyword">or</span> <span class="keyword">negedge</span> sys_rst_n) </span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">     <span class="keyword">if</span>(!sys_rst_n)<span class="keyword">begin</span></span><br><span class="line">         a_reg1 &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">         a_reg2 &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">         a_reg3 &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">         a_reg4 &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">         a_reg1 &lt;= a;</span><br><span class="line">         a_reg2 &lt;= a_reg1;</span><br><span class="line">         a_reg3 &lt;= a_reg2;</span><br><span class="line">         a_reg4 &lt;= a_reg3;</span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> y = a_reg4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>对应的testbench</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> tb_shfit_reg(); </span><br><span class="line"><span class="keyword">reg</span> sys_clk;</span><br><span class="line"><span class="keyword">reg</span> sys_rst_n;</span><br><span class="line"><span class="keyword">reg</span> a; </span><br><span class="line"><span class="keyword">wire</span> y;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">    sys_clk = <span class="number">1&#x27;b1</span>; </span><br><span class="line">    sys_rst_n = <span class="number">1&#x27;b0</span>; </span><br><span class="line">    a = <span class="number">1&#x27;b0</span>; </span><br><span class="line">    #<span class="number">206</span></span><br><span class="line">    sys_rst_n = <span class="number">1&#x27;b1</span>;</span><br><span class="line">    #<span class="number">100</span></span><br><span class="line">    a = <span class="number">1&#x27;b1</span>;</span><br><span class="line">    #<span class="number">100</span></span><br><span class="line">    a = <span class="number">1&#x27;b0</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> #<span class="number">10</span> sys_clk = ~sys_clk;</span><br><span class="line"></span><br><span class="line">shfit_reg shfit_reg_inst(</span><br><span class="line"><span class="variable">.sys_clk</span> (sys_clk ),</span><br><span class="line"><span class="variable">.sys_rst_n</span> (sys_rst_n ),</span><br><span class="line"><span class="variable">.a</span> (a ), </span><br><span class="line"><span class="variable">.y</span> (y )</span><br><span class="line">);</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231102727523.png" class title="image-20231231102727523">
<h3 id="例子n位寄存器">例子：N位寄存器</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231102957583.png" class title="image-20231231102957583">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> reg_N <span class="variable">#( parameter N=8)</span></span><br><span class="line">   (clk,rst,load,in_data,out_data);</span><br><span class="line"><span class="keyword">input</span>  clk, rst,load;</span><br><span class="line"><span class="keyword">input</span> [N-<span class="number">1</span>:<span class="number">0</span>] in_data;</span><br><span class="line"><span class="keyword">output</span> <span class="keyword">reg</span> [N-<span class="number">1</span>:<span class="number">0</span>] out_data;</span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">posedge</span> rst)</span><br><span class="line">      <span class="keyword">if</span>(rst)          out_data &lt;= <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span>(load)    out_data &lt;= in_data;</span><br><span class="line"><span class="keyword">endmodule</span>  </span><br></pre></td></tr></table></figure>
<h3 id="例子寄存器组">例子：寄存器组</h3>
<p>寄存器组是由一组拥有同一个输入端口和一个或多个输出端口的寄存器组成</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231103348509.png" class title="image-20231231103348509">
<p>一共有<span class="math inline">\(2^W\)</span>个地址</p>
<p>每一个地址对应<span class="math inline">\(N\)</span>位数据</p>
<p>地址线位宽为<code>W</code>，所以变量定义<code>W</code>位</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231103510563.png" class title="image-20231231103510563">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231104213207.png" class title="image-20231231104213207">
<p>采用了同步写入，异步读出的形式</p>
<p>同步写入，指在时钟信号的控制下写入，体现在代码中就是<code>always @(posedge clk )</code></p>
<p>异步读出，指随时都能读，体现在代码中就是<code>assign r_data = array_reg[r_addr];</code></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Regs <span class="variable">#( parameter N=8,  W=2)</span></span><br><span class="line"> (clk, wr_en, wr_addr, r_addr, wr_data, r_data );</span><br><span class="line"><span class="keyword">input</span>  clk, wr_en;</span><br><span class="line"><span class="keyword">input</span> [W-<span class="number">1</span>:<span class="number">0</span>]  wr_addr, r_addr;</span><br><span class="line"><span class="keyword">input</span> [N-<span class="number">1</span>:<span class="number">0</span>] wr_data;</span><br><span class="line"><span class="keyword">output</span> [N-<span class="number">1</span>:<span class="number">0</span>] r_data;</span><br><span class="line"><span class="keyword">reg</span> [N-<span class="number">1</span>:<span class="number">0</span>] array_reg [<span class="number">2</span>**W-<span class="number">1</span>:<span class="number">0</span>];</span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk )</span><br><span class="line">   <span class="keyword">if</span>(wr_en)</span><br><span class="line">    array_reg[wr_addr] &lt;= wr_data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> r_data=array_reg[r_addr];</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span> </span><br></pre></td></tr></table></figure>
<h3 id="例子寄存器堆">例子：寄存器堆</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231153609150.png" class title="image-20231231153609150">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231153625763.png" class title="image-20231231153625763">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231153645311.png" class title="image-20231231153645311">
<p>图一乐就行</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//https://highlightcode.com/</span></span><br><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> regfile(</span><br><span class="line">    <span class="keyword">input</span>             clk,      <span class="comment">//时钟</span></span><br><span class="line">    <span class="keyword">input</span>             wen,      <span class="comment">//写使能</span></span><br><span class="line">    <span class="keyword">input</span>      [<span class="number">4</span> :<span class="number">0</span>] raddr1,   <span class="comment">//5位读地址</span></span><br><span class="line">    <span class="keyword">input</span>      [<span class="number">4</span> :<span class="number">0</span>] raddr2,   <span class="comment">//5位读地址</span></span><br><span class="line">    <span class="keyword">input</span>      [<span class="number">4</span> :<span class="number">0</span>] waddr,    <span class="comment">//5位写地址</span></span><br><span class="line">    <span class="keyword">input</span>      [<span class="number">31</span>:<span class="number">0</span>] wdata,    <span class="comment">//写入的数据</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] rdata1,   <span class="comment">//raddr1读出的数据</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] rdata2,   <span class="comment">//raddr2读出的数据</span></span><br><span class="line">    <span class="keyword">input</span>      [<span class="number">4</span> :<span class="number">0</span>] test_addr,<span class="comment">//测试的地址</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] test_data <span class="comment">//测试地址读出的数据</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] rf[<span class="number">31</span>:<span class="number">0</span>];        <span class="comment">//构建32个32位的寄存器堆</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">// three ported register file</span></span><br><span class="line">    <span class="comment">// read two ports combinationally 异步读</span></span><br><span class="line">    <span class="comment">// write third port on rising edge of clock 同步写</span></span><br><span class="line">    <span class="comment">// register 0 hardwired to 0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk)    <span class="keyword">begin</span> <span class="comment">//时序逻辑写入数据</span></span><br><span class="line">        <span class="keyword">if</span> (wen)    <span class="keyword">begin</span></span><br><span class="line">            rf[waddr] &lt;= wdata;   <span class="comment">//将数据写入对应的地址</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">//读端口1，使用组合逻辑设计</span></span><br><span class="line">    <span class="keyword">always</span> @(*)    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (raddr1)<span class="comment">//判断地址，把对应位置的数据给rdata1</span></span><br><span class="line">            <span class="number">5&#x27;d1</span> : rdata1 &lt;= rf[<span class="number">1</span> ];</span><br><span class="line">            <span class="number">5&#x27;d2</span> : rdata1 &lt;= rf[<span class="number">2</span> ];</span><br><span class="line">            <span class="number">5&#x27;d3</span> : rdata1 &lt;= rf[<span class="number">3</span> ];</span><br><span class="line">            <span class="number">5&#x27;d4</span> : rdata1 &lt;= rf[<span class="number">4</span> ];</span><br><span class="line">            <span class="number">5&#x27;d5</span> : rdata1 &lt;= rf[<span class="number">5</span> ];</span><br><span class="line">            <span class="number">5&#x27;d6</span> : rdata1 &lt;= rf[<span class="number">6</span> ];</span><br><span class="line">            <span class="number">5&#x27;d7</span> : rdata1 &lt;= rf[<span class="number">7</span> ];</span><br><span class="line">            <span class="number">5&#x27;d8</span> : rdata1 &lt;= rf[<span class="number">8</span> ];</span><br><span class="line">            <span class="number">5&#x27;d9</span> : rdata1 &lt;= rf[<span class="number">9</span> ];</span><br><span class="line">            <span class="number">5&#x27;d10</span>: rdata1 &lt;= rf[<span class="number">10</span>];</span><br><span class="line">            <span class="number">5&#x27;d11</span>: rdata1 &lt;= rf[<span class="number">11</span>];</span><br><span class="line">            <span class="number">5&#x27;d12</span>: rdata1 &lt;= rf[<span class="number">12</span>];</span><br><span class="line">            <span class="number">5&#x27;d13</span>: rdata1 &lt;= rf[<span class="number">13</span>];</span><br><span class="line">            <span class="number">5&#x27;d14</span>: rdata1 &lt;= rf[<span class="number">14</span>];</span><br><span class="line">            <span class="number">5&#x27;d15</span>: rdata1 &lt;= rf[<span class="number">15</span>];</span><br><span class="line">            <span class="number">5&#x27;d16</span>: rdata1 &lt;= rf[<span class="number">16</span>];</span><br><span class="line">            <span class="number">5&#x27;d17</span>: rdata1 &lt;= rf[<span class="number">17</span>];</span><br><span class="line">            <span class="number">5&#x27;d18</span>: rdata1 &lt;= rf[<span class="number">18</span>];</span><br><span class="line">            <span class="number">5&#x27;d19</span>: rdata1 &lt;= rf[<span class="number">19</span>];</span><br><span class="line">            <span class="number">5&#x27;d20</span>: rdata1 &lt;= rf[<span class="number">20</span>];</span><br><span class="line">            <span class="number">5&#x27;d21</span>: rdata1 &lt;= rf[<span class="number">21</span>];</span><br><span class="line">            <span class="number">5&#x27;d22</span>: rdata1 &lt;= rf[<span class="number">22</span>];</span><br><span class="line">            <span class="number">5&#x27;d23</span>: rdata1 &lt;= rf[<span class="number">23</span>];</span><br><span class="line">            <span class="number">5&#x27;d24</span>: rdata1 &lt;= rf[<span class="number">24</span>];</span><br><span class="line">            <span class="number">5&#x27;d25</span>: rdata1 &lt;= rf[<span class="number">25</span>];</span><br><span class="line">            <span class="number">5&#x27;d26</span>: rdata1 &lt;= rf[<span class="number">26</span>];</span><br><span class="line">            <span class="number">5&#x27;d27</span>: rdata1 &lt;= rf[<span class="number">27</span>];</span><br><span class="line">            <span class="number">5&#x27;d28</span>: rdata1 &lt;= rf[<span class="number">28</span>];</span><br><span class="line">            <span class="number">5&#x27;d29</span>: rdata1 &lt;= rf[<span class="number">29</span>];</span><br><span class="line">            <span class="number">5&#x27;d30</span>: rdata1 &lt;= rf[<span class="number">30</span>];</span><br><span class="line">            <span class="number">5&#x27;d31</span>: rdata1 &lt;= rf[<span class="number">31</span>];</span><br><span class="line">            <span class="keyword">default</span> : rdata1 &lt;= <span class="number">32&#x27;d0</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">//读端口2</span></span><br><span class="line">    <span class="keyword">always</span> @(*)    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (raddr2)</span><br><span class="line">            <span class="number">5&#x27;d1</span> : rdata2 &lt;= rf[<span class="number">1</span> ];</span><br><span class="line">            <span class="number">5&#x27;d2</span> : rdata2 &lt;= rf[<span class="number">2</span> ];</span><br><span class="line">            <span class="number">5&#x27;d3</span> : rdata2 &lt;= rf[<span class="number">3</span> ];</span><br><span class="line">            <span class="number">5&#x27;d4</span> : rdata2 &lt;= rf[<span class="number">4</span> ];</span><br><span class="line">            <span class="number">5&#x27;d5</span> : rdata2 &lt;= rf[<span class="number">5</span> ];</span><br><span class="line">            <span class="number">5&#x27;d6</span> : rdata2 &lt;= rf[<span class="number">6</span> ];</span><br><span class="line">            <span class="number">5&#x27;d7</span> : rdata2 &lt;= rf[<span class="number">7</span> ];</span><br><span class="line">            <span class="number">5&#x27;d8</span> : rdata2 &lt;= rf[<span class="number">8</span> ];</span><br><span class="line">            <span class="number">5&#x27;d9</span> : rdata2 &lt;= rf[<span class="number">9</span> ];</span><br><span class="line">            <span class="number">5&#x27;d10</span>: rdata2 &lt;= rf[<span class="number">10</span>];</span><br><span class="line">            <span class="number">5&#x27;d11</span>: rdata2 &lt;= rf[<span class="number">11</span>];</span><br><span class="line">            <span class="number">5&#x27;d12</span>: rdata2 &lt;= rf[<span class="number">12</span>];</span><br><span class="line">            <span class="number">5&#x27;d13</span>: rdata2 &lt;= rf[<span class="number">13</span>];</span><br><span class="line">            <span class="number">5&#x27;d14</span>: rdata2 &lt;= rf[<span class="number">14</span>];</span><br><span class="line">            <span class="number">5&#x27;d15</span>: rdata2 &lt;= rf[<span class="number">15</span>];</span><br><span class="line">            <span class="number">5&#x27;d16</span>: rdata2 &lt;= rf[<span class="number">16</span>];</span><br><span class="line">            <span class="number">5&#x27;d17</span>: rdata2 &lt;= rf[<span class="number">17</span>];</span><br><span class="line">            <span class="number">5&#x27;d18</span>: rdata2 &lt;= rf[<span class="number">18</span>];</span><br><span class="line">            <span class="number">5&#x27;d19</span>: rdata2 &lt;= rf[<span class="number">19</span>];</span><br><span class="line">            <span class="number">5&#x27;d20</span>: rdata2 &lt;= rf[<span class="number">20</span>];</span><br><span class="line">            <span class="number">5&#x27;d21</span>: rdata2 &lt;= rf[<span class="number">21</span>];</span><br><span class="line">            <span class="number">5&#x27;d22</span>: rdata2 &lt;= rf[<span class="number">22</span>];</span><br><span class="line">            <span class="number">5&#x27;d23</span>: rdata2 &lt;= rf[<span class="number">23</span>];</span><br><span class="line">            <span class="number">5&#x27;d24</span>: rdata2 &lt;= rf[<span class="number">24</span>];</span><br><span class="line">            <span class="number">5&#x27;d25</span>: rdata2 &lt;= rf[<span class="number">25</span>];</span><br><span class="line">            <span class="number">5&#x27;d26</span>: rdata2 &lt;= rf[<span class="number">26</span>];</span><br><span class="line">            <span class="number">5&#x27;d27</span>: rdata2 &lt;= rf[<span class="number">27</span>];</span><br><span class="line">            <span class="number">5&#x27;d28</span>: rdata2 &lt;= rf[<span class="number">28</span>];</span><br><span class="line">            <span class="number">5&#x27;d29</span>: rdata2 &lt;= rf[<span class="number">29</span>];</span><br><span class="line">            <span class="number">5&#x27;d30</span>: rdata2 &lt;= rf[<span class="number">30</span>];</span><br><span class="line">            <span class="number">5&#x27;d31</span>: rdata2 &lt;= rf[<span class="number">31</span>];</span><br><span class="line">            <span class="keyword">default</span> : rdata2 &lt;= <span class="number">32&#x27;d0</span>;<span class="comment">//0号寄存器读出的值恒为0</span></span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">     <span class="comment">//调试端口，读出寄存器值显示在触摸屏上</span></span><br><span class="line">    <span class="keyword">always</span> @(*)    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (test_addr)</span><br><span class="line">            <span class="number">5&#x27;d1</span> : test_data &lt;= rf[<span class="number">1</span> ];</span><br><span class="line">            <span class="number">5&#x27;d2</span> : test_data &lt;= rf[<span class="number">2</span> ];</span><br><span class="line">            <span class="number">5&#x27;d3</span> : test_data &lt;= rf[<span class="number">3</span> ];</span><br><span class="line">            <span class="number">5&#x27;d4</span> : test_data &lt;= rf[<span class="number">4</span> ];</span><br><span class="line">            <span class="number">5&#x27;d5</span> : test_data &lt;= rf[<span class="number">5</span> ];</span><br><span class="line">            <span class="number">5&#x27;d6</span> : test_data &lt;= rf[<span class="number">6</span> ];</span><br><span class="line">            <span class="number">5&#x27;d7</span> : test_data &lt;= rf[<span class="number">7</span> ];</span><br><span class="line">            <span class="number">5&#x27;d8</span> : test_data &lt;= rf[<span class="number">8</span> ];</span><br><span class="line">            <span class="number">5&#x27;d9</span> : test_data &lt;= rf[<span class="number">9</span> ];</span><br><span class="line">            <span class="number">5&#x27;d10</span>: test_data &lt;= rf[<span class="number">10</span>];</span><br><span class="line">            <span class="number">5&#x27;d11</span>: test_data &lt;= rf[<span class="number">11</span>];</span><br><span class="line">            <span class="number">5&#x27;d12</span>: test_data &lt;= rf[<span class="number">12</span>];</span><br><span class="line">            <span class="number">5&#x27;d13</span>: test_data &lt;= rf[<span class="number">13</span>];</span><br><span class="line">            <span class="number">5&#x27;d14</span>: test_data &lt;= rf[<span class="number">14</span>];</span><br><span class="line">            <span class="number">5&#x27;d15</span>: test_data &lt;= rf[<span class="number">15</span>];</span><br><span class="line">            <span class="number">5&#x27;d16</span>: test_data &lt;= rf[<span class="number">16</span>];</span><br><span class="line">            <span class="number">5&#x27;d17</span>: test_data &lt;= rf[<span class="number">17</span>];</span><br><span class="line">            <span class="number">5&#x27;d18</span>: test_data &lt;= rf[<span class="number">18</span>];</span><br><span class="line">            <span class="number">5&#x27;d19</span>: test_data &lt;= rf[<span class="number">19</span>];</span><br><span class="line">            <span class="number">5&#x27;d20</span>: test_data &lt;= rf[<span class="number">20</span>];</span><br><span class="line">            <span class="number">5&#x27;d21</span>: test_data &lt;= rf[<span class="number">21</span>];</span><br><span class="line">            <span class="number">5&#x27;d22</span>: test_data &lt;= rf[<span class="number">22</span>];</span><br><span class="line">            <span class="number">5&#x27;d23</span>: test_data &lt;= rf[<span class="number">23</span>];</span><br><span class="line">            <span class="number">5&#x27;d24</span>: test_data &lt;= rf[<span class="number">24</span>];</span><br><span class="line">            <span class="number">5&#x27;d25</span>: test_data &lt;= rf[<span class="number">25</span>];</span><br><span class="line">            <span class="number">5&#x27;d26</span>: test_data &lt;= rf[<span class="number">26</span>];</span><br><span class="line">            <span class="number">5&#x27;d27</span>: test_data &lt;= rf[<span class="number">27</span>];</span><br><span class="line">            <span class="number">5&#x27;d28</span>: test_data &lt;= rf[<span class="number">28</span>];</span><br><span class="line">            <span class="number">5&#x27;d29</span>: test_data &lt;= rf[<span class="number">29</span>];</span><br><span class="line">            <span class="number">5&#x27;d30</span>: test_data &lt;= rf[<span class="number">30</span>];</span><br><span class="line">            <span class="number">5&#x27;d31</span>: test_data &lt;= rf[<span class="number">31</span>];</span><br><span class="line">            <span class="keyword">default</span> : test_data &lt;= <span class="number">32&#x27;d0</span>;<span class="comment">//0号寄存器读出的值恒为0</span></span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h2 id="移位寄存器">移位寄存器</h2>
<h3 id="例子具有同步预置功能的8位移位寄存器">例子：具有同步预置功能的8位移位寄存器</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231154020462.png" class title="image-20231231154020462">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Shift_regs(</span><br><span class="line"><span class="keyword">input</span>  clk, load,</span><br><span class="line"><span class="keyword">input</span> [<span class="number">7</span>:<span class="number">0</span>]  din,</span><br><span class="line"><span class="keyword">output</span> qb </span><br><span class="line">);  </span><br><span class="line"><span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] reg8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk )</span><br><span class="line">      <span class="keyword">if</span>(load)</span><br><span class="line">              reg8 &lt;= din;</span><br><span class="line">      <span class="keyword">else</span> </span><br><span class="line">              reg8[<span class="number">6</span>:<span class="number">0</span>] &lt;= reg8[<span class="number">7</span>:<span class="number">1</span>];</span><br><span class="line">		  <span class="comment">//reg8 &lt;= (reg8 &gt;&gt; 1);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> qb = reg8[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span> </span><br></pre></td></tr></table></figure>
<h3 id="例子8位通用移位寄存器">例子：8位通用移位寄存器</h3>
<p>​ <img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231154303267.png" class title="image-20231231154303267"></p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231154352617.png" class title="image-20231231154352617">
<p>循环位移</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Univ_shift_reg  #(<span class="keyword">parameter</span> N=<span class="number">8</span>) (</span><br><span class="line"><span class="keyword">input</span>  clk, rst,</span><br><span class="line"><span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] ctrl,</span><br><span class="line"><span class="keyword">input</span> [N-<span class="number">1</span>:<span class="number">0</span>]  din,</span><br><span class="line"><span class="keyword">output</span> qb</span><br><span class="line">);</span><br><span class="line"><span class="keyword">reg</span> [N-<span class="number">1</span>:<span class="number">0</span>] cs, nst; </span><br><span class="line"> <span class="comment">//先写时序逻辑</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst )</span><br><span class="line">    <span class="keyword">if</span>(!rst)</span><br><span class="line">        cs &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">        cs &lt;= nst;</span><br><span class="line"><span class="comment">//组合逻辑电路</span></span><br><span class="line"><span class="keyword">always</span> @*</span><br><span class="line">    <span class="keyword">case</span>(ctrl)</span><br><span class="line">        <span class="number">2</span>’b00: nst = cs;<span class="comment">//保持</span></span><br><span class="line">        <span class="number">2</span>’b01: nst = &#123;cs[N-<span class="number">2</span>:<span class="number">0</span>],din[<span class="number">0</span>]&#125;; <span class="comment">//左移</span></span><br><span class="line">        <span class="number">2</span>’b10: nst = &#123;din[N-<span class="number">1</span>],cs[N-<span class="number">1</span>:<span class="number">1</span>]&#125;;  <span class="comment">//右移                         </span></span><br><span class="line">        <span class="keyword">default</span>: nst = din;<span class="comment">//载入</span></span><br><span class="line">     <span class="keyword">endcase</span>    </span><br><span class="line">   </span><br><span class="line"><span class="comment">//输出逻辑：组合逻辑电路。</span></span><br><span class="line"><span class="keyword">assign</span> qb = cs[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="计数器">计数器</h2>
<p>很重要</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231160657328.png" class title="image-20231231160657328">
<h3 id="例子简单的二进制计数器">例子：简单的二进制计数器</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231160733439.png" class title="image-20231231160733439">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span>	Counter_sim #(<span class="keyword">parameter</span> N=<span class="number">4</span>) (clk, rst, cout);</span><br><span class="line">    <span class="keyword">input</span> clk, rst;</span><br><span class="line">    <span class="keyword">output</span> cout;</span><br><span class="line">    <span class="keyword">reg</span> [N-<span class="number">1</span>:<span class="number">0</span>] cnt;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(rst)	cnt &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span>	cnt &lt;= cnt + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">assign</span> cout = (cnt==<span class="number">2</span>**N - <span class="number">1</span>)?<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h3 id="例子通用的二进制计数器">例子：通用的二进制计数器</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231161152823.png" class title="image-20231231161152823">
<p>可以再接一个cout输出</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Counter_univ  #(<span class="keyword">parameter</span> N=<span class="number">4</span>)(</span><br><span class="line"><span class="keyword">input</span>  clk, rst,load,up_down,pause,</span><br><span class="line"><span class="keyword">input</span> [N-<span class="number">1</span>:<span class="number">0</span>] din,</span><br><span class="line"><span class="keyword">output</span> [N-<span class="number">1</span>:<span class="number">0</span>] cout</span><br><span class="line">);  </span><br><span class="line"><span class="keyword">reg</span> [N-<span class="number">1</span>:<span class="number">0</span>] cnt;</span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk )  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(rst)                 cnt &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(load)           cnt &lt;= din;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(pause)          cnt &lt;= cnt;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(up_down)        cnt &lt;= cnt + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span>                    cnt &lt;= cnt - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">assign</span> cout = cnt;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h3 id="例子模m计数器">例子：模M计数器</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231161410156.png" class title="image-20231231161410156">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231161442919.png" class title="image-20231231161442919">
<p>注意运算：每12个周期产生1个周期的高脉冲，则总周期就是12+1=13</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Counter_sim #(<span class="keyword">parameter</span> N=<span class="number">4</span>, M=<span class="number">13</span>) (clk,rst,cout);</span><br><span class="line"><span class="keyword">input</span>  clk, rst;</span><br><span class="line"><span class="keyword">output</span> cout;</span><br><span class="line"><span class="keyword">reg</span> [N-<span class="number">1</span>:<span class="number">0</span>] cnt;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk)<span class="comment">//用同步复位设计</span></span><br><span class="line">    <span class="keyword">if</span>(rst)     cnt&lt;=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(cnt == M-<span class="number">1</span>)     cnt &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span>  cnt &lt;= cnt + <span class="number">1</span>;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> cout = (cnt == M-<span class="number">1</span>) ? <span class="number">1</span> : <span class="number">0</span>;       </span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>其实不推荐只用一个变量控制周期，因为出现的是两个：一个12，一个1</p>
<p><br></p>
<p><strong>这个最常用，记住格式即可</strong></p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231161635520.png" class title="image-20231231161635520">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Counter_sim </span><br><span class="line">#(<span class="keyword">parameter</span> N=<span class="number">4</span>, M1=<span class="number">12</span>, M2=<span class="number">2</span>) (clk,rst,cout);</span><br><span class="line"><span class="keyword">input</span>  clk, rst;</span><br><span class="line"><span class="keyword">output</span> cout;</span><br><span class="line"><span class="keyword">reg</span> [N-<span class="number">1</span>:<span class="number">0</span>] cnt; </span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk)<span class="comment">//用同步复位设计</span></span><br><span class="line">    <span class="keyword">if</span>(rst)     cnt &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(cnt == M1+M2-<span class="number">1</span>) cnt &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span>  cnt &lt;= cnt+<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> cout = (cnt &lt; M1) ? <span class="number">0</span> : <span class="number">1</span>;        </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>更推荐这样的写法，一个变量M1控制每间隔的周期，一个变量M2控制产生多少周期的高脉冲</p>
<p>注意这里的输出判断：<code>assign cout = (cnt &lt; M1) ? 0 : 1;</code></p>
<p>如果计数值没到，就输出0，如果到了，就输出1</p>
<p>这样更好写程序</p>
<h3 id="例子时钟转换">例子：时钟转换</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231161940536.png" class title="image-20231231161940536">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231161954217.png" class title="image-20231231161954217">
<p>搞清楚对应的时钟周期即可</p>
<p>不知道位数就直接设置为32位，肯定能存下</p>
<p>高电平解决了，现在看1MHZ的周期信号</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231162327483.png" class title="image-20231231162327483">
<p>输入信号是50MHZ，即一个时钟周期为<span class="math inline">\(\dfrac{1}{50\times10^6}=0.05\mu s\)</span></p>
<p>需要的信号是1MHZ，即一个时钟周期为<span class="math inline">\(\dfrac{1}{1\times10^6}=1\mu s\)</span></p>
<p>所以就需要<span class="math inline">\(\dfrac{1\mu s}{0.05\mu
s}=50\)</span>个周期</p>
<p>但是需要产生方波，方波是一半一半，则周期再除2，就是每25周期，产生25周期高脉冲</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Counter_m #(<span class="keyword">parameter</span> M1 = <span class="number">5</span>*<span class="number">10</span>**<span class="number">7</span>,M2 = <span class="number">5</span>*<span class="number">10</span>**<span class="number">6</span>,M3 = <span class="number">25</span>, M4 = <span class="number">25</span>)</span><br><span class="line">    (clk, rst, cout, fq);</span><br><span class="line">    <span class="keyword">input</span> clk,rst;</span><br><span class="line">    <span class="keyword">output</span> cout,fq;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] cnt1,cnt2;			<span class="comment">//其实可以不算位宽，32位基本没问题</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span>		<span class="comment">//记cout的计数器，间隔5*10**7时钟周期输出5*10**6时钟周期的高电平</span></span><br><span class="line">        <span class="keyword">if</span>(rst)	cnt1 &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(cnt1 == M1 + M2 - <span class="number">1</span>) cnt1 &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span>	cnt1 &lt;= cnt1 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span>		<span class="comment">//记fq的计数器，间隔25时钟周期输出25时钟周期的高电平</span></span><br><span class="line">        <span class="keyword">if</span>(rst)	cnt2 &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(cnt2 == M3 + M4 - <span class="number">1</span>) cnt2 &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span>	cnt2 &lt;= cnt2 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">assign</span> cout = (cnt1 &lt; M1)?<span class="number">0</span>:<span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">assign</span> fq = (cnt2 &lt; M3)?<span class="number">0</span>:<span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>对应的testbench</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> TB_Counter_m </span><br><span class="line">#(<span class="keyword">parameter</span> N1=<span class="number">26</span>,M1=<span class="number">5</span>*<span class="number">10</span>**<span class="number">7</span>, M2=<span class="number">5</span>*<span class="number">10</span>**<span class="number">6</span>,N3=<span class="number">6</span>,M3=<span class="number">50</span>);</span><br><span class="line"><span class="keyword">reg</span> clk,rst;</span><br><span class="line"><span class="keyword">wire</span> fq;</span><br><span class="line"><span class="keyword">wire</span> cout; </span><br><span class="line">Counter_m <span class="variable">#(.N1(N1),.N3(N3),.M1(M1),.M2(M2),.M3(M3))</span></span><br><span class="line"> U_Counter_m (<span class="variable">.clk</span>(clk),<span class="variable">.rst</span>(rst),<span class="variable">.fq</span>(fq),<span class="variable">.cout</span>(cout));</span><br><span class="line"><span class="keyword">initial</span>         <span class="keyword">begin</span></span><br><span class="line">        rst=<span class="number">0</span>;</span><br><span class="line">        #<span class="number">2</span> rst=<span class="number">1</span>;</span><br><span class="line">        #<span class="number">2</span> rst=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">end</span>  </span><br><span class="line"><span class="keyword">initial</span>    <span class="keyword">begin</span></span><br><span class="line">        clk=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">forever</span></span><br><span class="line">            #<span class="number">1</span> clk=~clk;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">initial</span></span><br><span class="line">#<span class="number">100000000</span> <span class="built_in">$finish</span>;  <span class="comment">//需很大值</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出也可以用时序逻辑输出</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Counter_m</span><br><span class="line"> #(<span class="keyword">parameter</span> N1=<span class="number">26</span>,M1=<span class="number">5</span>*<span class="number">10</span>**<span class="number">7</span>, M2=<span class="number">5</span>*<span class="number">10</span>**<span class="number">6</span> ,N3=<span class="number">6</span>,M3=<span class="number">50</span>)(</span><br><span class="line"> <span class="keyword">input</span>  clk, rst,</span><br><span class="line"> <span class="keyword">output</span>  <span class="keyword">reg</span> cout,fq</span><br><span class="line"> );</span><br><span class="line"></span><br><span class="line"> <span class="keyword">reg</span> [N1-<span class="number">1</span>:<span class="number">0</span>] count1;</span><br><span class="line"> <span class="keyword">reg</span> [N3-<span class="number">1</span>:<span class="number">0</span>] count2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="comment">// 0~M1+M2-1</span></span><br><span class="line">    <span class="keyword">if</span> (rst)   count1 &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (count1 == M1+M2-<span class="number">1</span>)  count1 &lt;= <span class="number">0</span>;   </span><br><span class="line">    <span class="keyword">else</span>      count1 &lt;= count1 + <span class="number">1</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk)<span class="comment">// 0~M3-1</span></span><br><span class="line">    <span class="keyword">if</span>(rst)  count2 &lt;= <span class="number">0</span>;   </span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(count2 == M3-<span class="number">1</span>)        </span><br><span class="line">             count2 &lt;= <span class="number">0</span>;     </span><br><span class="line">    <span class="keyword">else</span>   count2 &lt;= count2+<span class="number">1</span>;</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line"> <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk)</span><br><span class="line">    <span class="keyword">if</span>(rst)  cout &lt;= <span class="number">0</span>;   </span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(count1 &gt;= M1-<span class="number">1</span> &amp; count1 &lt; M1+M2-<span class="number">1</span>)    cout &lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span>     cout &lt;= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk)</span><br><span class="line">    <span class="keyword">if</span>(rst)  fq &lt;= <span class="number">0</span>;   </span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(count2 &gt;= M3/<span class="number">2</span>-<span class="number">1</span> &amp; count2 &lt; M3-<span class="number">1</span>)      fq &lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span>     fq &lt;= <span class="number">0</span>;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>不推荐，还是推荐刚刚的写法，很固定，很好记</p>
<h2 id="时序逻辑电路设计-1">时序逻辑电路设计</h2>
<h3 id="例子按键边沿检测电路设计">例子：按键边沿检测电路设计</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231165041585.png" class title="image-20231231165041585">
<p>边沿检测电路根据检测边沿的类型一般分为<strong>上升沿检测电路</strong>、<strong>下降沿检测电路</strong>和<strong>双沿检测电路</strong></p>
<p>delay信号：用一个寄存器就行</p>
<p>上升沿：</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231165235712.png" class title="image-20231231165235712">
<p>下降沿：</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231165315604.png" class title="image-20231231165315604">
<p>双沿：</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231165349787.png" class title="image-20231231165349787">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> edge_test(</span><br><span class="line"> <span class="keyword">input</span> sys_clk ,</span><br><span class="line"> <span class="keyword">input</span> sys_rst_n ,</span><br><span class="line"> <span class="keyword">input</span> a ,</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">output</span> a_posedge ,</span><br><span class="line"> <span class="keyword">output</span> a_negedge ,</span><br><span class="line"> <span class="keyword">output</span> a_edge);</span><br><span class="line"></span><br><span class="line"> <span class="keyword">reg</span> a_dly;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">always</span>@(<span class="keyword">posedge</span> sys_clk <span class="keyword">or</span> <span class="keyword">negedge</span> sys_rst_n) <span class="keyword">begin</span></span><br><span class="line"> <span class="keyword">if</span>(!sys_rst_n)</span><br><span class="line"> 	a_dly &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line"> 	a_dly &lt;= a;</span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">assign</span> a_posedge = a &amp; ~a_dly; <span class="comment">//取上升沿</span></span><br><span class="line"> <span class="keyword">assign</span> a_negedge = ~a &amp; a_dly; <span class="comment">//取下降沿</span></span><br><span class="line"> <span class="keyword">assign</span> a_edge = a ^ a_dly ; <span class="comment">//取双沿</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>对应的testbench：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">`<span class="keyword">timescale</span> 1ns / 1ns </span><span class="comment">//仿真单位/仿真精度</span></span><br><span class="line"><span class="keyword">module</span> tb_edge_test();</span><br><span class="line"> <span class="keyword">reg</span> sys_clk ;</span><br><span class="line"> <span class="keyword">reg</span> sys_rst_n ;</span><br><span class="line"> <span class="keyword">reg</span> a ;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">wire</span> a_posedge ;</span><br><span class="line"> <span class="keyword">wire</span> a_negedge ;</span><br><span class="line"> <span class="keyword">wire</span> a_edge ;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line"> sys_clk = <span class="number">1&#x27;b1</span>;</span><br><span class="line"> sys_rst_n &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line"> a &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line"> #<span class="number">201</span> sys_rst_n &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line"> #<span class="number">20</span>  a &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line"> #<span class="number">100</span>  a &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">always</span> #<span class="number">10</span> sys_clk &lt;= ~sys_clk; </span><br><span class="line">  </span><br><span class="line"> edge_test edge_test_inst(</span><br><span class="line"> <span class="variable">.sys_clk</span> (sys_clk ),</span><br><span class="line"> <span class="variable">.sys_rst_n</span> (sys_rst_n ),</span><br><span class="line"> <span class="variable">.a</span> (a ),</span><br><span class="line"> </span><br><span class="line"> <span class="variable">.a_posedge</span> (a_posedge ),</span><br><span class="line"> <span class="variable">.a_negedge</span> (a_negedge ),</span><br><span class="line"> <span class="variable">.a_edge</span> (a_edge )</span><br><span class="line"> ); </span><br><span class="line"> </span><br><span class="line"> <span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h3 id="例子流水灯设计">例子：流水灯设计</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231165637466.png" class title="image-20231231165637466">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231165657955.png" class title="image-20231231165657955">
<p>灯：1灭0亮</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> flow_led (sys_clk,sys_rst_n, led);</span><br><span class="line">    <span class="keyword">input</span>               sys_clk  ;  <span class="comment">//系统时钟</span></span><br><span class="line">    <span class="keyword">input</span>               sys_rst_n;  <span class="comment">//系统复位，低电平有效</span></span><br><span class="line">    <span class="keyword">output</span>   <span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>]  led ;     <span class="comment">//LED灯</span></span><br><span class="line"><span class="keyword">parameter</span> M=<span class="number">50000000</span>;</span><br><span class="line"><span class="comment">//reg define</span></span><br><span class="line"><span class="keyword">reg</span>  [<span class="number">25</span>:<span class="number">0</span>]  cnt ;                 <span class="comment">//计数器</span></span><br><span class="line"><span class="comment">//计数器计时0.5s</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> sys_clk <span class="keyword">or</span> <span class="keyword">negedge</span> sys_rst_n) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!sys_rst_n)</span><br><span class="line">        cnt &lt;= <span class="number">26&#x27;d0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(cnt == (M - <span class="number">26&#x27;d1</span>))</span><br><span class="line">        cnt &lt;= <span class="number">26&#x27;d0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        cnt &lt;= cnt + <span class="number">26&#x27;d1</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//对LED灯进行移位控制，以输出16位LED的状态</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> sys_clk <span class="keyword">or</span> <span class="keyword">negedge</span> sys_rst_n) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!sys_rst_n)</span><br><span class="line">        led &lt;= <span class="number">16&#x27;hF_F_F_E</span>;		<span class="comment">//回到最右边的灯</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(cnt == (M - <span class="number">26&#x27;d1</span>))	<span class="comment">//计时到了就换灯</span></span><br><span class="line">        led &lt;= &#123;led[<span class="number">14</span>:<span class="number">0</span>],led[<span class="number">15</span>]&#125;;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        led &lt;= led;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h3 id="例子按键检测流水灯设计">例子：按键检测+流水灯设计</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231170153430.png" class title="image-20231231170153430">
<p>按下按键暂停，再按下按键继续</p>
<p>灯的流动是受计数值控制的！</p>
<p>因此暂停的关键是用控制信号控制住计数器值的变化！</p>
<p>检测到按键下降沿以后，控制计数器不变</p>
<p>再检测到按键下降沿，控制计数器继续计数</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231170256600.png" class title="image-20231231170256600">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> flow_led (sys_clk,sys_rst_n,ctrl, led);</span><br><span class="line">    <span class="keyword">input</span>               sys_clk  ;  <span class="comment">//系统时钟</span></span><br><span class="line">    <span class="keyword">input</span>               sys_rst_n;  <span class="comment">//系统复位，低电平有效</span></span><br><span class="line">    <span class="keyword">input</span>               ctrl;</span><br><span class="line">    <span class="keyword">output</span>   <span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>]  led ;     <span class="comment">//LED灯</span></span><br><span class="line"><span class="keyword">parameter</span> M=<span class="number">50000000</span>;</span><br><span class="line"><span class="comment">//reg define</span></span><br><span class="line"><span class="keyword">reg</span>  [<span class="number">25</span>:<span class="number">0</span>]  cnt ;                 <span class="comment">//计数器</span></span><br><span class="line"><span class="keyword">reg</span> cnt_ctrl;</span><br><span class="line"><span class="comment">//wire define</span></span><br><span class="line"><span class="keyword">wire</span> ctrl_negedge;				<span class="comment">//用在边缘检测电路，检测到下降沿会输出高电平</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//cnt_ctrl设计</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> sys_clk <span class="keyword">or</span> <span class="keyword">negedge</span> sys_rst_n) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!sys_rst_n)</span><br><span class="line">        cnt_ctrl &lt;= <span class="number">1&#x27;d1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(ctrl_negedge == <span class="number">1&#x27;d1</span>)</span><br><span class="line">        cnt_ctrl &lt;= ~cnt_ctrl;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        cnt_ctrl &lt;= cnt_ctrl;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//计数器计时0.5s</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> sys_clk <span class="keyword">or</span> <span class="keyword">negedge</span> sys_rst_n) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!sys_rst_n)</span><br><span class="line">        cnt &lt;= <span class="number">26&#x27;d0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(!cnt_ctrl)		<span class="comment">//检测到下降沿以后，ctrl_negedge信号会影响cnt_ctrl信号</span></span><br><span class="line">        cnt &lt;= cnt;   </span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(cnt == (M - <span class="number">26&#x27;d1</span>))</span><br><span class="line">        cnt &lt;= <span class="number">26&#x27;d0</span>;       </span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        cnt &lt;= cnt+ <span class="number">26&#x27;d1</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//对LED灯进行移位控制，以输出16位LED的状态</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> sys_clk <span class="keyword">or</span> <span class="keyword">negedge</span> sys_rst_n) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!sys_rst_n)</span><br><span class="line">        led &lt;= <span class="number">16&#x27;hF_F_F_E</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(cnt == (M - <span class="number">26&#x27;d1</span>))</span><br><span class="line">        led &lt;= &#123;led[<span class="number">14</span>:<span class="number">0</span>],led[<span class="number">15</span>]&#125;;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        led &lt;= led;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//实例化一个边缘检测器，只要下降沿检测信号</span></span><br><span class="line">edge_test u_edge_test(</span><br><span class="line"> <span class="variable">.sys_clk</span> (sys_clk ),</span><br><span class="line"> <span class="variable">.sys_rst_n</span> (sys_rst_n ),</span><br><span class="line"> <span class="variable">.a</span> (ctrl ), </span><br><span class="line"> <span class="variable">.a_negedge</span> (ctrl_negedge )</span><br><span class="line"> );</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>就是把上面两种设计结合起来，很容易</p>
<h3 id="例子呼吸灯设计">例子：呼吸灯设计</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231171620780.png" class title="image-20231231171620780">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231171631913.png" class title="image-20231231171631913">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231171645518.png" class title="image-20231231171645518">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231171858852.png" class title="image-20231231171858852">
<p>需要三种计数器：</p>
<p>2s，2ms，2us</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231172003247.png" class title="image-20231231172003247">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231172019719.png" class title="image-20231231172019719">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231172047721.png" class title="image-20231231172047721">
<p>这里的三个计数器都相互有联系：2ms的计数器用2us控制来自增，2s的计数器用2ms控制来自增</p>
<p>其实也可以三个独立计数，但是这里涉及到“占空比”这个概念</p>
<p>需要改变对应的占空比，才设置成三种相互联系的方式</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231172558595.png" class title="image-20231231172558595">
<p>这张图就可以解释为什么要用三种相互联系</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231172835158.png" class title="image-20231231172835158">
<p>用2ms和2s的计数值作比较：当2ms比2s计数值小的时候，给led高电平，不然就给低电平</p>
<p>可以看到，用三种相互联系的方式，2ms和2s计数值都是0-999，这个比较就很好做；如果用3个计数器独立的方式，就很难设计占空比的控制</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231173146017.png" class title="image-20231231173146017">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231173208147.png" class title="image-20231231173208147">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> breath_led(</span><br><span class="line">    <span class="keyword">input</span>       sys_clk ,      <span class="comment">//系统时钟 100MHz</span></span><br><span class="line">    <span class="keyword">input</span>       sys_rst_n ,    <span class="comment">//系统复位，低电平有效</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span>  led            <span class="comment">//LED灯</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">parameter</span> CNT_2US_MAX = <span class="number">8&#x27;d200</span>;    </span><br><span class="line"><span class="keyword">parameter</span> CNT_2MS_MAX = <span class="number">10&#x27;d1000</span>; </span><br><span class="line"><span class="keyword">parameter</span> CNT_2S_MAX  = <span class="number">10&#x27;d1000</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] cnt_2us; </span><br><span class="line"><span class="keyword">reg</span> [<span class="number">9</span>:<span class="number">0</span>] cnt_2ms;   </span><br><span class="line"><span class="keyword">reg</span> [<span class="number">9</span>:<span class="number">0</span>] cnt_2s;     </span><br><span class="line"><span class="keyword">reg</span>       inc_dec_flag; <span class="comment">//0:高电平时间递增 1:高电平递减</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//这个计数器还是最开始的设计模式</span></span><br><span class="line"><span class="keyword">always</span>@(<span class="keyword">posedge</span> sys_clk <span class="keyword">or</span> <span class="keyword">negedge</span> sys_rst_n) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!sys_rst_n)   cnt_2us &lt;= <span class="number">8&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(cnt_2us == (CNT_2US_MAX - <span class="number">8&#x27;b1</span> ))</span><br><span class="line">        cnt_2us &lt;= <span class="number">8&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        cnt_2us &lt;= cnt_2us + <span class="number">8&#x27;b1</span>;</span><br><span class="line"><span class="keyword">end</span> <span class="comment">//cnt_2us:计数2us</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//这个计数跟以往很不一样，需要考虑上一级的计数，所以会出现“保持不变”</span></span><br><span class="line"><span class="keyword">always</span>@(<span class="keyword">posedge</span> sys_clk <span class="keyword">or</span> <span class="keyword">negedge</span> sys_rst_n) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!sys_rst_n)   cnt_2ms &lt;= <span class="number">10&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(cnt_2ms == (CNT_2MS_MAX - <span class="number">10&#x27;b1</span>) 		<span class="comment">//这一级记满</span></span><br><span class="line">            &amp;&amp; cnt_2us == (CNT_2US_MAX - <span class="number">8&#x27;b1</span>))		<span class="comment">//并且上一级也记满</span></span><br><span class="line">        cnt_2ms &lt;= <span class="number">10&#x27;b0</span>;						<span class="comment">//才清0</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(cnt_2us == CNT_2US_MAX - <span class="number">8&#x27;b1</span>)			<span class="comment">//上一级记满，给这一级自增</span></span><br><span class="line">        cnt_2ms &lt;= cnt_2ms + <span class="number">10&#x27;b1</span>;</span><br><span class="line">    <span class="keyword">else</span>										<span class="comment">//否则保持不变</span></span><br><span class="line">        cnt_2ms &lt;= cnt_2ms;</span><br><span class="line"><span class="keyword">end</span><span class="comment">//cnt_2ms:计数2ms</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">//这个计数跟以往很不一样，需要考虑上两级的计数，所以会出现“保持不变”</span></span><br><span class="line"><span class="keyword">always</span>@(<span class="keyword">posedge</span> sys_clk <span class="keyword">or</span> <span class="keyword">negedge</span> sys_rst_n) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!sys_rst_n)   cnt_2s &lt;= <span class="number">10&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(cnt_2s == (CNT_2S_MAX - <span class="number">10&#x27;b1</span>) &amp;&amp; 		<span class="comment">//这一级记满</span></span><br><span class="line">          cnt_2ms == (CNT_2MS_MAX - <span class="number">10&#x27;b1</span>) &amp;&amp; 		<span class="comment">//并且上一级也记满</span></span><br><span class="line">            cnt_2us == (CNT_2US_MAX - <span class="number">8&#x27;b1</span>))		<span class="comment">//并且上两级也记满</span></span><br><span class="line">        cnt_2s &lt;= <span class="number">10&#x27;b0</span>;						<span class="comment">//才清0</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(cnt_2ms == (CNT_2MS_MAX - <span class="number">10&#x27;b1</span>) 		<span class="comment">//上一级记满</span></span><br><span class="line">            &amp;&amp; cnt_2us == (CNT_2US_MAX - <span class="number">8&#x27;b1</span>))		<span class="comment">//并且上两级也记满</span></span><br><span class="line">        cnt_2s &lt;= cnt_2s + <span class="number">10&#x27;b1</span>;				<span class="comment">//才自增</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        cnt_2s &lt;= cnt_2s;         				<span class="comment">//否则保持不变</span></span><br><span class="line"><span class="keyword">end</span><span class="comment">//cnt_2s:计数2s</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span>@(<span class="keyword">posedge</span> sys_clk <span class="keyword">or</span> <span class="keyword">negedge</span> sys_rst_n) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!sys_rst_n)   inc_dec_flag &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(cnt_2s == (CNT_2S_MAX - <span class="number">10&#x27;b1</span>) &amp;&amp; </span><br><span class="line">          cnt_2ms ==( CNT_2MS_MAX - <span class="number">10&#x27;b1</span>) &amp;&amp; </span><br><span class="line">          cnt_2us == (CNT_2US_MAX - <span class="number">8&#x27;b1</span>))</span><br><span class="line">        inc_dec_flag &lt;= ~inc_dec_flag;			<span class="comment">//记满两秒的逻辑和上面两秒计时器一样</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        inc_dec_flag &lt;= inc_dec_flag;			<span class="comment">//否则保持不变</span></span><br><span class="line"><span class="keyword">end</span><span class="comment">//每当到两秒，让inc_dec_flag信号翻转一次</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span>@(<span class="keyword">posedge</span> sys_clk <span class="keyword">or</span> <span class="keyword">negedge</span> sys_rst_n) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!sys_rst_n)   led &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>((inc_dec_flag == <span class="number">1&#x27;b1</span> &amp;&amp; cnt_2ms &gt;= cnt_2s) || 	<span class="comment">//区分递增和递减</span></span><br><span class="line">            (inc_dec_flag == <span class="number">1&#x27;b0</span> &amp;&amp; cnt_2ms &lt;= cnt_2s))	</span><br><span class="line">        led &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        led &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line"><span class="keyword">end</span><span class="comment">//led:输出信号连接到外部的led灯</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h3 id="ip核调用">IP核调用</h3>
<p>库函数调用</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231174709381.png" class title="image-20231231174709381">
<p>IP核：知识产权核</p>
<p>IP Man：叶问（IP侠）</p>
<p>就挺搞笑的</p>
<h3 id="数码管扫描显示电路">数码管扫描显示电路</h3>
<p>多个数码管：</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231175203588.png" class title="image-20231231175203588">
<p>分时复用即可</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231175246088.png" class title="image-20231231175246088">
<p>利用人眼视觉暂留效应</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231175309241.png" class title="image-20231231175309241">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231180506310.png" class title="image-20231231180506310">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231211847899.png" class title="image-20231231211847899">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231211907046.png" class title="image-20231231211907046">
<p>控制信号产生：高位做控制信号，记满就会进位</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231211932843.png" class title="image-20231231211932843">
<h4 id="例子8个共阴极数码管扫描显示电路设计">例子：8个共阴极数码管扫描显示电路设计</h4>
<p>人眼的视觉暂留最佳频率是1000HZ左右，即时钟周期为1ms</p>
<p>输入为100MHZ，对应时钟周期为10ns</p>
<p>则计数值为<span class="math inline">\(\dfrac{10^{-3}s}{10\times10^{-9}s}=10^5\)</span></p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231212452665.png" class title="image-20231231212452665">
<p>因为要考虑高位进位，所以需要算出对应的位宽</p>
<p>前面的计数器之所以可以不设位宽，因为前面的设计只需要考虑能不能存下计数的值，都可以用32位</p>
<p>但是这个设置位宽，是因为要考虑高位进位，作为控制信号</p>
<p>8个数码管，控制信号就是3位，即<span class="math inline">\(2^3=8\)</span></p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231212649835.png" class title="image-20231231212649835">
<p>故最后需要17+3=20位的计数器</p>
<p><br></p>
<p>如果出现闪烁感，就要缩短计时时间了</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231212827796.png" class title="image-20231231212827796">
<p>结构设计：</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231212845420.png" class title="image-20231231212845420">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231213128470.png" class title="image-20231231213128470">
<p>8位的an信号用于选择让哪一个数码管亮：</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231213435646.png" class title="image-20231231213435646">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> scan_led_hex_disp (                          </span><br><span class="line">    <span class="keyword">input</span> clk,rstn,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] hex7,hex6,hex5,hex4,hex3,hex2,hex1,hex0,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">7</span>:<span class="number">0</span>] dp_in,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">7</span>:<span class="number">0</span>] sseg_select,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] an,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> dp,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">6</span>:<span class="number">0</span>] sseg</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="keyword">parameter</span> N=<span class="number">19</span>;<span class="comment">//低16位用来设计计数器</span></span><br><span class="line"><span class="keyword">reg</span> [N-<span class="number">1</span>:<span class="number">0</span>] regN;</span><br><span class="line"><span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] hex_in;</span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rstn) </span><br><span class="line">    <span class="keyword">if</span> (!rstn)    regN &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span>    regN &lt;= regN + <span class="number">1</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @*					<span class="comment">//判断计数器高三位，用于选择数码管</span></span><br><span class="line">    <span class="keyword">case</span> (regN[N-<span class="number">1</span>:N-<span class="number">3</span>])</span><br><span class="line">        <span class="number">3&#x27;b000</span>: <span class="keyword">begin</span></span><br><span class="line">            an = <span class="number">8&#x27;b1111_1110</span> | sseg_select;</span><br><span class="line">            hex_in = hex0;</span><br><span class="line">            dp = dp_in[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="number">3&#x27;b001</span>: <span class="keyword">begin</span></span><br><span class="line">            an = <span class="number">8&#x27;b1111_1101</span> | sseg_select;</span><br><span class="line">            hex_in = hex1;</span><br><span class="line">            dp = dp_in[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="number">3&#x27;b010</span>: <span class="keyword">begin</span></span><br><span class="line">            an = <span class="number">8&#x27;b1111_1011</span> | sseg_select;</span><br><span class="line">            hex_in = hex2;</span><br><span class="line">            dp = dp_in[<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="number">3&#x27;b011</span>: <span class="keyword">begin</span></span><br><span class="line">            an = <span class="number">8&#x27;b1111_0111</span> | sseg_select;</span><br><span class="line">            hex_in = hex3;</span><br><span class="line">            dp = dp_in[<span class="number">3</span>];</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="number">3&#x27;b100</span>: <span class="keyword">begin</span></span><br><span class="line">            an = <span class="number">8&#x27;b1110_1111</span> | sseg_select;</span><br><span class="line">            hex_in = hex4;</span><br><span class="line">            dp = dp_in[<span class="number">4</span>];</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="number">3&#x27;b101</span>: <span class="keyword">begin</span></span><br><span class="line">            an = <span class="number">8&#x27;b1101_1111</span> | sseg_select;</span><br><span class="line">            hex_in = hex5;</span><br><span class="line">            dp = dp_in[<span class="number">5</span>];</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="number">3&#x27;b110</span>: <span class="keyword">begin</span></span><br><span class="line">            an = <span class="number">8&#x27;b1011_1111</span> | sseg_select;</span><br><span class="line">            hex_in = hex6;</span><br><span class="line">            dp = dp_in[<span class="number">6</span>];</span><br><span class="line">        <span class="keyword">end</span>        </span><br><span class="line">        <span class="keyword">default</span>: <span class="keyword">begin</span></span><br><span class="line">            an = <span class="number">8&#x27;b0111_1111</span> | sseg_select;</span><br><span class="line">            hex_in = hex7;</span><br><span class="line">            dp = dp_in[<span class="number">7</span>];</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">endcase</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @* <span class="keyword">begin</span>			<span class="comment">//控制对应数码管该怎么亮，共阴数码管，则1亮0不亮</span></span><br><span class="line">    <span class="keyword">case</span>(hex_in)</span><br><span class="line">        <span class="number">4&#x27;d0</span> : sseg[<span class="number">6</span>:<span class="number">0</span>] = <span class="number">7&#x27;b1111110</span>;</span><br><span class="line">        <span class="number">4&#x27;d1</span> : sseg[<span class="number">6</span>:<span class="number">0</span>] = <span class="number">7&#x27;b0110000</span>;</span><br><span class="line">        <span class="number">4&#x27;d2</span> : sseg[<span class="number">6</span>:<span class="number">0</span>] = <span class="number">7&#x27;b1101101</span>;</span><br><span class="line">        <span class="number">4&#x27;d3</span> : sseg[<span class="number">6</span>:<span class="number">0</span>] = <span class="number">7&#x27;b1111001</span>;</span><br><span class="line">        <span class="number">4&#x27;d4</span> : sseg[<span class="number">6</span>:<span class="number">0</span>] = <span class="number">7&#x27;b0110011</span>;</span><br><span class="line">        <span class="number">4&#x27;d5</span> : sseg[<span class="number">6</span>:<span class="number">0</span>] = <span class="number">7&#x27;b1011011</span>;</span><br><span class="line">        <span class="number">4&#x27;d6</span> : sseg[<span class="number">6</span>:<span class="number">0</span>] = <span class="number">7&#x27;b1011111</span>;</span><br><span class="line">        <span class="number">4&#x27;d7</span> : sseg[<span class="number">6</span>:<span class="number">0</span>] = <span class="number">7&#x27;b1110000</span>;</span><br><span class="line">        <span class="number">4&#x27;d8</span> : sseg[<span class="number">6</span>:<span class="number">0</span>] = <span class="number">7&#x27;b1111111</span>;</span><br><span class="line">        <span class="number">4&#x27;d9</span> : sseg[<span class="number">6</span>:<span class="number">0</span>] = <span class="number">7&#x27;b1111011</span>;</span><br><span class="line">        <span class="number">4&#x27;d10</span> : sseg[<span class="number">6</span>:<span class="number">0</span>] = <span class="number">7&#x27;b1110111</span>;</span><br><span class="line">        <span class="number">4&#x27;d11</span> : sseg[<span class="number">6</span>:<span class="number">0</span>] = <span class="number">7&#x27;b0011111</span>;</span><br><span class="line">        <span class="number">4&#x27;d12</span> : sseg[<span class="number">6</span>:<span class="number">0</span>] = <span class="number">7&#x27;b1001110</span>;</span><br><span class="line">        <span class="number">4&#x27;d13</span> : sseg[<span class="number">6</span>:<span class="number">0</span>] = <span class="number">7&#x27;b0111101</span>;</span><br><span class="line">        <span class="number">4&#x27;d14</span> : sseg[<span class="number">6</span>:<span class="number">0</span>] = <span class="number">7&#x27;b1001111</span>;</span><br><span class="line">        <span class="keyword">default</span> : sseg[<span class="number">6</span>:<span class="number">0</span>]=<span class="number">7&#x27;b1000111</span>;<span class="comment">//15</span></span><br><span class="line">    <span class="keyword">endcase</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="例子在8个数码管依次显示1到8">例子：在8个数码管依次显示1到8</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231213714331.png" class title="image-20231231213714331">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> sseg_scan_display_top(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> rstn,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] an,</span><br><span class="line">    <span class="keyword">output</span> dp,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">6</span>:<span class="number">0</span>]sseg</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">scan_led_hex_disp u_scan_led_hex_disp(                          </span><br><span class="line">    <span class="variable">.clk</span>(clk),</span><br><span class="line">    <span class="variable">.rstn</span>(rstn),</span><br><span class="line">    <span class="variable">.hex7</span>(<span class="number">4&#x27;d1</span>),</span><br><span class="line">    <span class="variable">.hex6</span>(<span class="number">4&#x27;d2</span>),</span><br><span class="line">    <span class="variable">.hex5</span>(<span class="number">4&#x27;d3</span>),</span><br><span class="line">    <span class="variable">.hex4</span>(<span class="number">4&#x27;d4</span>),</span><br><span class="line">    <span class="variable">.hex3</span>(<span class="number">4&#x27;d5</span>),</span><br><span class="line">    <span class="variable">.hex2</span>(<span class="number">4&#x27;d6</span>),</span><br><span class="line">    <span class="variable">.hex1</span>(<span class="number">4&#x27;d7</span>),</span><br><span class="line">    <span class="variable">.hex0</span>(<span class="number">4&#x27;d8</span>),</span><br><span class="line">    <span class="variable">.dp_in</span>(<span class="number">8&#x27;b0000_0000</span>),</span><br><span class="line">    <span class="variable">.sseg_select</span>(<span class="number">8&#x27;b0000_0000</span>),</span><br><span class="line"></span><br><span class="line">    <span class="variable">.an</span>(an),</span><br><span class="line">    <span class="variable">.dp</span>(dp),</span><br><span class="line">    <span class="variable">.sseg</span>(sseg)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>如果模块写好了，就可以直接调用，很容易的</p>
<h4 id="例子设计乘法器并显示在数码管中">例子：设计乘法器并显示在数码管中</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231213835278.png" class title="image-20231231213835278">
<p>4位*4位，则结果为8位</p>
<p>之前写好的位移乘法：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Mult (</span><br><span class="line"><span class="keyword">input</span> [N-<span class="number">1</span>:<span class="number">0</span>] op0,</span><br><span class="line"><span class="keyword">input</span> [M-<span class="number">1</span>:<span class="number">0</span>] op1,</span><br><span class="line"><span class="keyword">output</span> <span class="keyword">reg</span> [N+M-<span class="number">1</span>:<span class="number">0</span>] mul_result </span><br><span class="line">);</span><br><span class="line"><span class="keyword">parameter</span> N=<span class="number">2</span>;</span><br><span class="line"><span class="keyword">parameter</span> M=<span class="number">2</span>;</span><br><span class="line"><span class="keyword">integer</span> i;       </span><br><span class="line"><span class="keyword">always</span> @* <span class="keyword">begin</span></span><br><span class="line">    mul_result=<span class="number">0</span>;        </span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;M; i=i+<span class="number">1</span>)        </span><br><span class="line">        <span class="keyword">if</span>(op1[i])              </span><br><span class="line">            mul_result=mul_result+(op0&lt;&lt;i);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>在数码管乘法中使用：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> sseg_scan_display_top(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> rstn,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] op0,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] op1,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] an,</span><br><span class="line">    <span class="keyword">output</span> dp,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">6</span>:<span class="number">0</span>]sseg</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] mul_temp;</span><br><span class="line"></span><br><span class="line">Mult <span class="variable">#(.N(4),.M(4))</span> u_Mult (</span><br><span class="line">    <span class="variable">.op0</span>(op0),</span><br><span class="line">    <span class="variable">.op1</span>(op1),</span><br><span class="line">    <span class="variable">.mul_result</span>(mul_temp) </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">scan_led_hex_disp u_scan_led_hex_disp(                          </span><br><span class="line">    <span class="variable">.clk</span>(clk),</span><br><span class="line">    <span class="variable">.rstn</span>(rstn),</span><br><span class="line">    <span class="variable">.hex7</span>(op0),</span><br><span class="line">    <span class="comment">//.hex6(4&#x27;d2),</span></span><br><span class="line">    <span class="variable">.hex5</span>(op1),</span><br><span class="line">    <span class="comment">//.hex4(4&#x27;d4),</span></span><br><span class="line">    <span class="variable">.hex3</span>(mul_temp[<span class="number">7</span>:<span class="number">4</span>]),</span><br><span class="line">    <span class="variable">.hex2</span>(mul_temp[<span class="number">3</span>:<span class="number">0</span>]),</span><br><span class="line">    <span class="comment">//.hex1(4&#x27;d7),</span></span><br><span class="line">    <span class="comment">//.hex0(4&#x27;d8),</span></span><br><span class="line">    <span class="variable">.dp_in</span>(<span class="number">8&#x27;b0000_0000</span>),</span><br><span class="line">    <span class="variable">.sseg_select</span>(<span class="number">8&#x27;b0101_0011</span>),</span><br><span class="line"></span><br><span class="line">    <span class="variable">.an</span>(an),</span><br><span class="line">    <span class="variable">.dp</span>(dp),</span><br><span class="line">    <span class="variable">.sseg</span>(sseg)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>结果：</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231221828523.png" class title="image-20231231221828523">
<p>但是这是16进制，不好看</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> sseg_scan_display_top(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> rstn,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] op0,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] op1,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] an,</span><br><span class="line">    <span class="keyword">output</span> dp,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">6</span>:<span class="number">0</span>]sseg</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] mul_temp;</span><br><span class="line"></span><br><span class="line">Mult <span class="variable">#(.N(4),.M(4))</span> u_Mult (</span><br><span class="line">    <span class="variable">.op0</span>(op0),</span><br><span class="line">    <span class="variable">.op1</span>(op1),</span><br><span class="line">    <span class="variable">.mul_result</span>(mul_temp) </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">scan_led_hex_disp u_scan_led_hex_disp(                          </span><br><span class="line">    <span class="variable">.clk</span>(clk),</span><br><span class="line">    <span class="variable">.rstn</span>(rstn),</span><br><span class="line">    <span class="variable">.hex7</span>(op0/<span class="number">4&#x27;d10</span>),</span><br><span class="line">    <span class="variable">.hex6</span>(op0%<span class="number">4&#x27;d10</span>),</span><br><span class="line">    <span class="variable">.hex5</span>(op1/<span class="number">4&#x27;d10</span>),</span><br><span class="line">    <span class="variable">.hex4</span>(op1%<span class="number">4&#x27;d10</span>),</span><br><span class="line">    <span class="comment">//.hex3(mul_temp[7:4]),</span></span><br><span class="line">    <span class="variable">.hex2</span>(mul_temp/<span class="number">8&#x27;d100</span>),</span><br><span class="line">    <span class="variable">.hex1</span>(mul_temp/<span class="number">8&#x27;d10</span>-(mul_temp/<span class="number">8&#x27;d100</span>)*<span class="number">8&#x27;d10</span>),</span><br><span class="line">    <span class="variable">.hex0</span>(mul_temp%<span class="number">10&#x27;d10</span>),</span><br><span class="line">    <span class="variable">.dp_in</span>(<span class="number">8&#x27;b0000_0000</span>),</span><br><span class="line">    <span class="variable">.sseg_select</span>(<span class="number">8&#x27;b0000_1000</span>),</span><br><span class="line"></span><br><span class="line">    <span class="variable">.an</span>(an),</span><br><span class="line">    <span class="variable">.dp</span>(dp),</span><br><span class="line">    <span class="variable">.sseg</span>(sseg)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231221932277.png" class title="image-20231231221932277">
<p>在显示的时候，多用3个数码管，因为要显示10进制的数</p>
<p>其实很简单，在刚刚数码管显示电路里，我们已经实现了0-15的显示逻辑</p>
<p>现在只需要把数拆成十位和个位，就能直接带入显示</p>
<p>拆成十位：除10</p>
<p>拆成个位：余10</p>
<p><code>.hex7(op0/4'd10), .hex6(op0%4'd10),</code></p>
<h3 id="秒表设计">秒表设计</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231222642739.png" class title="image-20231231222642739">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231224816103.png" class title="image-20231231224816103">
<p>秒表实现方法有两种：</p>
<p>一种是跟呼吸灯一样，用最低位的计数器控制上面的位</p>
<p>还有一种就是，每一位用单独的计数器控制</p>
<h4 id="例子秒表进位">例子：秒表（进位）</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20231231225620710.png" class title="image-20231231225620710">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> Watch(</span><br><span class="line"><span class="keyword">input</span> clk,</span><br><span class="line"><span class="keyword">input</span> go,</span><br><span class="line"><span class="keyword">input</span> rstn,</span><br><span class="line"></span><br><span class="line"><span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] d0,</span><br><span class="line"><span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] d1,</span><br><span class="line"><span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] d2</span><br><span class="line">);</span><br><span class="line"><span class="keyword">parameter</span> M=<span class="number">10000000</span>;</span><br><span class="line"><span class="keyword">reg</span> [<span class="number">23</span>:<span class="number">0</span>] cnt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//*只要控制住cnt就能实现暂停*</span></span><br><span class="line"><span class="keyword">always</span> @ (<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!rstn)</span><br><span class="line">        cnt &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(!go) </span><br><span class="line">        cnt &lt;= cnt;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(cnt == M-<span class="number">1</span>)</span><br><span class="line">        cnt &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">        cnt &lt;= cnt + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @ (<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (!rstn)</span><br><span class="line">        d0 &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(d0 == <span class="number">4&#x27;d9</span> &amp; cnt == M-<span class="number">1</span>) </span><br><span class="line">        d0 &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(cnt == M-<span class="number">1</span>) </span><br><span class="line">        d0 &lt;= d0 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">        d0 &lt;= d0;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @ (<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (!rstn)</span><br><span class="line">        d1 &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(d1 == <span class="number">4&#x27;d9</span> &amp; d0 == <span class="number">4&#x27;d9</span> &amp; cnt == M-<span class="number">1</span>)</span><br><span class="line">        d1 &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(d0 == <span class="number">4&#x27;d9</span> &amp; cnt == M-<span class="number">1</span>)</span><br><span class="line">        d1 &lt;= d1 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">        d1 &lt;= d1;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @ (<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (!rstn)</span><br><span class="line">        d2 &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(d2 == <span class="number">4&#x27;d9</span> &amp; d1 == <span class="number">4&#x27;d9</span> &amp; d0 == <span class="number">4&#x27;d9</span> &amp; cnt == M-<span class="number">1</span>)</span><br><span class="line">        d2 &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(d1 == <span class="number">4&#x27;d9</span> &amp; d0 == <span class="number">4&#x27;d9</span> &amp; cnt == M-<span class="number">1</span>)</span><br><span class="line">        d2 &lt;= d2 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">        d2 &lt;= d2;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="例子秒表数码管显示">例子：秒表+数码管显示</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101093405609.png" class title="image-20240101093405609">
<p>调用秒表模块和数码管模块即可</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> sseg_scan_display_top(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> rstn,</span><br><span class="line">    <span class="keyword">input</span> go,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] an,</span><br><span class="line">    <span class="keyword">output</span> dp,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">6</span>:<span class="number">0</span>]sseg</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] d0;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] d1;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] d2;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Watch u_Watch(</span><br><span class="line"><span class="variable">.clk</span>(clk),</span><br><span class="line"><span class="variable">.go</span>(go),</span><br><span class="line"><span class="variable">.rstn</span>(rstn),</span><br><span class="line"><span class="variable">.d0</span>(d0),</span><br><span class="line"><span class="variable">.d1</span>(d1),</span><br><span class="line"><span class="variable">.d2</span>(d2)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">scan_led_hex_disp u_scan_led_hex_disp(                          </span><br><span class="line">    <span class="variable">.clk</span>(clk),</span><br><span class="line">    <span class="variable">.rstn</span>(rstn),</span><br><span class="line">    <span class="comment">//.hex7(op0/4&#x27;d10),</span></span><br><span class="line">    <span class="comment">//.hex6(op0%4&#x27;d10),</span></span><br><span class="line">    <span class="comment">//.hex5(op1/4&#x27;d10),</span></span><br><span class="line">    <span class="comment">//.hex4(op1%4&#x27;d10),</span></span><br><span class="line">    <span class="comment">//.hex3(mul_temp[7:4]),</span></span><br><span class="line">    <span class="variable">.hex2</span>(d2),</span><br><span class="line">    <span class="variable">.hex1</span>(d1),</span><br><span class="line">    <span class="variable">.hex0</span>(d0),</span><br><span class="line">    <span class="variable">.dp_in</span>(<span class="number">8&#x27;b0000_0010</span>),</span><br><span class="line">    <span class="variable">.sseg_select</span>(<span class="number">8&#x27;b1111_1000</span>),</span><br><span class="line"></span><br><span class="line">    <span class="variable">.an</span>(an),</span><br><span class="line">    <span class="variable">.dp</span>(dp),</span><br><span class="line">    <span class="variable">.sseg</span>(sseg)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="例子秒表每位单独控制">例子：秒表（每位单独控制）</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101093646214.png" class title="image-20240101093646214">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> Watch(</span><br><span class="line"><span class="keyword">input</span> clk,</span><br><span class="line"><span class="keyword">input</span> go,</span><br><span class="line"><span class="keyword">input</span> rstn,</span><br><span class="line"></span><br><span class="line"><span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] d</span><br><span class="line">);</span><br><span class="line"><span class="keyword">parameter</span> M=<span class="number">1_000_0000</span>;</span><br><span class="line"><span class="keyword">reg</span> [<span class="number">39</span>:<span class="number">0</span>] cnt;<span class="comment">//不纠结位宽</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//*只要控制住cnt就能实现暂停*</span></span><br><span class="line"><span class="keyword">always</span> @ (<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!rstn)</span><br><span class="line">        cnt &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(!go) </span><br><span class="line">        cnt &lt;= cnt;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(cnt == M-<span class="number">1</span>)</span><br><span class="line">        cnt &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">        cnt &lt;= cnt + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @ (<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (!rstn)</span><br><span class="line">        d &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(d == <span class="number">4&#x27;d9</span> &amp; cnt == M-<span class="number">1</span>) </span><br><span class="line">        d &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(cnt == M-<span class="number">1</span>) </span><br><span class="line">        d &lt;= d + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">        d &lt;= d;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101093823083.png" class title="image-20240101093823083">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> sseg_scan_display_top(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> rstn,</span><br><span class="line">    <span class="keyword">input</span> go,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] an,</span><br><span class="line">    <span class="keyword">output</span> dp,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">6</span>:<span class="number">0</span>]sseg</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] d0;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] d1;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] d2;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] d3;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] d4;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Watch u_Watch(</span><br><span class="line"><span class="variable">.clk</span>(clk),</span><br><span class="line"><span class="variable">.go</span>(go),</span><br><span class="line"><span class="variable">.rstn</span>(rstn),</span><br><span class="line"><span class="variable">.d</span>(d0)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">Watch <span class="variable">#(.M(1_0000_0000))</span> u1_Watch(</span><br><span class="line"><span class="variable">.clk</span>(clk),</span><br><span class="line"><span class="variable">.go</span>(go),</span><br><span class="line"><span class="variable">.rstn</span>(rstn),</span><br><span class="line"><span class="variable">.d</span>(d1)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">Watch <span class="variable">#(.M(10_0000_0000))</span> u2_Watch(</span><br><span class="line"><span class="variable">.clk</span>(clk),</span><br><span class="line"><span class="variable">.go</span>(go),</span><br><span class="line"><span class="variable">.rstn</span>(rstn),</span><br><span class="line"><span class="variable">.d</span>(d2)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">Watch <span class="variable">#(.M(40&#x27;d100_0000_0000))</span> u3_Watch(</span><br><span class="line"><span class="variable">.clk</span>(clk),</span><br><span class="line"><span class="variable">.go</span>(go),</span><br><span class="line"><span class="variable">.rstn</span>(rstn),</span><br><span class="line"><span class="variable">.d</span>(d3)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">Watch <span class="variable">#(.M(40&#x27;d1000_0000_0000))</span> u4_Watch(</span><br><span class="line"><span class="variable">.clk</span>(clk),</span><br><span class="line"><span class="variable">.go</span>(go),</span><br><span class="line"><span class="variable">.rstn</span>(rstn),</span><br><span class="line"><span class="variable">.d</span>(d4)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">scan_led_hex_disp u_scan_led_hex_disp(                          </span><br><span class="line">    <span class="variable">.clk</span>(clk),</span><br><span class="line">    <span class="variable">.rstn</span>(rstn),    </span><br><span class="line">    <span class="variable">.hex4</span>(d4),</span><br><span class="line">    <span class="variable">.hex3</span>(d3),</span><br><span class="line">    <span class="variable">.hex2</span>(d2),</span><br><span class="line">    <span class="variable">.hex1</span>(d1),</span><br><span class="line">    <span class="variable">.hex0</span>(d0),</span><br><span class="line">    <span class="variable">.dp_in</span>(<span class="number">8&#x27;b0000_0010</span>),</span><br><span class="line">    <span class="variable">.sseg_select</span>(<span class="number">8&#x27;b1110_0000</span>),</span><br><span class="line"></span><br><span class="line">    <span class="variable">.an</span>(an),</span><br><span class="line">    <span class="variable">.dp</span>(dp),</span><br><span class="line">    <span class="variable">.sseg</span>(sseg)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h1 id="有限状态机设计">有限状态机设计</h1>
<p>掌握Mealy和Moore型状态机的设计</p>
<p>掌握状态机代码实现</p>
<p>掌握按键消抖电路的状态机设计</p>
<h2 id="有限状态机定义">有限状态机定义</h2>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101094014544.png" class title="image-20240101094014544">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101094120710.png" class title="image-20240101094120710">
<h3 id="时序逻辑分类">时序逻辑分类</h3>
<p>时序电路按电路输出对输入的依从关系分类：分<strong>Mealy型</strong>和<strong>Moore型</strong>电路模型</p>
<p>Mealy型电路：若时序逻辑电路的输出是<strong>电路输入和电路状态的函数</strong>，则称为Mealy型时序逻辑电路</p>
<p>Moore型电路：若时序逻辑电路的输出<strong>仅仅是电路状态的函数</strong>，则称为Moore型时序逻辑电路</p>
<p>Mealy型电路的<strong>输入和输出之间存在直接联系</strong>，而Moore型电路则是将全部输入转换成电路状态后再和输出建立联系</p>
<h3 id="有限状态机优点">有限状态机优点</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101094515801.png" class title="image-20240101094515801">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101094519892.png" class title="image-20240101094519892">
<h3 id="有限状态机分类">有限状态机分类</h3>
<h4 id="mealy型">Mealy型</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101095840491.png" class title="image-20240101095840491">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101095926819.png" class title="image-20240101095926819">
<p>输出与当前状态和输入有关，就是Mealy型</p>
<h4 id="moore型">Moore型</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101100010749.png" class title="image-20240101100010749">
<p>次态仅与现态有关，就是Moore型</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101100118666.png" class title="image-20240101100118666">
<h4 id="区别和联系">区别和联系</h4>
<p>相同点： 1. 次态和输出两个模块都是用组合逻辑实现 2.
现态模块用<strong>时序</strong>逻辑实现 3.
时钟Clk和复位信号Rst都是接到现态模块上 4. 次态都由输入和现态共同决定</p>
<p>不同点：</p>
<p>输出决定因素不一样</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101100324543.png" class title="image-20240101100324543">
<h3 id="有限状态机表示方法">有限状态机表示方法</h3>
<p>状态转移图，算法状态机图</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101100418241.png" class title="image-20240101100418241">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101100617030.png" class title="image-20240101100617030">
<p>注意，两种状态机的状态转移图不一样</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101100743800.png" class title="image-20240101100743800">
<p>举例：</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101100801239.png" class title="image-20240101100801239">
<p>这个是两种状态机都有</p>
<p>s0，s1的输出y1写在状态里，转移弧线上只有输入，所以y1是Moore型输出</p>
<p>y0输出写在转移弧线上，说明输出与当前输入有关系，y0为Mealy型输出</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101101239190.png" class title="image-20240101101239190">
<p>转移弧线上a代表a=1，a'代表a=0</p>
<p><br></p>
<p>有问题的图：</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101101346124.png" class title="image-20240101101346124">
<p>4个状态</p>
<p>仅有A一个输入：因为Reset信号不能当做输入，这个图画的有问题</p>
<p>没有Moore型输出</p>
<p>K1，K2两个Mealy型输出</p>
<p>但是有不合理之处：Reset信号不能当做输入，因为<strong>Reset信号是接入现态逻辑</strong>设计中，但是状态转移图描述的是<strong>次态逻辑和输入逻辑</strong></p>
<h2 id="有限状态机代码实现">有限状态机代码实现</h2>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101102246602.png" class title="image-20240101102246602">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101102305094.png" class title="image-20240101102305094">
<p>如果用数电的知识：</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101102349476.png" class title="image-20240101102349476">
<p>状态编码好像挺麻烦的？好像要用格雷码来着</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101102422977.png" class title="image-20240101102422977">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101102411476.png" class title="image-20240101102411476">
<p><br></p>
<p>但是这门课用FPGA，用独热码更多</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101102519979.png" class title="image-20240101102519979">
<p>设计的时候不要用异步设计</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101102638503.png" class title="image-20240101102638503">
<p>跟以前学到的一样，Reset放clk的always块里做判断就行</p>
<h3 id="第一种写法三个逻辑块分开写">第一种写法：三个逻辑块分开写</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101102804978.png" class title="image-20240101102804978">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101100801239.png" class title="image-20240101100801239">
<p>次态逻辑单元的代码要严格遵循状态图或者ASM图的逻辑转移流向</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Fsm_exp(</span><br><span class="line">    <span class="keyword">input</span> Clk,Rst_,</span><br><span class="line">    <span class="keyword">input</span> a,b,</span><br><span class="line">    <span class="keyword">output</span> y0,y1);<span class="comment">//默认wire类型</span></span><br><span class="line">    <span class="comment">//状态符号声明,书上用的普通编码</span></span><br><span class="line">    <span class="keyword">localparam</span>[<span class="number">1</span>:<span class="number">0</span>]	s0=<span class="number">2&#x27;b00</span>,</span><br><span class="line">    			s1=<span class="number">2&#x27;b01</span>,</span><br><span class="line">    			s2=<span class="number">2&#x27;b10</span>;  </span><br><span class="line">   <span class="comment">//状态信号声明</span></span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">1</span>:<span class="number">0</span>] cs,nst;</span><br><span class="line">   <span class="comment">// 现态切换逻辑设计-采用同步设计</span></span><br><span class="line">   <span class="keyword">always</span> @(<span class="keyword">posedge</span> Clk)</span><br><span class="line">        <span class="keyword">if</span>(!Rst_)	cs&lt;=s0;</span><br><span class="line">        <span class="keyword">else</span>		cs&lt;=nst;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//次态切换逻辑设计—关键:要遵循状态转移图来写</span></span><br><span class="line">    <span class="keyword">always</span> @*</span><br><span class="line">        <span class="keyword">case</span>(cs)</span><br><span class="line">            s0: </span><br><span class="line">			<span class="keyword">if</span>(a)				<span class="comment">//输入a=1</span></span><br><span class="line">				<span class="keyword">if</span>(b) nst=s2;	<span class="comment">//输入b=1</span></span><br><span class="line">				<span class="keyword">else</span>  nst=s1;	<span class="comment">//输入b=0 </span></span><br><span class="line">			<span class="keyword">else</span>  nst=s0;<span class="comment">//不写也可以，保持原状态</span></span><br><span class="line">            s1: </span><br><span class="line">                <span class="keyword">if</span>(a)  nst=s0;</span><br><span class="line">            	<span class="keyword">else</span>   nst=s1;</span><br><span class="line">            s2:</span><br><span class="line">                nst=s0;</span><br><span class="line">            <span class="keyword">default</span>:nst=s0; <span class="comment">//公司会建议写成nst=2’bxx;</span></span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//写输出组合逻辑： assign或者always语句实现</span></span><br><span class="line">	<span class="comment">//Moore型输出</span></span><br><span class="line">    <span class="comment">//assign y1=(cs==s0)?1:((cs==s1)?1:0);	//狗都不会这样写</span></span><br><span class="line">     <span class="keyword">assign</span> y1=(cs==s0)||(cs==s1);</span><br><span class="line">	<span class="comment">//Mealy型输出</span></span><br><span class="line">     <span class="comment">//assign y0=(cs==s0)?((a&amp;b)?1:0):0;</span></span><br><span class="line">	<span class="keyword">assign</span> y0=(cs==s0)&amp;&amp;a&amp;&amp;b; <span class="comment">//逻辑与/位与都行    </span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>对应的testbench</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> Fsm_exp_testbench;</span><br><span class="line">    <span class="keyword">reg</span> Clk,Rst_;</span><br><span class="line">    <span class="keyword">reg</span> a,b;</span><br><span class="line">    <span class="keyword">wire</span> y0,y1;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">initial</span>    <span class="keyword">begin</span></span><br><span class="line">        a=<span class="number">1</span>; </span><br><span class="line">        b=<span class="number">1</span>; </span><br><span class="line">        Clk=<span class="number">0</span>;</span><br><span class="line">        Rst_=<span class="number">1</span>;</span><br><span class="line">        #<span class="number">5</span> Rst_=<span class="number">0</span>;</span><br><span class="line">        #<span class="number">3</span> Rst_=<span class="number">1</span>;     </span><br><span class="line">    <span class="keyword">end</span>   </span><br><span class="line">    <span class="keyword">always</span> </span><br><span class="line">        #<span class="number">10</span> a=~a;</span><br><span class="line">    <span class="keyword">always</span></span><br><span class="line">        #<span class="number">20</span> b=~b;</span><br><span class="line">    <span class="keyword">always</span> </span><br><span class="line">        #<span class="number">7</span> Clk=~Clk;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">initial</span></span><br><span class="line">        #<span class="number">100</span> <span class="built_in">$finish</span>;</span><br><span class="line"></span><br><span class="line">    Fsm_exp U_Fsm_exp(Clk,Rst_,a,b,y0,y1);</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>有限状态机最重要的逻辑，就是次态切换逻辑</p>
<p>剩下的现态只需要最基本的时序，输出只需要看图</p>
<h3 id="第二种写法次态和输出模块结合在一起">第二种写法：次态和输出模块结合在一起</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101104049832.png" class title="image-20240101104049832">
<p>输出定义为reg，注意赋初值</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Fsm_exp(</span><br><span class="line">    <span class="keyword">input</span> Clk,Rst_,</span><br><span class="line">    <span class="keyword">input</span> a,b,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> y0,y1);</span><br><span class="line">    <span class="comment">//状态符号声明：</span></span><br><span class="line">    <span class="keyword">localparam</span> [<span class="number">1</span>:<span class="number">0</span>]   s0=<span class="number">2&#x27;b00</span>,</span><br><span class="line">                    s1=<span class="number">2&#x27;b01</span>,</span><br><span class="line">                    s2=<span class="number">2&#x27;b10</span>;  </span><br><span class="line">    <span class="comment">//状态信号声明：</span></span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">1</span>:<span class="number">0</span>] cs,nst;</span><br><span class="line">    <span class="comment">//现态切换逻辑设计</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> Clk )</span><br><span class="line">        <span class="keyword">if</span>(!Rst_)	cs&lt;=s0;</span><br><span class="line">    	<span class="keyword">else</span>		cs&lt;=nst;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//次态切换和输出逻辑设计</span></span><br><span class="line">    <span class="keyword">always</span> @*    <span class="keyword">begin</span></span><br><span class="line">        nst=cs;			<span class="comment">//次态赋初值</span></span><br><span class="line">        y0=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        y1=<span class="number">1&#x27;b0</span>;		<span class="comment">//输出赋初值</span></span><br><span class="line">        <span class="keyword">case</span>(cs)</span><br><span class="line">            s0:   <span class="keyword">begin</span></span><br><span class="line">                y1=<span class="number">1&#x27;b1</span>;	<span class="comment">//输出赋值</span></span><br><span class="line">                <span class="keyword">if</span>(a)  </span><br><span class="line">                    <span class="keyword">if</span>(b) <span class="keyword">begin</span></span><br><span class="line">                        nst=s2;</span><br><span class="line">                        y0=<span class="number">1&#x27;b1</span>;</span><br><span class="line">                    <span class="keyword">end</span>                            </span><br><span class="line">                <span class="keyword">else</span>  nst=s1;                    </span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            s1: <span class="keyword">begin</span></span><br><span class="line">                y1=<span class="number">1&#x27;b1</span>;</span><br><span class="line">                <span class="keyword">if</span>(a)  nst=s0;                   </span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            s2:   nst=s0;</span><br><span class="line">            <span class="keyword">default</span>:nst=s0;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h2 id="状态机设计实例">状态机设计实例</h2>
<h3 id="状态机实现模型">状态机实现模型</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101104836369.png" class title="image-20240101104836369">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101104907341.png" class title="image-20240101104907341">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> fsm(Clock, Reset, A, K2, K1);</span><br><span class="line">    <span class="keyword">input</span> Clock, Reset, A;</span><br><span class="line">    <span class="keyword">output</span> K2, K1;</span><br><span class="line">    <span class="keyword">reg</span> K2, K1;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] state, nextstate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">parameter</span></span><br><span class="line">        Idle    =   <span class="number">2&#x27;b00</span>,</span><br><span class="line">        Start   =   <span class="number">2&#x27;b01</span>,</span><br><span class="line">        Stop    =   <span class="number">2&#x27;b10</span>,</span><br><span class="line">        Clear   =   <span class="number">2&#x27;b11</span>;</span><br><span class="line">    <span class="comment">// -------- 现态逻辑 --------</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> Clock)</span><br><span class="line">        <span class="keyword">if</span>(!Reset)</span><br><span class="line">            state   &lt;=  Idle;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            state   &lt;=  nextstate;</span><br><span class="line">    <span class="comment">// ----------------------------</span></span><br><span class="line">    <span class="comment">// -------- 次态逻辑 ---------</span></span><br><span class="line">    <span class="keyword">always</span> @*</span><br><span class="line">        <span class="keyword">case</span>(state)</span><br><span class="line">            Idle: </span><br><span class="line">                <span class="keyword">if</span>(A)</span><br><span class="line">                    nextstate   =   Start;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    nextstate   =   Idle;</span><br><span class="line">            Start: 			</span><br><span class="line">                <span class="keyword">if</span>(!A)</span><br><span class="line">                    nextstate   =   Stop;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    nextstate   =   Start;    <span class="comment">//其实这里图画的有问题，start默认有两个分支  </span></span><br><span class="line">            Stop: </span><br><span class="line">                <span class="keyword">if</span>(A)</span><br><span class="line">                    nextstate   =   Clear;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    nextstate   =   Stop;	<span class="comment">//其实这里图画的有问题，stop默认有两个分支</span></span><br><span class="line">            Clear: </span><br><span class="line">                <span class="keyword">if</span>(!A)</span><br><span class="line">                    nextstate   =   Idle;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    nextstate   =   Clear;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                nextstate   =   <span class="number">2&#x27;bxx</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="comment">// -------------------------------------</span></span><br><span class="line">    <span class="comment">// -------- 产生输出K1的组合逻辑 --------</span></span><br><span class="line">   <span class="keyword">always</span> @*</span><br><span class="line">      <span class="keyword">if</span>(state == Clear &amp;&amp; !A)</span><br><span class="line">         K1 = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">else</span> K1 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// -------- 产生输出K2的组合逻辑 --------</span></span><br><span class="line">   <span class="keyword">always</span> @*</span><br><span class="line">      <span class="keyword">if</span>(state == Stop &amp;&amp; A) </span><br><span class="line">         K2 = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">else</span> K2 = <span class="number">0</span>;    </span><br><span class="line">    <span class="comment">// -----------------------------------------------</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h3 id="序列检测器">序列检测器</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101105118444.png" class title="image-20240101105118444">
<h4 id="例子基于moore状态机设计序列检测器">例子：基于Moore状态机设计序列检测器</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101105314778.png" class title="image-20240101105314778">
<p>不允许重叠，则输出后直接回到初态</p>
<p>设计状态还是挺好设计的，针对序列设计就行</p>
<p>比如序列检测为1101</p>
<p>就设计初态、检测第一个1，检测11，检测110，检测1101，共5个状态</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101110029105.png" class title="image-20240101110029105">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101110124556.png" class title="image-20240101110124556">
<p>注意11状态时，再检测到1，状态停留</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101110217063.png" class title="image-20240101110217063">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Seq_det_moore(</span><br><span class="line">    <span class="keyword">input</span> clk,rstn,</span><br><span class="line">    <span class="keyword">input</span> din,</span><br><span class="line">    <span class="keyword">output</span> y);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">localparam</span>  [<span class="number">2</span>:<span class="number">0</span>]     s0=<span class="number">3&#x27;b000</span>,</span><br><span class="line">                            s1=<span class="number">3&#x27;b001</span>,</span><br><span class="line">                            s2=<span class="number">3&#x27;b010</span>,</span><br><span class="line">                            s3=<span class="number">3&#x27;b011</span>,</span><br><span class="line">                            s4=<span class="number">3&#x27;b100</span>;                                    </span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">2</span>:<span class="number">0</span>] cs,nst;</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk ) <span class="comment">//现态逻辑</span></span><br><span class="line">        <span class="keyword">if</span>(!rstn)	cs &lt;= s0;</span><br><span class="line">    	<span class="keyword">else</span>	cs &lt;= nst;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @*       <span class="keyword">begin</span> <span class="comment">//次态逻辑</span></span><br><span class="line">        <span class="keyword">case</span>(cs)</span><br><span class="line">            s0:</span><br><span class="line">                <span class="keyword">if</span>(din)	nst = s1;</span><br><span class="line">            	<span class="keyword">else</span>	nst = s0;                    </span><br><span class="line">            s1:</span><br><span class="line">                <span class="keyword">if</span>(din)	nst = s2;</span><br><span class="line">            	<span class="keyword">else</span>	nst = s0;</span><br><span class="line">            s2:</span><br><span class="line">                <span class="keyword">if</span>(din)	nst = s2;</span><br><span class="line">            	<span class="keyword">else</span>	nst = s3;</span><br><span class="line">            s3:</span><br><span class="line">                <span class="keyword">if</span>(din)	nst = s4;</span><br><span class="line">            	<span class="keyword">else</span>	nst = s0;     </span><br><span class="line">            s4:</span><br><span class="line">                <span class="keyword">if</span>(din)	nst = s1;</span><br><span class="line">            	<span class="keyword">else</span>	nst = s0;          </span><br><span class="line">            <span class="keyword">default</span>:	nst = s0;</span><br><span class="line">        <span class="keyword">endcase</span>          </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">//输出逻辑       </span></span><br><span class="line">    <span class="keyword">assign</span> y = (cs == s4); <span class="comment">//Moore type</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="例子基于mealy状态机设计序列检测器">例子：基于Mealy状态机设计序列检测器</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101110750060.png" class title="image-20240101110750060">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101110823971.png" class title="image-20240101110823971">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101110831989.png" class title="image-20240101110831989">
<p>注意：Mealy与Moore的不同，这里会少一个状态</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Seq_det_mealy(clk,rstn,din, y);</span><br><span class="line"><span class="keyword">input</span> clk,rstn,din;  </span><br><span class="line"><span class="keyword">output</span> <span class="keyword">reg</span> y;  </span><br><span class="line"><span class="comment">//Status symbol declaration</span></span><br><span class="line">    <span class="keyword">localparam</span> [<span class="number">1</span>:<span class="number">0</span>]    s0 = <span class="number">2&#x27;b00</span>,</span><br><span class="line">                     			s1 = <span class="number">2&#x27;b01</span>,</span><br><span class="line">                     			s2 = <span class="number">2&#x27;b10</span>,</span><br><span class="line">                     			s3 = <span class="number">2&#x27;b11</span>;                               </span><br><span class="line"><span class="comment">//Status signal declaration</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] cs,nst;</span><br><span class="line"><span class="comment">//Current state</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk )</span><br><span class="line">        <span class="keyword">if</span>(!rstn)  cs &lt;= s0;     </span><br><span class="line">        <span class="keyword">else</span>         cs &lt;= nst;  </span><br><span class="line"><span class="comment">//Next state /C1 module</span></span><br><span class="line">    <span class="keyword">always</span> @*    <span class="keyword">begin</span></span><br><span class="line">       <span class="keyword">case</span>(cs)</span><br><span class="line">            s0:     <span class="keyword">if</span>(din)     nst=s1; <span class="keyword">else</span>    nst=s0;                    </span><br><span class="line">            s1:     <span class="keyword">if</span>(din)     nst=s2; <span class="keyword">else</span>    nst=s0;              </span><br><span class="line">            s2:     <span class="keyword">if</span>(din)     nst=s2; <span class="keyword">else</span>    nst=s3;   </span><br><span class="line">            s3:    nst=s0;                                            </span><br><span class="line">            <span class="keyword">default</span>: nst=s0;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line"> <span class="comment">//output/ C2 module  注释掉RST语句：     </span></span><br><span class="line">       <span class="keyword">always</span> @*  	<span class="keyword">begin</span></span><br><span class="line">           <span class="comment">//if(rstn == 0)   y = 0;		//因为输出逻辑没必要判断Reset语句</span></span><br><span class="line">			<span class="keyword">if</span>((cs == s3)&amp;&amp;(din == <span class="number">1</span>)) y = <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">else</span> y = <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h3 id="按键消抖电路设计">按键消抖电路设计</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101111113959.png" class title="image-20240101111113959">
<p>用硬件实现按键消抖，会占空间，开发板没有这么大空间</p>
<p>所以就用软件实现按键消抖</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101111220380.png" class title="image-20240101111220380">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101111231722.png" class title="image-20240101111231722">
<p>引入滴答使能信号tick，10ms一个</p>
<p>按键最多抖动20ms，所以如果连续3次出现稳定的tick=1，就可以确定此时按键稳定</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101111310377.png" class title="image-20240101111310377">
<h4 id="例子有限状态机设计按键消抖">例子：有限状态机设计按键消抖</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101111833992.png" class title="image-20240101111833992">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101111906613.png" class title="image-20240101111906613">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101111936260.png" class title="image-20240101111936260">
<p>挺麻烦</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101112538043.png" class title="image-20240101112538043">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Key_debounce(sw,clk,rstn,out);</span><br><span class="line"><span class="keyword">input</span> sw,clk,rstn;</span><br><span class="line"><span class="keyword">output</span> <span class="keyword">reg</span> out;</span><br><span class="line"></span><br><span class="line"><span class="keyword">parameter</span> N = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//状态声明</span></span><br><span class="line"><span class="keyword">localparam</span> [<span class="number">2</span>:<span class="number">0</span>]   zero = <span class="number">3&#x27;b000</span>,</span><br><span class="line">                  zero1 = <span class="number">3&#x27;b001</span>,</span><br><span class="line">                  zero2 = <span class="number">3&#x27;b010</span>,</span><br><span class="line">                  zero3 = <span class="number">3&#x27;b011</span>,</span><br><span class="line">                    one = <span class="number">3&#x27;b100</span>,</span><br><span class="line">                   one1 = <span class="number">3&#x27;b101</span>,</span><br><span class="line">                   one2 = <span class="number">3&#x27;b110</span>,</span><br><span class="line">                   one3 = <span class="number">3&#x27;b111</span>;</span><br><span class="line"><span class="comment">//信号声明</span></span><br><span class="line"><span class="keyword">reg</span>[<span class="number">2</span>:<span class="number">0</span>] cs,nst;</span><br><span class="line"></span><br><span class="line"><span class="comment">//利用计数器产生tick信号</span></span><br><span class="line"><span class="keyword">wire</span> tick;</span><br><span class="line"><span class="keyword">reg</span> [N-<span class="number">1</span>:<span class="number">0</span>] cnt;</span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk )     <span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span>(!rstn) cnt &lt;= <span class="number">0</span>;  </span><br><span class="line">  <span class="keyword">else</span>      cnt &lt;= cnt + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> tick = (cnt == <span class="number">0</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//状态机设计部分现态逻辑-时序电路</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk )    <span class="keyword">begin</span></span><br><span class="line">   <span class="keyword">if</span>(!rstn)  cs &lt;= zero;</span><br><span class="line">   <span class="keyword">else</span> cs &lt;= nst;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">//状态机设计部分--次态逻辑-组合电路</span></span><br><span class="line"> <span class="comment">//组合电路开始就给输出赋初值,</span></span><br><span class="line"> <span class="comment">//这样后面状态不转移的情况就不用写</span></span><br><span class="line"> <span class="comment">//大大简化代码设计</span></span><br><span class="line"><span class="keyword">always</span> @*    <span class="keyword">begin</span></span><br><span class="line">   nst=cs;</span><br><span class="line">   <span class="keyword">case</span>(cs)</span><br><span class="line">       zero:</span><br><span class="line">            <span class="keyword">if</span>(sw)         nst = zero1;</span><br><span class="line">      zero1:</span><br><span class="line">            <span class="keyword">if</span>(!sw)        nst = zero;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(tick)  nst = zero2;</span><br><span class="line">      zero2:</span><br><span class="line">            <span class="keyword">if</span>(!sw)        nst = zero;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(tick)  nst = zero3;  </span><br><span class="line">      zero3:</span><br><span class="line">            <span class="keyword">if</span>(!sw)        nst = zero;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(tick)  nst = one;                  </span><br><span class="line">        one:</span><br><span class="line">            <span class="keyword">if</span>(!sw)        nst = one1;</span><br><span class="line">       one1:</span><br><span class="line">            <span class="keyword">if</span>(sw)         nst = one;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(tick)  nst = one2;</span><br><span class="line">       one2:</span><br><span class="line">            <span class="keyword">if</span>(sw)         nst = one;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(tick)  nst = one3;</span><br><span class="line">       one3:</span><br><span class="line">            <span class="keyword">if</span>(sw)         nst = one;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(tick)  nst = zero;          </span><br><span class="line">   <span class="keyword">endcase</span>                 </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//状态机设计部分--输出逻辑-组合电路</span></span><br><span class="line"><span class="keyword">always</span> @*     <span class="keyword">begin</span></span><br><span class="line">   out = <span class="number">1&#x27;b0</span>;<span class="comment">//赋初值可简化后面代码设计</span></span><br><span class="line">   <span class="keyword">case</span> (cs) </span><br><span class="line">      one,one1,one2: out = <span class="number">1&#x27;b1</span>;</span><br><span class="line">               one3: </span><br><span class="line">                  <span class="keyword">if</span>(&#123;sw,tick&#125;!=<span class="number">2&#x27;b01</span>)   </span><br><span class="line">                     out = <span class="number">1&#x27;b1</span>;</span><br><span class="line">              zero3: </span><br><span class="line">                  <span class="keyword">if</span>(sw &amp; tick)          </span><br><span class="line">                     out = <span class="number">1&#x27;b1</span>; </span><br><span class="line">   <span class="keyword">endcase</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>对应的testbench</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> tb_Key_debounce;</span><br><span class="line"><span class="keyword">reg</span> clk,sw,rstn;</span><br><span class="line"><span class="keyword">wire</span> out;</span><br><span class="line">Key_debounce <span class="variable">#(.N(2))</span> </span><br><span class="line">u_Key_debounce (<span class="variable">.sw</span>(sw),<span class="variable">.clk</span>(clk),<span class="variable">.rstn</span>(rstn),<span class="variable">.out</span>(out));</span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> #<span class="number">2</span> clk=~clk;</span><br><span class="line"></span><br><span class="line"><span class="keyword">initial</span>     <span class="keyword">begin</span></span><br><span class="line">        sw=<span class="number">0</span>;clk=<span class="number">0</span>; rstn=<span class="number">1</span>;</span><br><span class="line">        #<span class="number">5</span> sw=<span class="number">1</span>;</span><br><span class="line">        #<span class="number">1</span> sw=<span class="number">0</span>;</span><br><span class="line">        #<span class="number">1</span> sw=<span class="number">1</span>;</span><br><span class="line">        #<span class="number">1</span> sw=<span class="number">0</span>;</span><br><span class="line">        #<span class="number">2</span> sw=<span class="number">1</span>;        </span><br><span class="line">        #<span class="number">100</span> sw=<span class="number">0</span>;</span><br><span class="line">        #<span class="number">1</span> sw=<span class="number">1</span>;</span><br><span class="line">        #<span class="number">1</span> sw=<span class="number">0</span>;</span><br><span class="line">        #<span class="number">2</span> sw=<span class="number">1</span>;</span><br><span class="line">        #<span class="number">1</span> sw=<span class="number">0</span>;                 </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">initial</span>    <span class="keyword">begin</span></span><br><span class="line">        #<span class="number">2</span> rstn=<span class="number">0</span>;</span><br><span class="line">        #<span class="number">2</span> rstn=<span class="number">1</span>;</span><br><span class="line"> <span class="keyword">end</span>     </span><br><span class="line"></span><br><span class="line"><span class="keyword">initial</span>  #<span class="number">300</span> <span class="built_in">$finish</span>;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="例子计数器按键边沿检测实现按键消抖">例子：计数器+按键边沿检测实现按键消抖</h4>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101112745991.png" class title="image-20240101112745991">
<p>检测到按键，直接跳20ms就行</p>
<p>最好用这种写法</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Key_debounce(sw,clk,rstn,out);</span><br><span class="line"><span class="keyword">input</span> sw,clk,rstn;</span><br><span class="line"><span class="keyword">output</span> <span class="keyword">reg</span> out;</span><br><span class="line"></span><br><span class="line"><span class="keyword">parameter</span> N = <span class="number">25</span>; <span class="comment">//存下面的数至少需21位</span></span><br><span class="line"><span class="keyword">parameter</span> M = <span class="number">200_0000</span>;<span class="comment">//20ms </span></span><br><span class="line"><span class="keyword">reg</span> [N-<span class="number">1</span>:<span class="number">0</span>] cnt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">wire</span> sw_edge;<span class="comment">//检测按键边沿</span></span><br><span class="line"></span><br><span class="line">edge_test u_edge_test(</span><br><span class="line"> <span class="variable">.sys_clk</span> (clk ),</span><br><span class="line"> <span class="variable">.sys_rst_n</span> (rstn ),</span><br><span class="line"> <span class="variable">.a</span> (sw), </span><br><span class="line"> <span class="comment">//.a_posedge(),</span></span><br><span class="line"> <span class="comment">//.a_negedge(),</span></span><br><span class="line">    <span class="variable">.a_edge</span> (sw_edge )		<span class="comment">//双沿检测，也可以单独写，不调用边缘检测模块，按位异或操作是^</span></span><br><span class="line"> );</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">   <span class="keyword">if</span>(!rstn)        cnt &lt;= <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">else</span> <span class="keyword">if</span>(sw_edge) cnt &lt;= <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">else</span>             cnt &lt;= cnt+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">   <span class="keyword">if</span>(!rstn)           out &lt;= <span class="number">1</span>;</span><br><span class="line">   <span class="keyword">else</span> <span class="keyword">if</span>(cnt == M-<span class="number">1</span>) out &lt;= sw;</span><br><span class="line">   <span class="keyword">else</span>                out &lt;= out;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h1 id="uart串口通信">UART串口通信</h1>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101120201601.png" class title="image-20240101120201601">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101120426847.png" class title="image-20240101120426847">
<p>本章学的是异步通信，所以会有数据格式</p>
<h2 id="uart串口通信协议">UART串口通信协议</h2>
<p>UART：Universal Asynchronous
Receiver/Transmitter，即通用异步收发器</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101120546526.png" class title="image-20240101120546526">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101120604325.png" class title="image-20240101120604325">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101120618990.png" class title="image-20240101120618990">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101120637123.png" class title="image-20240101120637123">
<h3 id="波特率比特率">波特率比特率</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101120648361.png" class title="image-20240101120648361">
<p>对串口通信，波特率等于比特率，因为串口通信传输的信息就是1位二进制</p>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101120745203.png" class title="image-20240101120745203">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101120801987.png" class title="image-20240101120801987">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101120808685.png" class title="image-20240101120808685">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101120822001.png" class title="image-20240101120822001">
<h2 id="逻辑框图分析设计">逻辑框图分析设计</h2>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101120835187.png" class title="image-20240101120835187">
<h3 id="串口接收模块">串口接收模块</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101120902969.png" class title="image-20240101120902969">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101120911186.png" class title="image-20240101120911186">
<h3 id="串口发送模块">串口发送模块</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101120920717.png" class title="image-20240101120920717">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101120926575.png" class title="image-20240101120926575">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101120943497.png" class title="image-20240101120943497">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101120932747.png" class title="image-20240101120932747">
<h3 id="顶层模块">顶层模块</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101120952075.png" class title="image-20240101120952075">
<h2 id="各模块代码实现">各模块代码实现</h2>
<h3 id="接收模块">接收模块</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101121021659.png" class title="image-20240101121021659">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101121030172.png" class title="image-20240101121030172">
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101121041797.png" class title="image-20240101121041797">
<p>图一乐就好</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> uart_rx(</span><br><span class="line">    <span class="keyword">input</span>               clk         ,  <span class="comment">//系统时钟</span></span><br><span class="line">    <span class="keyword">input</span>               rst_n       ,  <span class="comment">//系统复位，低有效</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">input</span>               uart_rxd    ,  <span class="comment">//UART接收端口</span></span><br><span class="line">    <span class="keyword">output</span>  <span class="keyword">reg</span>         uart_rx_done,  <span class="comment">//UART接收完成信号</span></span><br><span class="line">    <span class="keyword">output</span>  <span class="keyword">reg</span>  [<span class="number">7</span>:<span class="number">0</span>]  uart_rx_data   <span class="comment">//UART接收到的数据</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="comment">//parameter define</span></span><br><span class="line"><span class="keyword">parameter</span> CLK_FREQ = <span class="number">1_0000_0000</span>;        <span class="comment">//系统时钟频率</span></span><br><span class="line"><span class="keyword">parameter</span> UART_BPS = <span class="number">115200</span>  ;         <span class="comment">//串口波特率</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//为得到指定波特率，对系统时钟计数BPS_CNT次</span></span><br><span class="line"><span class="keyword">localparam</span> BAUD_CNT_MAX = CLK_FREQ/UART_BPS; </span><br><span class="line"></span><br><span class="line"><span class="comment">//reg define</span></span><br><span class="line"><span class="keyword">reg</span>          uart_rxd_d0;</span><br><span class="line"><span class="keyword">reg</span>          uart_rxd_d1;</span><br><span class="line"><span class="keyword">reg</span>          uart_rxd_d2;</span><br><span class="line"><span class="keyword">reg</span>          rx_flag    ;  <span class="comment">//接收过程标志信号</span></span><br><span class="line"><span class="keyword">reg</span>  [<span class="number">3</span>:<span class="number">0</span> ]  rx_cnt     ;  <span class="comment">//接收数据计数器</span></span><br><span class="line"><span class="keyword">reg</span>  [<span class="number">15</span>:<span class="number">0</span>]  baud_cnt   ;  <span class="comment">//波特率计数器</span></span><br><span class="line"><span class="keyword">reg</span>  [<span class="number">7</span>:<span class="number">0</span> ]  rx_data_t  ;  <span class="comment">//接收数据寄存器</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//wire define</span></span><br><span class="line"><span class="keyword">wire</span>        start_en;</span><br><span class="line"></span><br><span class="line"><span class="comment">//捕获接收端口下降沿(起始位)，得到一个时钟周期的脉冲信号</span></span><br><span class="line"><span class="keyword">assign</span> start_en = uart_rxd_d2 &amp; (~uart_rxd_d1) &amp; (~rx_flag);</span><br><span class="line"></span><br><span class="line"><span class="comment">//针对异步信号的同步处理，为了消除亚稳态</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!rst_n) <span class="keyword">begin</span></span><br><span class="line">        uart_rxd_d0 &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">        uart_rxd_d1 &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">        uart_rxd_d2 &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        uart_rxd_d0 &lt;= uart_rxd;</span><br><span class="line">        uart_rxd_d1 &lt;= uart_rxd_d0;</span><br><span class="line">        uart_rxd_d2 &lt;= uart_rxd_d1;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//给接收标志赋值</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!rst_n) </span><br><span class="line">        rx_flag &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(start_en)    <span class="comment">//检测到起始位</span></span><br><span class="line">        rx_flag &lt;= <span class="number">1&#x27;b1</span>; <span class="comment">//接收过程中，标志信号rx_flag拉高</span></span><br><span class="line">    <span class="comment">//在停止位一半的时候，即接收过程结束，标志信号rx_flag拉低</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>((rx_cnt == <span class="number">4&#x27;d9</span>) &amp;&amp; (baud_cnt == BAUD_CNT_MAX/<span class="number">2</span> - <span class="number">1&#x27;b1</span>))</span><br><span class="line">        rx_flag &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        rx_flag &lt;= rx_flag;</span><br><span class="line"><span class="keyword">end</span>        </span><br><span class="line"></span><br><span class="line"><span class="comment">//波特率的计数器赋值</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!rst_n) </span><br><span class="line">        baud_cnt &lt;= <span class="number">16&#x27;d0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(rx_flag) <span class="keyword">begin</span>     <span class="comment">//处于接收过程时，波特率计数器（baud_cnt）进行循环计数</span></span><br><span class="line">        <span class="keyword">if</span>(baud_cnt &lt; BAUD_CNT_MAX - <span class="number">1&#x27;b1</span>)</span><br><span class="line">            baud_cnt &lt;= baud_cnt + <span class="number">16&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            baud_cnt &lt;= <span class="number">16&#x27;d0</span>; <span class="comment">//计数达到一个波特率周期后清零</span></span><br><span class="line">    <span class="keyword">end</span>    </span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        baud_cnt &lt;= <span class="number">16&#x27;d0</span>;     <span class="comment">//接收过程结束时计数器清零</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//对接收数据计数器（rx_cnt）进行赋值</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!rst_n) </span><br><span class="line">        rx_cnt &lt;= <span class="number">4&#x27;d0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(rx_flag) <span class="keyword">begin</span>                  <span class="comment">//处于接收过程时rx_cnt才进行计数</span></span><br><span class="line">        <span class="keyword">if</span>(baud_cnt == BAUD_CNT_MAX - <span class="number">1&#x27;b1</span>) <span class="comment">//当波特率计数器计数到一个波特率周期时</span></span><br><span class="line">            rx_cnt &lt;= rx_cnt + <span class="number">1&#x27;b1</span>;        <span class="comment">//接收数据计数器加1</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            rx_cnt &lt;= rx_cnt;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        rx_cnt &lt;= <span class="number">4&#x27;d0</span>;                     <span class="comment">//接收过程结束时计数器清零</span></span><br><span class="line"><span class="keyword">end</span>        </span><br><span class="line"></span><br><span class="line"><span class="comment">//根据rx_cnt来寄存rxd端口的数据</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!rst_n) </span><br><span class="line">        rx_data_t &lt;= <span class="number">8&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(rx_flag) <span class="keyword">begin</span>                           <span class="comment">//系统处于接收过程时</span></span><br><span class="line">        <span class="keyword">if</span>(baud_cnt == BAUD_CNT_MAX/<span class="number">2</span> - <span class="number">1&#x27;b1</span>) <span class="keyword">begin</span>  <span class="comment">//判断baud_cnt是否计数到数据位的中间</span></span><br><span class="line">           <span class="keyword">case</span>(rx_cnt)</span><br><span class="line">               <span class="number">4&#x27;d1</span> : rx_data_t[<span class="number">0</span>] &lt;= uart_rxd_d2;   <span class="comment">//寄存数据的最低位</span></span><br><span class="line">               <span class="number">4&#x27;d2</span> : rx_data_t[<span class="number">1</span>] &lt;= uart_rxd_d2;</span><br><span class="line">               <span class="number">4&#x27;d3</span> : rx_data_t[<span class="number">2</span>] &lt;= uart_rxd_d2;</span><br><span class="line">               <span class="number">4&#x27;d4</span> : rx_data_t[<span class="number">3</span>] &lt;= uart_rxd_d2;</span><br><span class="line">               <span class="number">4&#x27;d5</span> : rx_data_t[<span class="number">4</span>] &lt;= uart_rxd_d2;</span><br><span class="line">               <span class="number">4&#x27;d6</span> : rx_data_t[<span class="number">5</span>] &lt;= uart_rxd_d2;</span><br><span class="line">               <span class="number">4&#x27;d7</span> : rx_data_t[<span class="number">6</span>] &lt;= uart_rxd_d2;</span><br><span class="line">               <span class="number">4&#x27;d8</span> : rx_data_t[<span class="number">7</span>] &lt;= uart_rxd_d2;   <span class="comment">//寄存数据的高低位</span></span><br><span class="line">               <span class="keyword">default</span> : ;</span><br><span class="line">            <span class="keyword">endcase</span>  </span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            rx_data_t &lt;= rx_data_t;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        rx_data_t &lt;= <span class="number">8&#x27;b0</span>;</span><br><span class="line"><span class="keyword">end</span>        </span><br><span class="line"></span><br><span class="line"><span class="comment">//给接收完成信号和接收到的数据赋值</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!rst_n) <span class="keyword">begin</span></span><br><span class="line">        uart_rx_done &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">        uart_rx_data &lt;= <span class="number">8&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">//当接收数据计数器计数到停止位，且baud_cnt计数到停止位的中间时</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(rx_cnt == <span class="number">4&#x27;d9</span> &amp;&amp; baud_cnt == BAUD_CNT_MAX/<span class="number">2</span> - <span class="number">1&#x27;b1</span>) <span class="keyword">begin</span></span><br><span class="line">        uart_rx_done &lt;= <span class="number">1&#x27;b1</span>     ;  <span class="comment">//拉高接收完成信号</span></span><br><span class="line">        uart_rx_data &lt;= rx_data_t;  <span class="comment">//并对UART接收到的数据进行赋值</span></span><br><span class="line">    <span class="keyword">end</span>    </span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        uart_rx_done &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">        uart_rx_data &lt;= uart_rx_data;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h3 id="发送模块">发送模块</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101121149060.png" class title="image-20240101121149060">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> uart_tx(</span><br><span class="line">    <span class="keyword">input</span>               clk         , <span class="comment">//系统时钟</span></span><br><span class="line">    <span class="keyword">input</span>               rst_n       , <span class="comment">//系统复位，低有效</span></span><br><span class="line">    <span class="keyword">input</span>               uart_tx_en  , <span class="comment">//UART的发送使能</span></span><br><span class="line">    <span class="keyword">input</span>     [<span class="number">7</span>:<span class="number">0</span>]     uart_tx_data, <span class="comment">//UART要发送的数据</span></span><br><span class="line">    <span class="keyword">output</span>  <span class="keyword">reg</span>         uart_txd    , <span class="comment">//UART发送端口</span></span><br><span class="line">    <span class="keyword">output</span>  <span class="keyword">reg</span>         uart_tx_busy  <span class="comment">//发送忙状态信号</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="comment">//parameter define</span></span><br><span class="line"><span class="keyword">parameter</span> CLK_FREQ = <span class="number">100000000</span>;               <span class="comment">//系统时钟频率</span></span><br><span class="line"><span class="keyword">parameter</span> UART_BPS = <span class="number">115200</span>  ;               <span class="comment">//串口波特率</span></span><br><span class="line"><span class="keyword">localparam</span> BAUD_CNT_MAX = CLK_FREQ/UART_BPS; <span class="comment">//为得到指定波特率，对系统时钟计数BPS_CNT次</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//reg define</span></span><br><span class="line"><span class="keyword">reg</span>  [<span class="number">7</span>:<span class="number">0</span>]  tx_data_t;  <span class="comment">//发送数据寄存器</span></span><br><span class="line"><span class="keyword">reg</span>  [<span class="number">3</span>:<span class="number">0</span>]  tx_cnt   ;  <span class="comment">//发送数据计数器</span></span><br><span class="line"><span class="keyword">reg</span>  [<span class="number">15</span>:<span class="number">0</span>] baud_cnt ;  <span class="comment">//波特率计数器</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//*****************************************************</span></span><br><span class="line"><span class="comment">//**                    main code</span></span><br><span class="line"><span class="comment">//*****************************************************</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//当uart_tx_en为高时，寄存输入的并行数据，并拉高BUSY信号</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!rst_n) <span class="keyword">begin</span></span><br><span class="line">        tx_data_t &lt;= <span class="number">8&#x27;b0</span>;</span><br><span class="line">        uart_tx_busy &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">//发送使能时，寄存要发送的数据，并拉高BUSY信号</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(uart_tx_en) <span class="keyword">begin</span></span><br><span class="line">        tx_data_t &lt;= uart_tx_data;</span><br><span class="line">        uart_tx_busy &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">//当计数到停止位结束时，停止发送过程</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(tx_cnt == <span class="number">4&#x27;d9</span> &amp;&amp; baud_cnt == BAUD_CNT_MAX - BAUD_CNT_MAX/<span class="number">16</span>) <span class="keyword">begin</span></span><br><span class="line">        tx_data_t &lt;= <span class="number">8&#x27;b0</span>;     <span class="comment">//清空发送数据寄存器</span></span><br><span class="line">        uart_tx_busy &lt;= <span class="number">1&#x27;b0</span>;  <span class="comment">//并拉低BUSY信号</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        tx_data_t &lt;= tx_data_t;</span><br><span class="line">        uart_tx_busy &lt;= uart_tx_busy;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//波特率的计数器赋值</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!rst_n) </span><br><span class="line">        baud_cnt &lt;= <span class="number">16&#x27;d0</span>;</span><br><span class="line">    <span class="comment">//当处于发送过程时，波特率计数器（baud_cnt）进行循环计数</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(uart_tx_busy) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(baud_cnt &lt; BAUD_CNT_MAX - <span class="number">1&#x27;b1</span>)</span><br><span class="line">            baud_cnt &lt;= baud_cnt + <span class="number">16&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            baud_cnt &lt;= <span class="number">16&#x27;d0</span>; <span class="comment">//计数达到一个波特率周期后清零</span></span><br><span class="line">    <span class="keyword">end</span>    </span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        baud_cnt &lt;= <span class="number">16&#x27;d0</span>;     <span class="comment">//发送过程结束时计数器清零</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//tx_cnt进行赋值</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!rst_n) </span><br><span class="line">        tx_cnt &lt;= <span class="number">4&#x27;d0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(uart_tx_busy) <span class="keyword">begin</span>             <span class="comment">//处于发送过程时tx_cnt才进行计数</span></span><br><span class="line">        <span class="keyword">if</span>(baud_cnt == BAUD_CNT_MAX - <span class="number">1&#x27;b1</span>) <span class="comment">//当波特率计数器计数到一个波特率周期时</span></span><br><span class="line">            tx_cnt &lt;= tx_cnt + <span class="number">1&#x27;b1</span>;        <span class="comment">//发送数据计数器加1</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            tx_cnt &lt;= tx_cnt;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        tx_cnt &lt;= <span class="number">4&#x27;d0</span>;                     <span class="comment">//发送过程结束时计数器清零</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//根据tx_cnt来给uart发送端口赋值</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!rst_n) </span><br><span class="line">        uart_txd &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(uart_tx_busy) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span>(tx_cnt) </span><br><span class="line">            <span class="number">4&#x27;d0</span> : uart_txd &lt;= <span class="number">1&#x27;b0</span>        ; <span class="comment">//起始位</span></span><br><span class="line">            <span class="number">4&#x27;d1</span> : uart_txd &lt;= tx_data_t[<span class="number">0</span>]; <span class="comment">//数据位最低位</span></span><br><span class="line">            <span class="number">4&#x27;d2</span> : uart_txd &lt;= tx_data_t[<span class="number">1</span>];</span><br><span class="line">            <span class="number">4&#x27;d3</span> : uart_txd &lt;= tx_data_t[<span class="number">2</span>];</span><br><span class="line">            <span class="number">4&#x27;d4</span> : uart_txd &lt;= tx_data_t[<span class="number">3</span>];</span><br><span class="line">            <span class="number">4&#x27;d5</span> : uart_txd &lt;= tx_data_t[<span class="number">4</span>];</span><br><span class="line">            <span class="number">4&#x27;d6</span> : uart_txd &lt;= tx_data_t[<span class="number">5</span>];</span><br><span class="line">            <span class="number">4&#x27;d7</span> : uart_txd &lt;= tx_data_t[<span class="number">6</span>];</span><br><span class="line">            <span class="number">4&#x27;d8</span> : uart_txd &lt;= tx_data_t[<span class="number">7</span>]; <span class="comment">//数据位最高位</span></span><br><span class="line">            <span class="number">4&#x27;d9</span> : uart_txd &lt;= <span class="number">1&#x27;b1</span>        ; <span class="comment">//停止位</span></span><br><span class="line">            <span class="keyword">default</span> : uart_txd &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        uart_txd &lt;= <span class="number">1&#x27;b1</span>;                    <span class="comment">//空闲时发送端口为高电平</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h3 id="顶层模块-1">顶层模块</h3>
<img src="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/image-20240101121218119.png" class title="image-20240101121218119">
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> uart_loopback(</span><br><span class="line">    <span class="keyword">input</span>            sys_clk  ,   <span class="comment">//外部50MHz时钟</span></span><br><span class="line">    <span class="keyword">input</span>            sys_rst_n,   <span class="comment">//系外部复位信号，低有效</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//UART端口    </span></span><br><span class="line">    <span class="keyword">input</span>            uart_rxd ,   <span class="comment">//UART接收端口</span></span><br><span class="line">    <span class="keyword">output</span>           uart_txd     <span class="comment">//UART发送端口</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="comment">//parameter define</span></span><br><span class="line"><span class="keyword">parameter</span> CLK_FREQ = <span class="number">1_0000_0000</span>;    <span class="comment">//定义系统时钟频率</span></span><br><span class="line"><span class="keyword">parameter</span> UART_BPS = <span class="number">115200</span>  ;    <span class="comment">//定义串口波特率</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//wire define</span></span><br><span class="line"><span class="keyword">wire</span>         uart_rx_done;    <span class="comment">//UART接收完成信号</span></span><br><span class="line"><span class="keyword">wire</span>  [<span class="number">7</span>:<span class="number">0</span>]  uart_rx_data;    <span class="comment">//UART接收数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//*****************************************************</span></span><br><span class="line"><span class="comment">//**                    main code</span></span><br><span class="line"><span class="comment">//*****************************************************</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//串口接收模块</span></span><br><span class="line">uart_rx #(</span><br><span class="line">    <span class="variable">.CLK_FREQ</span>  (CLK_FREQ),</span><br><span class="line">    <span class="variable">.UART_BPS</span>  (UART_BPS)</span><br><span class="line">    )    </span><br><span class="line">    u_uart_rx(</span><br><span class="line">    <span class="variable">.clk</span>           (sys_clk     ),</span><br><span class="line">    <span class="variable">.rst_n</span>         (sys_rst_n   ),</span><br><span class="line">    <span class="variable">.uart_rxd</span>      (uart_rxd    ),</span><br><span class="line">    <span class="variable">.uart_rx_done</span>  (uart_rx_done),</span><br><span class="line">    <span class="variable">.uart_rx_data</span>  (uart_rx_data)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="comment">//串口发送模块</span></span><br><span class="line">uart_tx #(</span><br><span class="line">    <span class="variable">.CLK_FREQ</span>  (CLK_FREQ),</span><br><span class="line">    <span class="variable">.UART_BPS</span>  (UART_BPS)</span><br><span class="line">    )    </span><br><span class="line">    u_uart_tx(</span><br><span class="line">    <span class="variable">.clk</span>          (sys_clk     ),</span><br><span class="line">    <span class="variable">.rst_n</span>        (sys_rst_n   ),</span><br><span class="line">    <span class="variable">.uart_tx_en</span>   (uart_rx_done),</span><br><span class="line">    <span class="variable">.uart_tx_data</span> (uart_rx_data),</span><br><span class="line">    <span class="variable">.uart_txd</span>     (uart_txd    ),</span><br><span class="line">    <span class="variable">.uart_tx_busy</span> (            )</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<p><br></p>
<hr>
<h1 id="参考资料">参考资料</h1>
<p>课程PPT</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/">复习整理</a><a class="post-meta__tags" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B/">计算机硬件编程</a><a class="post-meta__tags" href="/tags/FPGA/">FPGA</a><a class="post-meta__tags" href="/tags/Verilog/">Verilog</a></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/01/01/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E6%95%B0%E5%AD%97%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/" title="数字图像处理复习整理"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">数字图像处理复习整理</div></div></a></div><div class="next-post pull-right"><a href="/2023/12/28/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E6%95%B0%E5%80%BC%E5%88%86%E6%9E%90%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/" title="数值分析复习整理"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">数值分析复习整理</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/12/06/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/OOAD%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/" title="OOAD复习整理"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-06</div><div class="title">OOAD复习整理</div></div></a></div><div><a href="/2023/12/28/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E6%95%B0%E5%80%BC%E5%88%86%E6%9E%90%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/" title="数值分析复习整理"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-28</div><div class="title">数值分析复习整理</div></div></a></div><div><a href="/2024/01/08/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/" title="机器学习复习整理"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-08</div><div class="title">机器学习复习整理</div></div></a></div><div><a href="/2024/01/01/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E6%95%B0%E5%AD%97%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/" title="数字图像处理复习整理"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-01</div><div class="title">数字图像处理复习整理</div></div></a></div><div><a href="/2023/12/12/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E6%8E%A5%E5%8F%A3%E6%8A%80%E6%9C%AF%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/" title="接口技术复习整理"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-12</div><div class="title">接口技术复习整理</div></div></a></div><div><a href="/2024/01/07/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/" title="计算机图形学复习整理"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-07</div><div class="title">计算机图形学复习整理</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/WinkySpeed%20SP%20-%20Repaired.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">WinkySpeed</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">42</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">48</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/WinkySpeed"><i class="fab fa-github"></i><span>GitHub</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的博客</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86"><span class="toc-number">1.</span> <span class="toc-text">计算机硬件编程复习整理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#fpga%E5%9F%BA%E7%A1%80"><span class="toc-number">2.</span> <span class="toc-text">FPGA基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFfpga"><span class="toc-number">2.1.</span> <span class="toc-text">什么是FPGA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fpga%E8%8A%AF%E7%89%87%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">2.2.</span> <span class="toc-text">FPGA芯片工作原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fpga%E5%92%8C%E5%85%B6%E4%BB%96%E8%8A%AF%E7%89%87%E5%8C%BA%E5%88%AB"><span class="toc-number">2.3.</span> <span class="toc-text">FPGA和其他芯片区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fpga%E7%89%B9%E7%82%B9"><span class="toc-number">2.4.</span> <span class="toc-text">FPGA特点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#verilog%E5%9F%BA%E7%A1%80"><span class="toc-number">3.</span> <span class="toc-text">Verilog基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#verilog-hdl-%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80"><span class="toc-number">3.1.</span> <span class="toc-text">Verilog HDL 语言基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%92%8Cc%E8%AF%AD%E8%A8%80%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">3.1.1.</span> <span class="toc-text">和C语言的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E5%A3%B0%E6%98%8E"><span class="toc-number">3.1.2.</span> <span class="toc-text">模块声明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3"><span class="toc-number">3.1.2.1.</span> <span class="toc-text">模块设计思想</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E6%A8%A1%E6%9D%BF"><span class="toc-number">3.1.2.2.</span> <span class="toc-text">程序模板</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B1%E4%BD%8D%E4%B8%8E%E9%97%A8%E7%94%B5%E8%B7%AF"><span class="toc-number">3.1.2.2.1.</span> <span class="toc-text">入门案例：1位与门电路</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E5%A3%B0%E6%98%8E"><span class="toc-number">3.1.2.3.</span> <span class="toc-text">端口声明</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#wire%E5%9E%8B"><span class="toc-number">3.1.2.3.1.</span> <span class="toc-text">wire型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#reg%E5%9E%8B"><span class="toc-number">3.1.2.3.2.</span> <span class="toc-text">reg型</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#wire%E5%92%8Creg%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">3.1.2.3.2.1.</span> <span class="toc-text">wire和reg的区别</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#memory%E5%9E%8B"><span class="toc-number">3.1.2.3.3.</span> <span class="toc-text">memory型</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#memory%E5%92%8Creg%E5%8C%BA%E5%88%AB"><span class="toc-number">3.1.2.3.3.1.</span> <span class="toc-text">memory和reg区别</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#parameter%E5%B8%B8%E9%87%8F%E5%A3%B0%E6%98%8E"><span class="toc-number">3.1.2.3.4.</span> <span class="toc-text">parameter常量声明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E6%80%BB%E7%BB%93"><span class="toc-number">3.1.2.3.5.</span> <span class="toc-text">模块总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%B5%E8%B7%AF%E5%8A%9F%E8%83%BD%E6%8F%8F%E8%BF%B0"><span class="toc-number">3.1.3.</span> <span class="toc-text">电路功能描述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E6%89%93%E5%88%86%E5%99%A8"><span class="toc-number">3.1.3.1.</span> <span class="toc-text">例子：打分器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E5%AE%9A%E7%82%B9%E5%8A%A0%E6%B3%95%E5%99%A8"><span class="toc-number">3.1.3.2.</span> <span class="toc-text">例子：定点加法器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#testbench%E7%9A%84%E7%BC%96%E5%86%99"><span class="toc-number">3.1.4.</span> <span class="toc-text">testbench的编写</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E8%B0%83%E7%94%A8%E6%97%B6%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%A3%B0%E6%98%8E"><span class="toc-number">3.1.4.1.</span> <span class="toc-text">模块调用时数据类型的声明</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#verilog%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80"><span class="toc-number">3.2.</span> <span class="toc-text">Verilog语法基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%88%B6%E4%B8%8E%E4%BD%8D%E5%AE%BD"><span class="toc-number">3.2.1.</span> <span class="toc-text">数制与位宽</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6"><span class="toc-number">3.2.1.1.</span> <span class="toc-text">特殊字符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E7%AE%97%E6%93%8D%E4%BD%9C"><span class="toc-number">3.2.2.</span> <span class="toc-text">运算操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E9%80%BB%E8%BE%91%E7%94%B5%E8%B7%AF%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.</span> <span class="toc-text">组合逻辑电路设计</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E9%80%BB%E8%BE%91%E4%B8%8E%E6%97%B6%E5%BA%8F%E9%80%BB%E8%BE%91"><span class="toc-number">4.1.</span> <span class="toc-text">组合逻辑与时序逻辑</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E9%80%BB%E8%BE%91"><span class="toc-number">4.1.1.</span> <span class="toc-text">组合逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E5%BA%8F%E9%80%BB%E8%BE%91"><span class="toc-number">4.1.2.</span> <span class="toc-text">时序逻辑</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E9%80%BB%E8%BE%91%E7%9A%84alway%E5%9D%97"><span class="toc-number">4.2.</span> <span class="toc-text">组合逻辑的alway块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%8F%E6%84%9F%E4%BF%A1%E5%8F%B7%E5%88%97%E8%A1%A8"><span class="toc-number">4.2.1.</span> <span class="toc-text">敏感信号列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E7%A8%8B%E8%B5%8B%E5%80%BC"><span class="toc-number">4.2.2.</span> <span class="toc-text">过程赋值</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%BB%E5%A1%9E%E8%B5%8B%E5%80%BC"><span class="toc-number">4.2.2.1.</span> <span class="toc-text">阻塞赋值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9E%E9%98%BB%E5%A1%9E%E8%B5%8B%E5%80%BC"><span class="toc-number">4.2.2.2.</span> <span class="toc-text">非阻塞赋值</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%901%E4%BD%8D%E6%AF%94%E8%BE%83%E5%99%A8"><span class="toc-number">4.2.3.</span> <span class="toc-text">例子：1位比较器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5"><span class="toc-number">4.3.</span> <span class="toc-text">条件语句</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#if-else"><span class="toc-number">4.3.1.</span> <span class="toc-text">if-else</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%904%E4%BD%8D%E4%BC%98%E5%85%88%E7%BC%96%E7%A0%81%E5%99%A8"><span class="toc-number">4.3.1.1.</span> <span class="toc-text">例子：4位优先编码器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E5%B8%A6%E4%BD%BF%E8%83%BD%E4%BF%A1%E5%8F%B7%E7%9A%842-4%E8%AF%91%E7%A0%81%E5%99%A8"><span class="toc-number">4.3.1.2.</span> <span class="toc-text">例子：带使能信号的2-4译码器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#case"><span class="toc-number">4.3.2.</span> <span class="toc-text">case</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E5%B8%A6%E4%BD%BF%E8%83%BD%E4%BF%A1%E5%8F%B7%E7%9A%842-4%E8%AF%91%E7%A0%81%E5%99%A8-1"><span class="toc-number">4.3.2.1.</span> <span class="toc-text">例子：带使能信号的2-4译码器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#case%E5%8F%98%E4%BD%93"><span class="toc-number">4.3.2.2.</span> <span class="toc-text">case变体</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%81%BF%E5%85%8D%E9%94%81%E5%AD%98%E5%99%A8"><span class="toc-number">4.3.3.</span> <span class="toc-text">避免锁存器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5"><span class="toc-number">4.4.</span> <span class="toc-text">循环语句</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%908%E4%BD%8D%E4%B9%98%E6%B3%95%E5%99%A8-%E4%B9%98%E5%8F%B7%E8%BF%90%E7%AE%97"><span class="toc-number">4.4.1.</span> <span class="toc-text">例子：8位乘法器-乘号运算</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E7%A7%BB%E4%BD%8D%E5%AE%9E%E7%8E%B08%E4%BD%8D%E4%B9%98%E6%B3%95%E5%99%A8"><span class="toc-number">4.4.1.1.</span> <span class="toc-text">用移位实现8位乘法器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8D%E7%94%A8%E4%B9%98%E6%B3%95%E8%BF%90%E7%AE%97%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-number">4.4.1.1.1.</span> <span class="toc-text">不用*乘法运算的原因</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#for%E8%AF%AD%E5%8F%A5"><span class="toc-number">4.4.2.</span> <span class="toc-text">for语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#repeat%E8%AF%AD%E5%8F%A5"><span class="toc-number">4.4.3.</span> <span class="toc-text">repeat语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#while%E8%AF%AD%E5%8F%A5"><span class="toc-number">4.4.4.</span> <span class="toc-text">while语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#always%E5%9D%97%E4%B8%80%E8%88%AC%E7%BC%96%E7%A0%81%E5%8E%9F%E5%88%99"><span class="toc-number">4.5.</span> <span class="toc-text">always块一般编码原则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E7%94%B5%E8%B7%AF%E4%BB%A3%E7%A0%81%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E9%94%99%E8%AF%AF"><span class="toc-number">4.5.1.</span> <span class="toc-text">组合电路代码中常见的错误</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E7%94%B5%E8%B7%AF%E4%B8%ADalways%E5%9D%97%E7%9A%84%E4%BD%BF%E7%94%A8%E5%8E%9F%E5%88%99"><span class="toc-number">4.5.2.</span> <span class="toc-text">组合电路中always块的使用原则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%92%8C%E5%B8%B8%E6%95%B0"><span class="toc-number">4.6.</span> <span class="toc-text">参数和常数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#localparam"><span class="toc-number">4.6.1.</span> <span class="toc-text">localparam</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#parameter"><span class="toc-number">4.6.2.</span> <span class="toc-text">parameter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%BB%84%E5%90%88%E9%80%BB%E8%BE%91%E7%94%B5%E8%B7%AF%E8%AE%BE%E8%AE%A1%E5%AE%9E%E4%BE%8B"><span class="toc-number">4.7.</span> <span class="toc-text">常用组合逻辑电路设计实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E5%A4%9A%E8%B7%AF%E9%80%89%E6%8B%A9%E5%99%A8"><span class="toc-number">4.7.1.</span> <span class="toc-text">例子：多路选择器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E6%AF%94%E8%BE%83%E5%99%A8"><span class="toc-number">4.7.2.</span> <span class="toc-text">例子：比较器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%91%E7%A0%81%E5%99%A8%E5%92%8C%E7%BC%96%E7%A0%81%E5%99%A8"><span class="toc-number">4.7.3.</span> <span class="toc-text">译码器和编码器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%903-8%E8%AF%91%E7%A0%81%E5%99%A8"><span class="toc-number">4.7.3.1.</span> <span class="toc-text">例子：3-8译码器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%908-3%E7%BC%96%E7%A0%81%E5%99%A8"><span class="toc-number">4.7.3.2.</span> <span class="toc-text">例子：8-3编码器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%908-3%E4%BC%98%E5%85%88%E7%BC%96%E7%A0%81%E5%99%A8"><span class="toc-number">4.7.3.3.</span> <span class="toc-text">例子：8-3优先编码器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E5%88%B6%E6%95%B07%E6%AE%B5led%E6%98%BE%E7%A4%BA%E8%AF%91%E7%A0%81%E5%99%A8"><span class="toc-number">4.7.4.</span> <span class="toc-text">16进制数7段LED显示译码器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%9016%E8%BF%9B%E5%88%B6%E5%85%B1%E9%98%B3%E6%95%B0%E7%A0%81%E7%AE%A1"><span class="toc-number">4.7.4.1.</span> <span class="toc-text">例子：16进制共阳数码管</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%B6%E5%BA%8F%E9%80%BB%E8%BE%91%E7%94%B5%E8%B7%AF%E8%AE%BE%E8%AE%A1"><span class="toc-number">5.</span> <span class="toc-text">时序逻辑电路设计</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8%E5%92%8C%E9%94%81%E5%AD%98%E5%99%A8"><span class="toc-number">5.1.</span> <span class="toc-text">触发器和锁存器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E5%BA%8F%E9%80%BB%E8%BE%91-1"><span class="toc-number">5.1.1.</span> <span class="toc-text">时序逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#d%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">5.1.2.</span> <span class="toc-text">D触发器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E5%90%AB%E5%BC%82%E6%AD%A5%E5%A4%8D%E4%BD%8D%E7%9A%84d%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">5.1.3.</span> <span class="toc-text">例子：含异步复位的D触发器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E5%90%AB%E5%BC%82%E6%AD%A5%E5%A4%8D%E4%BD%8D%E5%92%8C%E5%90%8C%E6%AD%A5%E4%BD%BF%E8%83%BD%E7%9A%84d%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">5.1.4.</span> <span class="toc-text">例子：含异步复位和同步使能的D触发器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8C%E6%AD%A5%E8%AE%BE%E8%AE%A1"><span class="toc-number">5.1.5.</span> <span class="toc-text">同步设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E9%94%81%E5%AD%98%E5%99%A8"><span class="toc-number">5.1.6.</span> <span class="toc-text">基本锁存器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AB%E6%B8%85%E9%9B%B6%E6%8E%A7%E5%88%B6%E7%9A%84%E9%94%81%E5%AD%98%E5%99%A8"><span class="toc-number">5.1.7.</span> <span class="toc-text">含清零控制的锁存器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%81%E5%AD%98%E5%99%A8%E5%92%8C%E8%A7%A6%E5%8F%91%E5%99%A8%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">5.1.7.1.</span> <span class="toc-text">锁存器和触发器的区别</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">5.2.</span> <span class="toc-text">寄存器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8%E4%BD%9C%E7%94%A8"><span class="toc-number">5.2.1.</span> <span class="toc-text">寄存器作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%901%E4%BD%8D%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">5.2.2.</span> <span class="toc-text">例子：1位寄存器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%904%E7%BA%A7%E7%9A%841%E4%BD%8D%E4%B8%B2%E8%81%94%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">5.2.2.1.</span> <span class="toc-text">例子：4级的1位串联寄存器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90n%E4%BD%8D%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">5.2.3.</span> <span class="toc-text">例子：N位寄存器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E5%AF%84%E5%AD%98%E5%99%A8%E7%BB%84"><span class="toc-number">5.2.4.</span> <span class="toc-text">例子：寄存器组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E5%AF%84%E5%AD%98%E5%99%A8%E5%A0%86"><span class="toc-number">5.2.5.</span> <span class="toc-text">例子：寄存器堆</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A7%BB%E4%BD%8D%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">5.3.</span> <span class="toc-text">移位寄存器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E5%85%B7%E6%9C%89%E5%90%8C%E6%AD%A5%E9%A2%84%E7%BD%AE%E5%8A%9F%E8%83%BD%E7%9A%848%E4%BD%8D%E7%A7%BB%E4%BD%8D%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">5.3.1.</span> <span class="toc-text">例子：具有同步预置功能的8位移位寄存器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%908%E4%BD%8D%E9%80%9A%E7%94%A8%E7%A7%BB%E4%BD%8D%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">5.3.2.</span> <span class="toc-text">例子：8位通用移位寄存器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="toc-number">5.4.</span> <span class="toc-text">计数器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E7%AE%80%E5%8D%95%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="toc-number">5.4.1.</span> <span class="toc-text">例子：简单的二进制计数器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E9%80%9A%E7%94%A8%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="toc-number">5.4.2.</span> <span class="toc-text">例子：通用的二进制计数器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E6%A8%A1m%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="toc-number">5.4.3.</span> <span class="toc-text">例子：模M计数器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E6%97%B6%E9%92%9F%E8%BD%AC%E6%8D%A2"><span class="toc-number">5.4.4.</span> <span class="toc-text">例子：时钟转换</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E5%BA%8F%E9%80%BB%E8%BE%91%E7%94%B5%E8%B7%AF%E8%AE%BE%E8%AE%A1-1"><span class="toc-number">5.5.</span> <span class="toc-text">时序逻辑电路设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E6%8C%89%E9%94%AE%E8%BE%B9%E6%B2%BF%E6%A3%80%E6%B5%8B%E7%94%B5%E8%B7%AF%E8%AE%BE%E8%AE%A1"><span class="toc-number">5.5.1.</span> <span class="toc-text">例子：按键边沿检测电路设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E6%B5%81%E6%B0%B4%E7%81%AF%E8%AE%BE%E8%AE%A1"><span class="toc-number">5.5.2.</span> <span class="toc-text">例子：流水灯设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E6%8C%89%E9%94%AE%E6%A3%80%E6%B5%8B%E6%B5%81%E6%B0%B4%E7%81%AF%E8%AE%BE%E8%AE%A1"><span class="toc-number">5.5.3.</span> <span class="toc-text">例子：按键检测+流水灯设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E5%91%BC%E5%90%B8%E7%81%AF%E8%AE%BE%E8%AE%A1"><span class="toc-number">5.5.4.</span> <span class="toc-text">例子：呼吸灯设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ip%E6%A0%B8%E8%B0%83%E7%94%A8"><span class="toc-number">5.5.5.</span> <span class="toc-text">IP核调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E7%A0%81%E7%AE%A1%E6%89%AB%E6%8F%8F%E6%98%BE%E7%A4%BA%E7%94%B5%E8%B7%AF"><span class="toc-number">5.5.6.</span> <span class="toc-text">数码管扫描显示电路</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%908%E4%B8%AA%E5%85%B1%E9%98%B4%E6%9E%81%E6%95%B0%E7%A0%81%E7%AE%A1%E6%89%AB%E6%8F%8F%E6%98%BE%E7%A4%BA%E7%94%B5%E8%B7%AF%E8%AE%BE%E8%AE%A1"><span class="toc-number">5.5.6.1.</span> <span class="toc-text">例子：8个共阴极数码管扫描显示电路设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E5%9C%A88%E4%B8%AA%E6%95%B0%E7%A0%81%E7%AE%A1%E4%BE%9D%E6%AC%A1%E6%98%BE%E7%A4%BA1%E5%88%B08"><span class="toc-number">5.5.6.2.</span> <span class="toc-text">例子：在8个数码管依次显示1到8</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E8%AE%BE%E8%AE%A1%E4%B9%98%E6%B3%95%E5%99%A8%E5%B9%B6%E6%98%BE%E7%A4%BA%E5%9C%A8%E6%95%B0%E7%A0%81%E7%AE%A1%E4%B8%AD"><span class="toc-number">5.5.6.3.</span> <span class="toc-text">例子：设计乘法器并显示在数码管中</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%92%E8%A1%A8%E8%AE%BE%E8%AE%A1"><span class="toc-number">5.5.7.</span> <span class="toc-text">秒表设计</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E7%A7%92%E8%A1%A8%E8%BF%9B%E4%BD%8D"><span class="toc-number">5.5.7.1.</span> <span class="toc-text">例子：秒表（进位）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E7%A7%92%E8%A1%A8%E6%95%B0%E7%A0%81%E7%AE%A1%E6%98%BE%E7%A4%BA"><span class="toc-number">5.5.7.2.</span> <span class="toc-text">例子：秒表+数码管显示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E7%A7%92%E8%A1%A8%E6%AF%8F%E4%BD%8D%E5%8D%95%E7%8B%AC%E6%8E%A7%E5%88%B6"><span class="toc-number">5.5.7.3.</span> <span class="toc-text">例子：秒表（每位单独控制）</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%E8%AE%BE%E8%AE%A1"><span class="toc-number">6.</span> <span class="toc-text">有限状态机设计</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%E5%AE%9A%E4%B9%89"><span class="toc-number">6.1.</span> <span class="toc-text">有限状态机定义</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E5%BA%8F%E9%80%BB%E8%BE%91%E5%88%86%E7%B1%BB"><span class="toc-number">6.1.1.</span> <span class="toc-text">时序逻辑分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%E4%BC%98%E7%82%B9"><span class="toc-number">6.1.2.</span> <span class="toc-text">有限状态机优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%E5%88%86%E7%B1%BB"><span class="toc-number">6.1.3.</span> <span class="toc-text">有限状态机分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mealy%E5%9E%8B"><span class="toc-number">6.1.3.1.</span> <span class="toc-text">Mealy型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#moore%E5%9E%8B"><span class="toc-number">6.1.3.2.</span> <span class="toc-text">Moore型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8C%BA%E5%88%AB%E5%92%8C%E8%81%94%E7%B3%BB"><span class="toc-number">6.1.3.3.</span> <span class="toc-text">区别和联系</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%E8%A1%A8%E7%A4%BA%E6%96%B9%E6%B3%95"><span class="toc-number">6.1.4.</span> <span class="toc-text">有限状态机表示方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.2.</span> <span class="toc-text">有限状态机代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%E5%86%99%E6%B3%95%E4%B8%89%E4%B8%AA%E9%80%BB%E8%BE%91%E5%9D%97%E5%88%86%E5%BC%80%E5%86%99"><span class="toc-number">6.2.1.</span> <span class="toc-text">第一种写法：三个逻辑块分开写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%E5%86%99%E6%B3%95%E6%AC%A1%E6%80%81%E5%92%8C%E8%BE%93%E5%87%BA%E6%A8%A1%E5%9D%97%E7%BB%93%E5%90%88%E5%9C%A8%E4%B8%80%E8%B5%B7"><span class="toc-number">6.2.2.</span> <span class="toc-text">第二种写法：次态和输出模块结合在一起</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%9C%BA%E8%AE%BE%E8%AE%A1%E5%AE%9E%E4%BE%8B"><span class="toc-number">6.3.</span> <span class="toc-text">状态机设计实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%9C%BA%E5%AE%9E%E7%8E%B0%E6%A8%A1%E5%9E%8B"><span class="toc-number">6.3.1.</span> <span class="toc-text">状态机实现模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E6%A3%80%E6%B5%8B%E5%99%A8"><span class="toc-number">6.3.2.</span> <span class="toc-text">序列检测器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E5%9F%BA%E4%BA%8Emoore%E7%8A%B6%E6%80%81%E6%9C%BA%E8%AE%BE%E8%AE%A1%E5%BA%8F%E5%88%97%E6%A3%80%E6%B5%8B%E5%99%A8"><span class="toc-number">6.3.2.1.</span> <span class="toc-text">例子：基于Moore状态机设计序列检测器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E5%9F%BA%E4%BA%8Emealy%E7%8A%B6%E6%80%81%E6%9C%BA%E8%AE%BE%E8%AE%A1%E5%BA%8F%E5%88%97%E6%A3%80%E6%B5%8B%E5%99%A8"><span class="toc-number">6.3.2.2.</span> <span class="toc-text">例子：基于Mealy状态机设计序列检测器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E9%94%AE%E6%B6%88%E6%8A%96%E7%94%B5%E8%B7%AF%E8%AE%BE%E8%AE%A1"><span class="toc-number">6.3.3.</span> <span class="toc-text">按键消抖电路设计</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%E8%AE%BE%E8%AE%A1%E6%8C%89%E9%94%AE%E6%B6%88%E6%8A%96"><span class="toc-number">6.3.3.1.</span> <span class="toc-text">例子：有限状态机设计按键消抖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E8%AE%A1%E6%95%B0%E5%99%A8%E6%8C%89%E9%94%AE%E8%BE%B9%E6%B2%BF%E6%A3%80%E6%B5%8B%E5%AE%9E%E7%8E%B0%E6%8C%89%E9%94%AE%E6%B6%88%E6%8A%96"><span class="toc-number">6.3.3.2.</span> <span class="toc-text">例子：计数器+按键边沿检测实现按键消抖</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#uart%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1"><span class="toc-number">7.</span> <span class="toc-text">UART串口通信</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#uart%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE"><span class="toc-number">7.1.</span> <span class="toc-text">UART串口通信协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A2%E7%89%B9%E7%8E%87%E6%AF%94%E7%89%B9%E7%8E%87"><span class="toc-number">7.1.1.</span> <span class="toc-text">波特率比特率</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E6%A1%86%E5%9B%BE%E5%88%86%E6%9E%90%E8%AE%BE%E8%AE%A1"><span class="toc-number">7.2.</span> <span class="toc-text">逻辑框图分析设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%B2%E5%8F%A3%E6%8E%A5%E6%94%B6%E6%A8%A1%E5%9D%97"><span class="toc-number">7.2.1.</span> <span class="toc-text">串口接收模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%B2%E5%8F%A3%E5%8F%91%E9%80%81%E6%A8%A1%E5%9D%97"><span class="toc-number">7.2.2.</span> <span class="toc-text">串口发送模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B6%E5%B1%82%E6%A8%A1%E5%9D%97"><span class="toc-number">7.2.3.</span> <span class="toc-text">顶层模块</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%84%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">7.3.</span> <span class="toc-text">各模块代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E6%94%B6%E6%A8%A1%E5%9D%97"><span class="toc-number">7.3.1.</span> <span class="toc-text">接收模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E6%A8%A1%E5%9D%97"><span class="toc-number">7.3.2.</span> <span class="toc-text">发送模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B6%E5%B1%82%E6%A8%A1%E5%9D%97-1"><span class="toc-number">7.3.3.</span> <span class="toc-text">顶层模块</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">8.</span> <span class="toc-text">参考资料</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/01/08/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/" title="机器学习复习整理">机器学习复习整理</a><time datetime="2024-01-08T01:40:07.000Z" title="发表于 2024-01-08 09:40:07">2024-01-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/01/07/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/" title="计算机图形学复习整理">计算机图形学复习整理</a><time datetime="2024-01-07T13:06:54.000Z" title="发表于 2024-01-07 21:06:54">2024-01-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/01/01/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E6%95%B0%E5%AD%97%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/" title="数字图像处理复习整理">数字图像处理复习整理</a><time datetime="2024-01-01T07:03:37.000Z" title="发表于 2024-01-01 15:03:37">2024-01-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/30/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/" title="计算机硬件编程复习整理">计算机硬件编程复习整理</a><time datetime="2023-12-30T11:24:04.000Z" title="发表于 2023-12-30 19:24:04">2023-12-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/28/%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/%E6%95%B0%E5%80%BC%E5%88%86%E6%9E%90%E5%A4%8D%E4%B9%A0%E6%95%B4%E7%90%86/" title="数值分析复习整理">数值分析复习整理</a><time datetime="2023-12-28T01:35:05.000Z" title="发表于 2023-12-28 09:35:05">2023-12-28</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By WinkySpeed</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2d-widget/autoload.js"></script></body></html>